{"version":3,"sources":["webpack:///node_modules/@arcgis/core/geometry/support/scaleUtils.js","webpack:///node_modules/@arcgis/core/layers/MapImageLayer.js","webpack:///node_modules/@arcgis/core/layers/support/ExportImageParameters.js"],"names":["e","r","i","extent","o","width","c","spatialReference","t","n","clone","expand","U","alwaysRefetch","dpi","gdbVersion","imageFormat","imageMaxHeight","imageMaxWidth","imageTransparency","labelsVisible","isReference","operationalLayerType","sourceJSON","sublayers","type","url","signal","addResolvingPromise","loadFromPortal","supportedTypes","then","_fetchService","supportedImageFormatTypes","indexOf","s","loaded","slice","reverse","flatten","toArray","capabilities","operations","supportsExportMap","exportMap","supportsDynamicLayers","origin","createSublayersForOrigin","a","p","writeSublayerStructure","forEach","write","push","originOf","some","Object","keys","length","layers","visibleLayers","filter","visible","map","id","pixelRatio","version","shiftCentralMeridian","layer","scale","toJSON","destroy","rotation","m","wkid","JSON","stringify","l","timeExtent","start","end","time","timeInfo","hasLiveData","bbox","xmin","ymin","xmax","ymax","bboxSR","imageSR","size","responseType","timestamp","query","_ts","customParameters","parsedUrl","path","createExportImageParameters","f","Date","now","dynamicLayers","data","error","returnUpdates","fullExtent","fromJSON","allSublayers","read","ssl","replace","prototype","json","origins","service","source","Boolean","enabled","overridePolicy","ignoreOrigin","readOnly","value","T","definitionExpression","labelingInfo","opacity","minScale","maxScale","renderer","y","arguments","_scale","view","hasDynamicLayers","visibleSublayers","toExportImageJSON","serviceSublayers","_get","_set","handles","remove","add","on","notifyChange","propertyName","join","reduce","layerDefs","unshift","format","transparent","dependsOn","Number"],"mappings":"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","file":"default~MapImageLayer-js~layers-MapImageLayer-js-es5.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{getMetersPerUnitForSR as t,inchesPerMeter as n}from\"../../core/unitUtils.js\";function e(e,r){const i=r||e.extent,o=e.width,c=t(i&&i.spatialReference);return i&&o?i.width/o*c*n*96:0}function r(e,r){return e/(t(r)*n*96)}function i(e,r){return e*(t(r)*n*96)}function o(t,n){const e=t.extent,i=t.width,o=r(n,e.spatialReference);return e.clone().expand(o*i/e.width)}export{o as getExtentForScale,r as getResolutionForScale,e as getScale,i as getScaleForResolution};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../core/has.js\";import{isSome as r}from\"../core/maybe.js\";import\"../core/Logger.js\";import{Integer as t}from\"../core/accessorSupport/ensureType.js\";import{property as s}from\"../core/accessorSupport/decorators/property.js\";import{reader as o}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as i}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as a}from\"../core/accessorSupport/decorators/writer.js\";import p from\"../core/Error.js\";import\"../core/urlUtils.js\";import\"../core/uuid.js\";import{nameToId as m}from\"../core/accessorSupport/PropertyOrigin.js\";import\"../portal/support/resourceExtension.js\";import{resolve as n,reject as l,isAbortError as c}from\"../core/promiseUtils.js\";import u from\"../geometry/Extent.js\";import y from\"../request.js\";import{loadAll as h}from\"../core/loadAll.js\";import d from\"./Layer.js\";import f from\"../TimeExtent.js\";import{MultiOriginJSONMixin as g}from\"../core/MultiOriginJSONSupport.js\";import{url as j}from\"./support/commonProperties.js\";import{OperationalLayer as b}from\"./mixins/OperationalLayer.js\";import{ArcGISService as x}from\"./mixins/ArcGISService.js\";import{BlendLayer as v}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as S}from\"./mixins/CustomParametersMixin.js\";import{PortalLayer as w}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as O}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as L}from\"./mixins/ScaleRangeLayer.js\";import{TemporalLayer as E}from\"./mixins/TemporalLayer.js\";import{HandleOwnerMixin as I}from\"../core/HandleOwner.js\";import{getScale as M}from\"../geometry/support/scaleUtils.js\";import{ArcGISMapService as q}from\"./mixins/ArcGISMapService.js\";import P from\"./support/Sublayer.js\";import{shouldWriteSublayerStructure as N}from\"./support/sublayerUtils.js\";import{SublayersOwner as R}from\"./mixins/SublayersOwner.js\";import{ExportImageParameters as J}from\"./support/ExportImageParameters.js\";let U=class extends(v(E(L(O(R(q(x(b(w(g(S(I(d))))))))))))){constructor(...e){super(...e),this.alwaysRefetch=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat=\"png24\",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.labelsVisible=!1,this.isReference=null,this.operationalLayerType=\"ArcGISMapServiceLayer\",this.sourceJSON=null,this.sublayers=null,this.type=\"map-image\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const t=r(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).then((()=>this._fetchService(t)),(()=>this._fetchService(t)))),n(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.indexOf(\"PNG32\")>-1?\"png32\":\"png24\"}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const o=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let i=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=m(s.origin);if(3===e){const e=this.createSublayersForOrigin(\"service\").sublayers;i=N(o,e,2)}else if(e>3){const e=this.createSublayersForOrigin(\"portal-item\");i=N(o,e.sublayers,m(e.origin))}}const a=[],p={writeSublayerStructure:i,...s};let n=i;o.forEach((e=>{const r=e.write({},p);a.push(r),n=n||\"user\"===e.originOf(\"visible\")}));a.some((e=>Object.keys(e).length>1))&&(r.layers=a),n&&(r.visibleLayers=o.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,s){const o=s&&s.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const i=new J({layer:this,scale:M({extent:e,width:r})*o}),a=i.toJSON();i.destroy();const p=!s||!s.rotation||this.version<10.3?{}:{rotation:-s.rotation},m=e&&e.spatialReference,n=m.wkid||JSON.stringify(m.toJSON());a.dpi*=o;const l={};if(null!=s&&s.timeExtent){const{start:e,end:r}=s.timeExtent.toJSON();l.time=e&&r&&e===r?\"\"+e:`${null==e?\"null\":e},${null==r?\"null\":r}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(l.time=\"null,null\");return{bbox:e&&e.xmin+\",\"+e.ymin+\",\"+e.xmax+\",\"+e.ymax,bboxSR:n,imageSR:n,size:r+\",\"+t,...a,...p,...l}}async fetchImage(e,r,t,s){const o={responseType:\"image\"};s&&s.timestamp&&(o.query={...o.query,_ts:s.timestamp}),s&&s.signal&&(o.signal=s.signal),this.customParameters&&Object.keys(this.customParameters).length&&(o.query={...this.customParameters,...o.query});const i=this.parsedUrl.path+\"/export\",a={...this.parsedUrl.query,...this.createExportImageParameters(e,r,t,s),f:\"image\",_ts:this.alwaysRefetch?Date.now():null};if(null!=a.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return l(new p(\"mapimagelayer:dynamiclayer-not-supported\",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:a}));o.query?o.query={...a,...o.query}:o.query=a;return y(i,o).then((e=>e.data)).catch((e=>{if(c(e))throw e;throw new p(\"mapimagelayer:image-fetch-error\",`Unable to load image: ${i}`,{error:e})}))}async fetchRecomputedExtents(e={}){const r={...e,query:{returnUpdates:!0,f:\"json\"}},{data:t}=await y(this.url,r),{extent:s,fullExtent:o,timeExtent:i}=t,a=s||o;return{fullExtent:a&&u.fromJSON(a),timeExtent:i&&f.fromJSON({start:i[0],end:i[1]})}}loadAll(){return h(this,(e=>{e(this.allSublayers)}))}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:\"service\",url:this.parsedUrl});const{data:r,ssl:t}=await y(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters},signal:e});t&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r,this.read(r,{origin:\"service\",url:this.parsedUrl})}};e([s()],U.prototype,\"alwaysRefetch\",void 0),e([s()],U.prototype,\"dpi\",void 0),e([s()],U.prototype,\"gdbVersion\",void 0),e([s({json:{read:!1,write:!1}})],U.prototype,\"popupEnabled\",void 0),e([s()],U.prototype,\"imageFormat\",void 0),e([o(\"imageFormat\",[\"supportedImageFormatTypes\"])],U.prototype,\"readImageFormat\",null),e([s({json:{origins:{service:{read:{source:\"maxImageHeight\"}}}}})],U.prototype,\"imageMaxHeight\",void 0),e([s({json:{origins:{service:{read:{source:\"maxImageWidth\"}}}}})],U.prototype,\"imageMaxWidth\",void 0),e([s()],U.prototype,\"imageTransparency\",void 0),e([s({json:{read:!1,write:!1}})],U.prototype,\"labelsVisible\",void 0),e([s({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],U.prototype,\"isReference\",void 0),e([s({type:[\"ArcGISMapServiceLayer\"]})],U.prototype,\"operationalLayerType\",void 0),e([s()],U.prototype,\"sourceJSON\",void 0),e([s({json:{write:{ignoreOrigin:!0}}})],U.prototype,\"sublayers\",void 0),e([a(\"sublayers\",{layers:{type:[P]},visibleLayers:{type:[t]}})],U.prototype,\"writeSublayers\",null),e([s({type:[\"show\",\"hide\",\"hide-children\"]})],U.prototype,\"listMode\",void 0),e([s({json:{read:!1},readOnly:!0,value:\"map-image\"})],U.prototype,\"type\",void 0),e([s(j)],U.prototype,\"url\",void 0),U=e([i(\"esri.layers.MapImageLayer\")],U);var T=U;export default T;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import i from\"../../core/Accessor.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{HandleOwnerMixin as t}from\"../../core/HandleOwner.js\";import{isExportDynamic as l}from\"./sublayerUtils.js\";import n from\"../../views/View.js\";const o={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let y=class extends(t(i)){constructor(){super(...arguments),this._scale=null,this.view=null}destroy(){this.layer=this.view=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&l(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(o[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,s)=>(e[s.id]=s.definitionExpression,e)),{})):null}get scale(){return null!=this._scale?this._scale:this.view&&this.view.scale||0}set scale(e){this.view||(this._scale=e,this.notifyChange(\"scale\"))}get version(){const e=this;e.layers,e.layerDefs,e.dynamicLayers,e.timeExtent;const s=e.layer;return s&&(s.dpi,s.imageFormat,s.imageTransparency,s.gdbVersion),(this._get(\"version\")||0)+1}set version(e){this._set(\"version\",e)}get visibleSublayers(){const e=[];if(!this.layer)return e;const s=this.layer.sublayers,r=s=>{const i=this.scale,a=0===i,t=0===s.minScale||i<=s.minScale,l=0===s.maxScale||i>=s.maxScale;s.visible&&(a||t&&l)&&(s.sublayers?s.sublayers.forEach(r):e.unshift(s))};s&&s.forEach(r);const i=this._get(\"visibleSublayers\");return!i||i.length!==e.length||i.some(((s,r)=>e[r]!==s))?e:i}toJSON(){const e=this.layer;let s={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?s.dynamicLayers=this.dynamicLayers:s={...s,layers:this.layers,layerDefs:this.layerDefs},s}};e([s({readOnly:!0,dependsOn:[\"hasDynamicLayers\",\"visibleSublayers\"]})],y.prototype,\"dynamicLayers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\",\"layer.serviceSublayers\",\"layer.capabilities\"]})],y.prototype,\"hasDynamicLayers\",null),e([s()],y.prototype,\"layer\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layerDefs\",null),e([s({type:Number,dependsOn:[\"view.scale\"]})],y.prototype,\"scale\",null),e([s(a)],y.prototype,\"timeExtent\",void 0),e([s({dependsOn:[\"layers\",\"layerDefs\",\"dynamicLayers\",\"layer.dpi\",\"layer.imageFormat\",\"layer.imageTransparency\",\"layer.gdbVersion\",\"timeExtent\"]})],y.prototype,\"version\",null),e([s({type:n})],y.prototype,\"view\",void 0),e([s({readOnly:!0,dependsOn:[\"layer.sublayers\",\"scale\"]})],y.prototype,\"visibleSublayers\",null),y=e([r(\"esri.layers.mixins.ExportImageParameters\")],y);export{y as ExportImageParameters};\n"]}