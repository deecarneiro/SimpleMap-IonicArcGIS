{"version":3,"sources":["webpack:///node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/support/WGLFeatureView.js","webpack:///node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/SymbolTileRenderer.js"],"names":["a","e","s","t","_pointToCallbacks","Map","_layer","_layerView","attributeView","update","hasAnimation","painter","effects","integrate","draw","i","set","requestRender","promise","minScale","maxScale","state","scale","hasLabels","featureReduction","type","labelsVisible","labelingInfo","length","registerRenderPass","name","brushes","label","target","children","drawPhase","LABEL","LABEL_ALPHA","fill","line","marker","text","enableDefaultDraw","hasEffects","apply","outsideEffect","enable","args","effectLists","excluded","insideEffect","included","hittest","size","r","HIGHLIGHT","highlight","hasHighlight","n","tileInfoView","layerView","layer","featuresView","addChild","removeChild","destroy","hitTest","indexOf","visualVariables","map","clone","normalizationField","valueExpression","field","setRendererInfo","tiles","get","tileKey","onTileData","data","view","labelManager","requestUpdate","onTileError","forceTextureUpload","lockTextureUpload","forEach","lockUploads","unlockTextureUpload","unlockUploads","getMaterialItems","isDirty","getTileBounds","addTile","removeTile","key","id","u"],"mappings":"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","file":"tileRenderers-SymbolTileRenderer-js-es5.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{createResolver as e}from\"../../../../../../core/promiseUtils.js\";import{WGLDrawPhase as s}from\"../../../../engine/webgl/enums.js\";import{brushes as t}from\"../../../../engine/brushes.js\";import{FeatureContainer as i}from\"../../../../engine/FeatureContainer.js\";class a extends i{constructor(e,s,t){super(e),this._pointToCallbacks=new Map,this._layer=t,this._layerView=s}renderChildren(e){if(this.attributeView.update(),this.hasAnimation){e.painter.effects.integrate.draw(e,e.attributeView)}super.renderChildren(e)}hitTest(s,t){const i=[s,t],a=e();return this._pointToCallbacks.set(i,a),this.requestRender(),a.promise}doRender(e){const{minScale:s,maxScale:t}=this._layer,i=e.state.scale;i<=(s||1/0)&&i>=t&&super.doRender(e)}get hasAnimation(){return this.hasLabels}get hasLabels(){const e=this._layer.featureReduction,s=e&&\"cluster\"===e.type&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!s}get labelsVisible(){return this._layer.labelsVisible}prepareRenderPasses(e){const i=e.registerRenderPass({name:\"label\",brushes:[t.label],target:()=>this.hasLabels?this.children:null,drawPhase:s.LABEL|s.LABEL_ALPHA}),a=e.registerRenderPass({name:\"geometry\",brushes:[t.fill,t.line,t.marker,t.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.hasEffects,effects:[{apply:e.effects.outsideEffect,enable:()=>this._layerView.hasEffects,args:()=>this._layerView.effectLists.excluded},{apply:e.effects.insideEffect,enable:()=>this._layerView.hasEffects,args:()=>this._layerView.effectLists.included},{apply:e.effects.hittest,enable:()=>!!this._pointToCallbacks.size,args:()=>this._pointToCallbacks}]}),r=e.registerRenderPass({name:\"highlight\",brushes:[t.fill,t.line,t.marker,t.text],target:()=>this.children,drawPhase:s.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:e.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});return[...super.prepareRenderPasses(e),a,r,i]}}export{a as WGLFeatureView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import\"../../../../../core/has.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../../core/urlUtils.js\";import\"../../../../../core/uuid.js\";import\"../../../../../portal/support/resourceExtension.js\";import{create as i}from\"../../../../../geometry/support/aaBoundingRect.js\";import{WGLTile as s}from\"../../../engine/webgl/WGLTile.js\";import{simplifyVVRenderer as r}from\"../support/rendererUtils.js\";import{convertVisualVariables as a}from\"./support/visualVariablesUtils.js\";import l from\"./BaseTileRenderer.js\";import{WGLFeatureView as o}from\"./support/WGLFeatureView.js\";let n=class extends l{install(e){const t=new o(this.tileInfoView,this.layerView,this.layer);this.featuresView=t,e.addChild(t)}uninstall(e){e.removeChild(this.featuresView),this.featuresView.destroy()}hitTest(e,t){return this.featuresView.hitTest(e,t)}supportsRenderer(e){return null!=e&&-1!==[\"simple\",\"class-breaks\",\"unique-value\",\"dot-density\",\"dictionary\"].indexOf(e.type)}onConfigUpdate(e){let t=null;if(\"visualVariables\"in e){const i=(r(e).visualVariables||[]).map((e=>{const t=e.clone();return\"normalizationField\"in e&&(t.normalizationField=null),e.valueExpression&&\"$view.scale\"!==e.valueExpression&&(t.valueExpression=null,t.field=\"nop\"),t}));t=a(i)}this.featuresView.setRendererInfo(e,t,this.layerView.effects)}onTileData(e){const t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileData(t,e.data),this.layerView.view.labelManager.requestUpdate()}onTileError(e){const t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)}forceAttributeTextureUpload(){this.featuresView.attributeView.forceTextureUpload()}lockGPUUploads(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((e=>e.lockUploads()))}unlockGPUUploads(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((e=>e.unlockUploads()))}async getMaterialItems(e){return this.featuresView.getMaterialItems(e)}invalidateLabels(){this.featuresView.hasLabels&&(this.tiles.forEach((e=>e.isDirty=!0)),this.layerView.view.labelManager.requestUpdate())}createTile(e){const t=this.tileInfoView.getTileBounds(i(),e),r=new s(e,t);return this.featuresView.hasLabels&&this.layerView.view.labelManager.addTile(this.layerView,r),r}disposeTile(e){this.featuresView.removeChild(e),this.featuresView.hasLabels&&this.layerView.view.labelManager.removeTile(this.layerView,e.key.id),e.destroy(),this.layerView.view.labelManager.requestUpdate()}};n=e([t(\"esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer\")],n);var u=n;export default u;\n"]}