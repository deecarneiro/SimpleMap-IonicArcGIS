{"version":3,"sources":["./node_modules/@arcgis/core/layers/support/rasterDatasets/RawBlockCache.js","./node_modules/@arcgis/core/layers/support/rasterFunctions/rasterProjectionHelper.js","./node_modules/@arcgis/core/layers/support/rasterDatasets/EphemeralBlockCache.js"],"names":[],"mappings":"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","file":"default~ImageryTileLayer-js~layers-ImageryTileLayerView2D-js-es2015.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import t from\"../../../geometry/Point.js\";import\"../../../geometry.js\";import n from\"./EphemeralBlockCache.js\";import{projectExtent as o,projectResolution as r,snapPyramid as l}from\"../rasterFunctions/rasterProjectionHelper.js\";const c=new Map,a=new n;function i(e,t){return null==t?e:`${e}?sliceId=${t}`}function s(e,t){const n={extent:null,rasterInfo:t,cache:new Map};if(c.has(e)){const t=c.get(e);return t.push(n),t.length-1}return c.set(e,[n]),0}function u(e,t){if(c.has(e)){c.get(e)[t]=null}}function f(e){c.delete(e)}function h(e,t,n){if(!c.has(e))return null==t?a.decreaseRefCount(e,n):0;const o=c.get(e);if(null==o[t])return a.decreaseRefCount(e,n);const r=o[t].cache;if(r.has(n)){const e=r.get(n);if(e.refCount--,0===e.refCount){r.delete(n);for(let e=0;e<o.length;e++)o[e]&&o[e].cache.has(n)&&o[e].cache.delete(n);e.controller&&e.controller.abort()}return e.refCount}return 0}function m(e,t,n){if(!c.has(e))return null==t?a.getBlock(e,n):null;const o=c.get(e);if(null==o[t]){for(let e=0;e<o.length;e++)if(o[e]&&o[e].cache.has(n)){const t=o[e].cache.get(n);return t.refCount++,t.block}return a.getBlock(e,n)}const r=o[t].cache;if(r.has(n)){const e=r.get(n);return e.refCount++,e.block}for(let e=0;e<o.length;e++)if(e!==t&&o[e]&&o[e]&&o[e].cache.has(n)){const t=o[e].cache.get(n);return t.refCount++,r.set(n,t),t.block}return null}function x(e,t,n,o,r=null){if(!c.has(e))return void(null==t&&a.putBlock(e,n,o,r));const l=c.get(e);if(null==l[t])return void a.putBlock(e,n,o,r);const i={refCount:1,block:o,isResolved:!1,isRejected:!1,controller:r};o.then((()=>i.isResolved=!0)).catch((()=>i.isRejected=!0)),l[t].cache.set(n,i)}function d(e,t,n){if(!c.has(e))return void(null==t&&a.deleteBlock(e,n));const o=c.get(e);null!=o[t]?o[t].cache.delete(n):a.deleteBlock(e,n)}function y(n,a,i,s,u,f,h=null){const m=function(e,t){if(!c.has(e))return null;const n=c.get(e);return null==n[t]?null:n[t]}(n,a),x=m.extent,{cache:d,rasterInfo:y}=m;if(x&&x.xmin===i.xmin&&x.xmax===i.xmax&&x.ymin===i.ymin&&x.ymax===i.ymax)return;const g=i.clone().normalize(),{spatialReference:p,transform:k}=y,M=new Set;for(let n=0;n<g.length;n++){const c=g[n];if(c.xmax-c.xmin<=s||c.ymax-c.ymin<=s)continue;let a=o(c,p,h);e(k)&&(a=k.inverseTransform(a));const i=new t({x:s,y:s,spatialReference:c.spatialReference});if(null===u&&!(u=r(i,p,c,h)))return;const{pyramidLevel:m,pyramidResolution:x,excessiveReading:d}=l(u,y,f||\"closest\");if(d)return;const{storageInfo:R}=y,{origin:C}=R,j={x:Math.max(0,Math.floor((a.xmin-C.x)/x.x)),y:Math.max(0,Math.floor((C.y-a.ymax)/x.y))},v=Math.ceil((a.xmax-a.xmin)/x.x-.1),B=Math.ceil((a.ymax-a.ymin)/x.y-.1),b=m>0?R.pyramidBlockWidth:R.blockWidth,w=m>0?R.pyramidBlockHeight:R.blockHeight,$=1,I=Math.max(0,Math.floor(j.x/b)-$),H=Math.max(0,Math.floor(j.y/w)-$),E=Math.floor((j.x+v-1)/b)+$,P=Math.floor((j.y+B-1)/w)+$;for(let e=H;e<=P;e++)for(let t=I;t<=E;t++)M.add(`${m}/${e}/${t}`)}d.forEach(((e,t)=>{if(!M.has(t)){const e=d.get(t);(null==e||e.isResolved||e.isRejected)&&d.delete(t)}})),m.extent={xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax}}export{h as decreaseRefCount,d as deleteBlock,f as deleteRaster,m as getBlock,i as getRasterId,x as putBlock,s as register,u as unregister,y as update};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import{getInfo as n}from\"../../../geometry/support/spatialReferenceUtils.js\";import{project as t}from\"../../../geometry/support/webMercatorUtils.js\";import o from\"../../../geometry/Point.js\";import i from\"../../../geometry/Extent.js\";import\"../../../geometry.js\";import{getMetersPerUnitForSR as r}from\"../../../core/unitUtils.js\";import{isLoaded as a,isSupported as s,load as l,project as c}from\"../../../geometry/projection.js\";const x=function(e,n){const t=(e.isWGS84||e.isWebMercator)&&(n.isWGS84||n.isWebMercator);return!(e.equals(n)||t)},m=32;async function u(){if(a()||!s())return null;await l()}function p(n,o,r,s=null){if(n.spatialReference.equals(o))return n;const l=x(n.spatialReference,o);if(l&&!a())throw new e(\"rasterprojectionhelper-projectResolution\",\"projection engine is not loaded\");const m=r.center,u=new i({xmin:m.x-n.x/2,xmax:m.x+n.x/2,ymin:m.y-n.y/2,ymax:m.y+n.y/2,spatialReference:n.spatialReference}),p=l?c(u,o,s):t(u,o);if(null==p)return null;return{x:p.xmax-p.xmin,y:p.ymax-p.ymin}}function f(e,n=.01){return r(e)?n/r(e):0}function h(o,i,r=null,s=!0){const l=o.spatialReference;if(l.equals(i))return o;const m=x(l,i);if(m&&!a())throw new e(\"rasterprojectionhelper-projectResolution\",\"projection engine is not loaded\");const u=m?c(o,i,r):t(o,i);if(u&&s&&i.isGeographic){var p,h;const[e,t]=l.isWebMercator?n(l).origin:null!=(p=null==(h=n(l))?void 0:h.valid)?p:[],i=f(l);i&&null!=e&&null!=t&&(Math.abs(o.x-e)<i&&Math.abs(180-u.x)<5e-4?u.x-=360:Math.abs(o.x-t)<i&&Math.abs(180+u.x)<5e-4&&(u.x+=360))}return u}function y(i,r,s=null,l=!0){var m,u,p,y;const M=i.spatialReference;if(M.equals(r))return i;const w=x(M,r);if(w&&!a())throw new e(\"rasterprojectionhelper-projectExtent\",\"projection engine is not loaded\");const d=w?c(i,r,s):t(i,r);let[g,j]=null!=(m=null==(u=n(M))?void 0:u.origin)?m:[];if(d&&l&&M.isWebMercator&&r.isGeographic&&null!=g&&null!=j){const e=.001,n=1e3;if(Math.abs(i.xmin-g)<e&&Math.abs(j-i.xmax)>n&&Math.abs(180-d.xmax)<5e-4){d.xmin=-180;const e=[];e.push(new o(i.xmax,i.ymin,M)),e.push(new o(i.xmax,(i.ymin+i.ymax)/2,M)),e.push(new o(i.xmax,i.ymax,M));const n=e.map((e=>h(e,r,s))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));d.xmax=Math.max.apply(null,n)}if(Math.abs(i.xmax-j)<e&&Math.abs(g-i.xmin)>n&&Math.abs(180+d.xmin)<5e-4){d.xmax=180;const e=[];e.push(new o(i.xmin,i.ymin,M)),e.push(new o(i.xmin,(i.ymin+i.ymax)/2,M)),e.push(new o(i.xmin,i.ymax,M));const n=e.map((e=>h(e,r,s))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));d.xmin=Math.min.apply(null,n)}}[g,j]=r.isWebMercator?n(r).origin:null!=(p=null==(y=n(r))?void 0:y.valid)?p:[];const R=f(r);return R&&null!=g&&null!=j&&(Math.abs(d.xmin-g)<R&&(d.xmin=g),Math.abs(d.xmax-j)<R&&(d.xmax=j)),d}function M(t,i,r,s=null,l=null,c=!1,m=[32,32]){var u,p;if(x(t.spatialReference,i.spatialReference)&&!a())throw new e(\"rasterprojectionhelper-projectResolution\",\"projection engine is not loaded\");if(!(t&&i&&r))return null;const{xmin:f,ymin:y,xmax:M,ymax:w}=t,d=t.spatialReference,g=i.spatialReference,[j,R]=null!=(u=null==(p=n(d))?void 0:p.valid)?u:[],b={x:m[0]*r.x,y:m[1]*r.y},v={cols:Math.ceil((M-f)/b.x-.1)+1,rows:Math.ceil((w-y)/b.y-.1)+1},N=b.x,S=b.y,z=[];let W,G=!1;for(let e=0;e<v.cols;e++){const n=[];for(let t=0;t<v.rows;t++){let r=h(new o({x:f+N*e,y:w-S*t,spatialReference:d}),g,s);l&&(r=l.inverseTransform(r)),n.push(r),e>0&&c&&r&&W[t]&&null!=j&&r.x<W[t].x&&(r.x+=R-j),r?(z.push((r.x-i.xmin)/(i.xmax-i.xmin)),z.push((i.ymax-r.y)/(i.ymax-i.ymin))):(z.push(NaN),z.push(NaN),G=!0)}W=n}const P=function(e,n){const t=(e[0]+e[4]+e[4*n.cols]+e[4*n.cols+4])/4,o=(e[1]+e[5]+e[4*n.rows+1]+e[4*n.rows+5])/4;return[Math.abs(t-e[2*n.rows+2]),Math.abs(o-e[2*n.rows+3])]}(z,v),L=new Float32Array((v.cols-1)*(v.rows-1)*2*6),q=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),A=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<v.cols-1;e++){for(let n=0;n<v.rows-1;n++){let t=e*v.rows*2+2*n;const o=z[t],i=z[t+1],r=z[t+2],a=z[t+3];t+=2*v.rows;const s=z[t],l=z[t+1],c=z[t+2],x=z[t+3];let m=0,u=12*(n*(v.cols-1)+e);for(let e=0;e<3;e++)L[u++]=q[m++]*o+q[m++]*r+q[m++]*c;m=0;for(let e=0;e<3;e++)L[u++]=q[m++]*i+q[m++]*a+q[m++]*x;m=0;for(let e=0;e<3;e++)L[u++]=A[m++]*o+A[m++]*s+A[m++]*c;m=0;for(let e=0;e<3;e++)L[u++]=A[m++]*i+A[m++]*l+A[m++]*x}if(G)for(let e=0;e<L.length;e++)isNaN(L[e])&&(L[e]=-1)}return{offsets:z,error:P,coefficients:L,spacing:m,size:[v.cols-1,v.rows-1]}}function w(e,n,t){const i=Math.log(e.x/n.pixelSize.x)/Math.LN2,r=Math.log(e.y/n.pixelSize.y)/Math.LN2,a=n.storageInfo.maximumPyramidLevel||0;let s=\"down\"===t?Math.floor(Math.min(i,r)):\"up\"===t?Math.ceil(Math.max(i,r)):Math.round((i+r)/2),l=!1;s<0?s=0:s>a&&(l=s>a+3,s=a);const c=Math.pow(2,s);return{pyramidLevel:s,pyramidResolution:new o({x:c*n.nativePixelSize.x,y:c*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:l}}function d(e,n,t=512,i=!0){const{extent:a,spatialReference:s,pixelSize:l}=e,c=p(new o({x:l.x,y:l.y,spatialReference:s}),n,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null};const x=(c.x+c.y)/2,m=r(n),u=x*m*96*39.37,f=n.isGeographic?512/t*295828763.7958547:512/t*591657527.591555;let h=!1;if(i&&(n.isGeographic||n.isWebMercator)){const e=y(a,n);h=e.xmin*e.xmax<0}let M,w=u;const d=1.001;if(h){w=f;const e=w/(96*m*39.37);M=p(new o({x:e,y:e,spatialReference:n}),s,a)}else{M={x:l.x,y:l.y};const n=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let t=0;for(;w<.5005*f&&t<n;)t++,w*=2,M.x*=2,M.y*=2;Math.max(w,f)/Math.min(w,f)<=d&&(w=f)}const g=[],j=[],R=Math.min(70.5310735,u)/d;for(;w>=R;)g.push(w),j.push({x:M.x,y:M.y}),w/=2,M.x/=2,M.y/=2;return{projectedPixelSize:c,scales:g,srcResolutions:j}}export{d as computeProjectedScales,m as defaultGridSpacing,M as getProjectionOffsetGrid,u as load,y as projectExtent,h as projectPoint,p as projectResolution,w as snapPyramid};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nexport default class{constructor(t=15e3,e=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,e)}decreaseRefCount(t,e){const s=t+\"/\"+e,r=this._cachedBlocks;if(r.has(s)){const t=r.get(s);return t.refCount--,t.refCount<=0&&(r.delete(s),t.controller&&t.controller.abort()),t.refCount}return 0}getBlock(t,e){const s=t+\"/\"+e,r=this._cachedBlocks;if(r.has(s)){const t=r.get(s);return t.ts=Date.now(),t.refCount++,r.delete(s),r.set(s,t),t.block}return null}putBlock(t,e,s,r=null){const i=this._cachedBlocks,c=t+\"/\"+e;if(i.has(c)){const t=i.get(c);t.ts=Date.now(),t.refCount++}else i.set(c,{block:s,ts:Date.now(),refCount:1,controller:r});this.trim(),this.updateTimer()}deleteBlock(t,e){const s=this._cachedBlocks,r=t+\"/\"+e;s.has(r)&&s.delete(r)}updateMaxSize(t){this._size=t,this.trim()}empty(){this._cachedBlocks.clear(),this.clearTimer()}getCurrentSize(){return this._cachedBlocks.size}updateTimer(){if(null!=this._timer)return;const t=this._cachedBlocks;this._timer=setInterval((()=>{const e=Array.from(t),s=Date.now();for(let r=0;r<e.length&&e[r][1].ts<=s-this._duration;r++)t.delete(e[r][0]);0===t.size&&this.clearTimer()}),this._interval)}trim(){const t=this._cachedBlocks;if(-1===this._size||this._size>=t.size)return;const e=Array.from(t);for(let s=0;s<e.length-this._size;s++)t.delete(e[s][0])}clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}\n"],"sourceRoot":"webpack:///"}