(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["renderers-DictionaryRenderer-js"],{

/***/ "JhoD":
/*!*******************************************************************!*\
  !*** ./node_modules/@arcgis/core/renderers/DictionaryRenderer.js ***!
  \*******************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../chunks/tslib.es6.js */ "pO5D");
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../core/has.js */ "wSAH");
/* harmony import */ var _core_lang_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../core/lang.js */ "f/qv");
/* harmony import */ var _core_maybe_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../core/maybe.js */ "srIe");
/* harmony import */ var _core_string_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../core/string.js */ "s7YA");
/* harmony import */ var _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../core/Logger.js */ "6S2I");
/* harmony import */ var _core_accessorSupport_ensureType_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../core/accessorSupport/ensureType.js */ "zqDF");
/* harmony import */ var _core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../core/accessorSupport/decorators/property.js */ "WbKI");
/* harmony import */ var _core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../core/accessorSupport/decorators/subclass.js */ "04ZG");
/* harmony import */ var _core_accessorSupport_decorators_writer_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../core/accessorSupport/decorators/writer.js */ "Cduq");
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../core/Error.js */ "zlDU");
/* harmony import */ var _core_urlUtils_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../core/urlUtils.js */ "4EHJ");
/* harmony import */ var _core_uuid_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../core/uuid.js */ "ju1D");
/* harmony import */ var _portal_support_resourceExtension_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../portal/support/resourceExtension.js */ "9AIY");
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../support/arcadeOnDemand.js */ "gvqN");
/* harmony import */ var _layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../layers/support/fieldUtils.js */ "wdpY");
/* harmony import */ var _Color_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../Color.js */ "nvBr");
/* harmony import */ var _symbols_CIMSymbol_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../symbols/CIMSymbol.js */ "TKwc");
/* harmony import */ var _request_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../request.js */ "Lqtk");
/* harmony import */ var _Renderer_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./Renderer.js */ "ZnuT");
/* harmony import */ var _mixins_VisualVariablesMixin_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./mixins/VisualVariablesMixin.js */ "vk02");
/* harmony import */ var _core_LRUCache_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../core/LRUCache.js */ "wk6I");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
var w;const x=_core_Logger_js__WEBPACK_IMPORTED_MODULE_5__["default"].getLogger("esri.renderers.DictionaryRenderer");let v=w=class extends(Object(_mixins_VisualVariablesMixin_js__WEBPACK_IMPORTED_MODULE_21__["VisualVariablesMixin"])(_Renderer_js__WEBPACK_IMPORTED_MODULE_20__["default"])){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new _core_LRUCache_js__WEBPACK_IMPORTED_MODULE_22__["default"](100),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}writeData(e,s){e&&(s.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,s,t,r){null!=r&&r.origin||super.writeVisualVariables(e,s,t,r)}clone(){return new w({config:Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_2__["clone"])(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_2__["clone"])(this.fieldMap),url:Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_2__["clone"])(this.url),visualVariables:Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_2__["clone"])(this.visualVariables)})}async getSymbolAsync(e,s){let t;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(s));try{t=await this._dictionaryPromise}catch(e){if(Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_14__["isAbortError"])(e))return this._dictionaryPromise=null,null}const i={};if(this.fieldMap)for(const s of this._symbolFields){const t=this.fieldMap[s];if(t&&null!==e.attributes[t]&&void 0!==e.attributes[t]){const r=""+e.attributes[t];i[s]=r}else i[s]=""}const o=t(i,s);if(!o||"string"!=typeof o)return null;const n=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__["numericHash"])(o).toString(),a=this._symbolCache.get(n);if(a)return a.catch((()=>{this._symbolCache.pop(n)})),a;const l=o.split(";"),p=[],u=[];for(const e of l)if(e&&0!==e.length)if(-1===e.indexOf("po:"))if(-1!==e.indexOf("|"))for(const s of e.split("|"))this._itemNames.has(s)&&p.push(s);else this._itemNames.has(e)&&p.push(e);else{const s=e.substr(3).split("|");if(3===s.length){const e=s[0],t=s[1];let r=s[2];if("DashTemplate"===t)r=r.split(" ").map((e=>Number(e)));else if("Color"===t){const e=new _Color_js__WEBPACK_IMPORTED_MODULE_17__["default"](r).toRgba();r=[e[0],e[1],e[2],255*e[3]]}else r=Number(r);u.push({primitiveName:e,propertyName:t,value:r})}}const m=this._cimPartsToCIMSymbol(p,u,s);return this._symbolCache.put(n,m,1),m}async collectRequiredFields(e,s){await this.collectVVRequiredFields(e,s),this.scaleExpression&&await Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_16__["collectArcadeFieldNames"])(e,s,this.scaleExpression);const t=s.map((e=>e.name));for(const s in this.fieldMap)t.indexOf(this.fieldMap[s])<0||e.add(this.fieldMap[s])}get arcadeRequired(){return!0}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void x.error("no valid URL!");const s=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__["isSome"])(e)?e.abortOptions:null,r=Object(_request_js__WEBPACK_IMPORTED_MODULE_19__["default"])(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},...s}),[{data:i}]=await Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_14__["all"])([r,Object(_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_15__["loadArcade"])()]);if(!i)throw this._dictionaryPromise=null,new _core_Error_js__WEBPACK_IMPORTED_MODULE_10__["default"]("esri.renderers.DictionaryRenderer","Bad dictionary data!");const o=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=n.symbol;const a={};if(this.config){const e=this.config;for(const s in e)a[s]=e[s]}for(const e of n.configuration)a.hasOwnProperty(e.name)||(a[e.name]=e.value);const c=[];if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__["isSome"])(e)&&e.fields&&this.fieldMap)for(const s of this._symbolFields){const t=this.fieldMap[s],r=e.fields.filter((e=>e.name===t));r.length>0&&c.push({...r[0],name:s})}return this._dictionaryPromise=Object(_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_15__["createDictionaryExpression"])(o,Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__["isSome"])(e)?e.spatialReference:null,c,a).then((e=>{const s={scale:0};return(r,i)=>{const o=e.repurposeFeature({geometry:null,attributes:r});return s.scale=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__["isSome"])(i)?i.scale:void 0,e.evaluate({$feature:o,$view:s})}})).catch((e=>(x.error("Creating dictinoary expression failed:",e),null))),this._dictionaryPromise}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,s)=>e+s.getAttributeHash()),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._symbolFields}async _getSymbolPart(e,s){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const t=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),r=Object(_request_js__WEBPACK_IMPORTED_MODULE_19__["default"])(t,{responseType:"json",query:{f:"json"},...s});this._ongoingRequests.set(e,r);try{return(await r).data}catch(s){return this._ongoingRequests.delete(e),Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_14__["reject"])(s)}}_combineSymbolParts(e,s){if(!e||0===e.length)return null;if(1===e.length)return{type:"CIMSymbolReference",symbol:e[0],primitiveOverrides:s};const t={...e[0]};t.symbolLayers=[];for(const s of e){const e=s;t.symbolLayers.unshift(...e.symbolLayers)}return{type:"CIMSymbolReference",symbol:t,primitiveOverrides:s}}async _cimPartsToCIMSymbol(e,s,t){const r=new Array(e.length);for(let s=0;s<e.length;s++)r[s]=this._getSymbolPart(e[s],t);const i=await Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_14__["all"])(r);return new _symbols_CIMSymbol_js__WEBPACK_IMPORTED_MODULE_18__["default"]({data:this._combineSymbolParts(i,s)})}};Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__["property"])({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],v.prototype,"config",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__["property"])({type:Object,json:{write:!0}})],v.prototype,"fieldMap",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__["property"])({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],v.prototype,"scaleExpression",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_writer_js__WEBPACK_IMPORTED_MODULE_9__["writer"])("scaleExpression")],v.prototype,"writeData",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__["property"])({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],v.prototype,"scaleExpressionTitle",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__["property"])({type:String,json:{write:!0}})],v.prototype,"url",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_writer_js__WEBPACK_IMPORTED_MODULE_9__["writer"])("visualVariables")],v.prototype,"writeVisualVariables",null),v=w=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__["subclass"])("esri.renderers.DictionaryRenderer")],v);var S=v;/* harmony default export */ __webpack_exports__["default"] = (S);


/***/ })

}]);
//# sourceMappingURL=renderers-DictionaryRenderer-js-es2015.js.map