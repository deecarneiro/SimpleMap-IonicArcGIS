{"version":3,"sources":["./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js","./node_modules/@arcgis/core/views/2d/layers/KMLLayerView2D.js"],"names":[],"mappings":"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","file":"layers-KMLLayerView2D-js-es2015.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isNone as n}from\"../../core/maybe.js\";import t from\"../Extent.js\";import{create as r}from\"./aaBoundingRect.js\";function i(n=D){return[n[0],n[1],n[2],n[3],n[4],n[5]]}function a(n,t,r,a,u,e,m=i()){return m[0]=n,m[1]=t,m[2]=r,m[3]=a,m[4]=u,m[5]=e,m}function u(n,t=i()){return t[0]=n.xmin,t[1]=n.ymin,t[2]=n.zmin,t[3]=n.xmax,t[4]=n.ymax,t[5]=n.zmax,t}function e(n,r){const i=isFinite(n[2])||isFinite(n[5]);return new t(i?{xmin:n[0],xmax:n[3],ymin:n[1],ymax:n[4],zmin:n[2],zmax:n[5],spatialReference:r}:{xmin:n[0],xmax:n[3],ymin:n[1],ymax:n[4],spatialReference:r})}function m(n,t,r=i()){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r}function o(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.min(n[2],t[2]),n[3]=Math.max(n[3],t[3]),n[4]=Math.max(n[4],t[4]),n[5]=Math.max(n[5],t[5])}function f(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[3]=Math.max(n[3],t[2]),n[4]=Math.max(n[4],t[3])}function h(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.min(n[2],t[2]),n[3]=Math.max(n[3],t[0]),n[4]=Math.max(n[4],t[1]),n[5]=Math.max(n[5],t[2])}function c(n,t,r=0,i=t.length/3){let a=n[0],u=n[1],e=n[2],m=n[3],o=n[4],f=n[5];for(let n=0;n<i;n++)a=Math.min(a,t[r+3*n]),u=Math.min(u,t[r+3*n+1]),e=Math.min(e,t[r+3*n+2]),m=Math.max(m,t[r+3*n]),o=Math.max(o,t[r+3*n+1]),f=Math.max(f,t[r+3*n+2]);n[0]=a,n[1]=u,n[2]=e,n[3]=m,n[4]=o,n[5]=f}function M(n,t,r,i){n[0]=Math.min(n[0],n[0]+t),n[3]=Math.max(n[3],n[3]+t),n[1]=Math.min(n[1],n[1]+r),n[4]=Math.max(n[4],n[4]+r),n[2]=Math.min(n[2],n[2]+i),n[5]=Math.max(n[5],n[5]+i)}function x(n,t,r){const i=t.length;let a=n[0],u=n[1],e=n[2],m=n[3],o=n[4],f=n[5];if(r)for(let n=0;n<i;n++){const r=t[n];a=Math.min(a,r[0]),u=Math.min(u,r[1]),e=Math.min(e,r[2]),m=Math.max(m,r[0]),o=Math.max(o,r[1]),f=Math.max(f,r[2])}else for(let n=0;n<i;n++){const r=t[n];a=Math.min(a,r[0]),u=Math.min(u,r[1]),m=Math.max(m,r[0]),o=Math.max(o,r[1])}n[0]=a,n[1]=u,n[2]=e,n[3]=m,n[4]=o,n[5]=f}function s(n){for(let t=0;t<6;t++)if(!isFinite(n[t]))return!1;return!0}function l(n){return n[0]>=n[3]?0:n[3]-n[0]}function I(n){return n[1]>=n[4]?0:n[4]-n[1]}function y(n){return n[2]>=n[5]?0:n[5]-n[2]}function N(n){const t=l(n),r=y(n),i=I(n);return Math.sqrt(t*t+r*r+i*i)}function g(n,t=[0,0,0]){return t[0]=n[0]+l(n)/2,t[1]=n[1]+I(n)/2,t[2]=n[2]+y(n)/2,t}function p(n,t=[0,0,0]){return t[0]=l(n),t[1]=I(n),t[2]=y(n),t}function F(n){return Math.max(l(n),y(n),I(n))}function z(n,t){return t[0]>=n[0]&&t[1]>=n[1]&&t[2]>=n[2]&&t[0]<=n[3]&&t[1]<=n[4]&&t[2]<=n[5]}function E(n,t,r){return t[0]>=n[0]-r&&t[1]>=n[1]-r&&t[2]>=n[2]-r&&t[0]<=n[3]+r&&t[1]<=n[4]+r&&t[2]<=n[5]+r}function T(n,t){return t[0]>=n[0]&&t[1]>=n[1]&&t[2]>=n[2]&&t[3]<=n[3]&&t[4]<=n[4]&&t[5]<=n[5]}function b(n,t){return Math.max(t[0],n[0])<=Math.min(t[3],n[3])&&Math.max(t[1],n[1])<=Math.min(t[4],n[4])&&Math.max(t[2],n[2])<=Math.min(t[5],n[5])}function j(t,r){return!!n(r)||b(t,r)}function R(n,t,r,i,a=n){return a[0]=n[0]+t,a[1]=n[1]+r,a[2]=n[2]+i,a[3]=n[3]+t,a[4]=n[4]+r,a[5]=n[5]+i,a}function V(n,t,r=n){const i=n[0]+l(n)/2,a=n[1]+I(n)/2,u=n[2]+y(n)/2;return r[0]=i+(n[0]-i)*t,r[1]=a+(n[1]-a)*t,r[2]=u+(n[2]-u)*t,r[3]=i+(n[3]-i)*t,r[4]=a+(n[4]-a)*t,r[5]=u+(n[5]-u)*t,r}function Y(n,t){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function _(n,t){return t[0]=n[3],t[1]=n[4],t[2]=n[5],t}function d(n,t,r=n){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==n&&(r[3]=n[3],r[4]=n[4],r[5]=n[5]),r}function q(n,t,r=n){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==n&&(r[0]=n[0],r[1]=n[1],r[2]=n[2]),n}function w(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function A(n){return n?w(n,C):i(C)}function B(n,t){return t||(t=r()),t[0]=n[0],t[1]=n[1],t[2]=n[3],t[3]=n[4],t}function G(n,t){return n[0]=t[0],n[1]=t[1],n[2]=Number.NEGATIVE_INFINITY,n[3]=t[2],n[4]=t[3],n[5]=Number.POSITIVE_INFINITY,n}function O(n){return 6===n.length}function P(n){return 0===l(n)&&0===I(n)&&0===y(n)}function S(t,r,i){if(n(t)||n(r))return t===r;if(!O(t)||!O(r))return!1;if(i){for(let n=0;n<t.length;n++)if(!i(t[n],r[n]))return!1}else for(let n=0;n<t.length;n++)if(t[n]!==r[n])return!1;return!0}function k(n,t,r,i,u,e){return a(n,t,r,i,u,e,H)}const v=[-1/0,-1/0,-1/0,1/0,1/0,1/0],C=[1/0,1/0,1/0,-1/0,-1/0,-1/0],D=[0,0,0,0,0,0],H=i();export{C as NEGATIVE_INFINITY,v as POSITIVE_INFINITY,D as ZERO,s as allFinite,g as center,T as contains,z as containsPoint,E as containsPointWithMargin,i as create,I as depth,N as diameter,A as empty,S as equals,o as expandWithAABB,c as expandWithBuffer,x as expandWithNestedArray,M as expandWithOffset,f as expandWithRect,h as expandWithVec3,u as fromExtent,m as fromMinMax,G as fromRect,a as fromValues,_ as getMax,Y as getMin,y as height,b as intersects,j as intersectsClippingArea,O as is,P as isPoint,F as maximumDimension,R as offset,V as scale,w as set,q as setMax,d as setMin,p as size,e as toExtent,B as toRect,l as width,k as wrap};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{resolve as t,all as o,create as r}from\"../../../core/promiseUtils.js\";import{schedule as l}from\"../../../core/scheduling.js\";import{canProject as a,project as n}from\"../../../geometry/support/webMercatorUtils.js\";import h from\"../../../geometry/Extent.js\";import p from\"../../../core/Collection.js\";import c from\"../../../request.js\";import m from\"../../../core/Handles.js\";import{whenTrueOnce as d}from\"../../../core/watchUtils.js\";import{GraphicsCollection as y}from\"../../../support/GraphicsCollection.js\";import{fetchService as w,parseKML as _,getGraphics as g}from\"../../../layers/support/kmlUtils.js\";import u from\"../../layers/LayerView.js\";import V from\"./graphics/GraphicsView2D.js\";import{Bitmap as f}from\"../engine/Bitmap.js\";import{BitmapContainer as v}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as b}from\"./LayerView2D.js\";let C=class extends(b(u)){constructor(){super(...arguments),this._handles=new m,this._bitmapIndex=new Map,this._mapImageContainer=new v,this._featuresMap=new Map,this.allVisiblePoints=new y,this.allVisiblePolylines=new y,this.allVisiblePolygons=new y,this.allVisibleMapImages=new p}hitTest(e,i){if(this.suspended||!this._pointsView&&!this._polylinesView&&!this._polygonsView)return t(null);const s=[this._pointsView.hitTest(e,i),this._polylinesView.hitTest(e,i),this._polygonsView.hitTest(e,i)];return o(s).then((e=>e.filter((e=>(e&&(e.layer=this.layer,e.sourceLayer=this.layer),!!e)))[0]||null))}update(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}attach(){this._handles.add([this.allVisibleMapImages.on(\"change\",(e=>{e.added.forEach((e=>this._addMapImage(e))),e.removed.forEach((e=>this._removeMapImage(e)))}))]),this.container.addChild(this._mapImageContainer),this._polygonsView=new V({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate()}),this.container.addChild(this._polygonsView.container),this._polylinesView=new V({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate()}),this.container.addChild(this._polylinesView.container),this._pointsView=new V({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate()}),this.container.addChild(this._pointsView.container),this.watch(\"layer.visibleSublayers\",(()=>this._refreshCollections())),this._fetchingPromise=this._fetchService().then((()=>{this._fetchingPromise=null,this.notifyChange(\"updating\")}))}detach(){this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return null!=this._fetchingPromise||this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(e){(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&c(e.href,{responseType:\"image\"}).then((({data:i})=>{let s=h.fromJSON(e.extent);a(s,this.view.spatialReference)&&(s=n(s,this.view.spatialReference));const t=new f(i);t.x=s.xmin,t.y=s.ymax,t.resolution=s.width/i.naturalWidth,t.rotation=e.rotation,this._mapImageContainer.addChild(t),this._bitmapIndex.set(e,t)}))}_fetchService(){return this._handles.remove(\"refresh-collections\"),this._getParsedKML().then((e=>this._fetchSublayerService(this.layer,e)))}_fetchSublayerService(e,i){const s=e.sublayers;if(!s||0===s.length)return t();const a=[];return s.forEach((e=>{const s=d(e,\"visible\").then((()=>e.load())).then((()=>this._getGraphicsForSublayer(e,i))).then((i=>r((s=>{e.networkLink?s():(this._featuresMap.set(e,i),this._handles.add(l((()=>{this._refreshCollections(),s()})),\"refresh-collections\"))})))).then((()=>this._fetchSublayerService(e,e.sourceJSON||i)));e.visible&&a.push(s)})),o(a).then((()=>{}))}_getParsedKML(){return w(this.layer.url,this.view.spatialReference,this.layer.refreshInterval).then((e=>_(e.data)))}async _getGraphicsForSublayer(e,i){let s=null;return i.sublayers.some((i=>(s=i,i.id===e.id)))?{points:s.points&&await g(s.points),polylines:s.polylines&&await g(s.polylines),polygons:s.polygons&&await g(s.polygons),mapImages:s.mapImages}:null}_refreshCollections(){const e=this.get(\"layer.visibleSublayers\");this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),e&&e.length&&e.forEach((e=>{const i=this._featuresMap.get(e);i&&(this.allVisiblePoints.addMany(i.points),this.allVisiblePolylines.addMany(i.polylines),this.allVisiblePolygons.addMany(i.polygons),this.allVisibleMapImages.addMany(i.mapImages))}))}_removeMapImage(e){const i=this._bitmapIndex.get(e);i&&(this._mapImageContainer.removeChild(i),this._bitmapIndex.delete(e))}};e([i()],C.prototype,\"_pointsView\",void 0),e([i()],C.prototype,\"_polylinesView\",void 0),e([i()],C.prototype,\"_polygonsView\",void 0),e([i()],C.prototype,\"_fetchingPromise\",void 0),e([i({dependsOn:[\"_fetchingPromise\",\"_pointsView.updating\",\"_polygonsView.updating\",\"_polylinesView.updating\"]})],C.prototype,\"updating\",void 0),C=e([s(\"esri.views.2d.layers.KMLLayerView2D\")],C);var j=C;export default j;\n"],"sourceRoot":"webpack:///"}