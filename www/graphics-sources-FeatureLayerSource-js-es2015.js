(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["graphics-sources-FeatureLayerSource-js"],{

/***/ "DlAm":
/*!*********************************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/graphics/sources/FeatureLayerSource.js ***!
  \*********************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../chunks/tslib.es6.js */ "pO5D");
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../core/has.js */ "wSAH");
/* harmony import */ var _core_lang_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../core/lang.js */ "f/qv");
/* harmony import */ var _core_object_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../core/object.js */ "nR38");
/* harmony import */ var _core_maybe_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../core/maybe.js */ "srIe");
/* harmony import */ var _core_Logger_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../core/Logger.js */ "6S2I");
/* harmony import */ var _core_accessorSupport_ensureType_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../core/accessorSupport/ensureType.js */ "zqDF");
/* harmony import */ var _core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../core/accessorSupport/decorators/property.js */ "WbKI");
/* harmony import */ var _core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../core/accessorSupport/decorators/subclass.js */ "04ZG");
/* harmony import */ var _core_Error_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../core/Error.js */ "zlDU");
/* harmony import */ var _core_urlUtils_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../core/urlUtils.js */ "4EHJ");
/* harmony import */ var _core_uuid_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../core/uuid.js */ "ju1D");
/* harmony import */ var _portal_support_resourceExtension_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../portal/support/resourceExtension.js */ "9AIY");
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../geometry/Extent.js */ "OvF4");
/* harmony import */ var _request_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../request.js */ "Lqtk");
/* harmony import */ var _core_Loadable_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../core/Loadable.js */ "bV/r");
/* harmony import */ var _TimeExtent_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../TimeExtent.js */ "ZYtI");
/* harmony import */ var _tasks_operations_zscale_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../tasks/operations/zscale.js */ "kUx5");
/* harmony import */ var _tasks_operations_queryAttachments_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../tasks/operations/queryAttachments.js */ "Xzbc");
/* harmony import */ var _tasks_QueryTask_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../tasks/QueryTask.js */ "/uz8");
/* harmony import */ var _support_clientSideDefaults_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./support/clientSideDefaults.js */ "iNG6");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
const q=new Set(["Feature Layer","Table"]);let I=class extends _core_Loadable_js__WEBPACK_IMPORTED_MODULE_16__["default"]{constructor(){super(...arguments),this.type="feature-layer"}load(e){const t=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__["isSome"])(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_13__["resolve"])(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:r,dynamicDataSource:a,gdbVersion:s,spatialReference:o,fieldsIndex:i}=this.layer,u=Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__["default"])("featurelayer-pbf")&&e?"pbf":"json";return new _tasks_QueryTask_js__WEBPACK_IMPORTED_MODULE_20__["default"]({url:r.path,format:u,fieldsIndex:i,dynamicDataSource:a,gdbVersion:s,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+"/"+r+"/addAttachment",s=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,s.query);try{const e=await Object(_request_js__WEBPACK_IMPORTED_MODULE_15__["default"])(a,{body:o});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}async updateAttachment(e,t,r){await this.load();const a=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+a+"/updateAttachment",o=this._getLayerRequestOptions({query:{attachmentId:t}}),i=this._getFormDataForAttachment(r,o.query);try{const e=await Object(_request_js__WEBPACK_IMPORTED_MODULE_15__["default"])(s,{body:i});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(a,e)}}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),a=e.updateFeatures.map(this._serializeFeature,this),s=this._getFeatureIds(e.deleteFeatures);Object(_tasks_operations_zscale_js__WEBPACK_IMPORTED_MODULE_18__["unapplyEditsZUnitScaling"])(r,a,this.layer.spatialReference);const o=[],i=[],u=[...e.deleteAttachments];for(const t of e.addAttachments)o.push(await this._serializeAttachment(t));for(const t of e.updateAttachments)i.push(await this._serializeAttachment(t));const n=o.length||i.length||u.length?{adds:o,updates:i,deletes:u}:null,l=this._getLayerRequestOptions({method:"post",query:{adds:r.length?JSON.stringify(r):null,updates:a.length?JSON.stringify(a):null,deletes:s.length?s.join(","):null,gdbVersion:null==t?void 0:t.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:n&&JSON.stringify(n)}}),d=await Object(_request_js__WEBPACK_IMPORTED_MODULE_15__["default"])(this.layer.parsedUrl.path+"/applyEdits",l);return this._createEditsResult(d)}async deleteAttachments(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+"/"+r+"/deleteAttachments";try{return(await Object(_request_js__WEBPACK_IMPORTED_MODULE_15__["default"])(a,this._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:a}=this.layer,{data:s}=await Object(_request_js__WEBPACK_IMPORTED_MODULE_15__["default"])(`${a}/${r}`,t),{id:o,extent:i,fullExtent:u,timeExtent:n}=s,l=i||u;return{id:o,fullExtent:l&&_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_14__["default"].fromJSON(l),timeExtent:n&&_TimeExtent_js__WEBPACK_IMPORTED_MODULE_17__["default"].fromJSON({start:n[0],end:n[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,a=r.path;await this.load();const s=this._getLayerRequestOptions(t);if(!this.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:t}=e,r=[];for(const e of t){const t=a+"/"+e+"/attachments";r.push(Object(_request_js__WEBPACK_IMPORTED_MODULE_15__["default"])(t,s))}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_13__["all"])(r).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>Object(_tasks_operations_queryAttachments_js__WEBPACK_IMPORTED_MODULE_19__["processAttachmentQueryResult"])(e,a)))}return this.queryTask.executeAttachmentQuery(e,s)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async _fetchService(e){let r=this.layer.sourceJSON;if(!r){const{data:a}=await Object(_request_js__WEBPACK_IMPORTED_MODULE_15__["default"])(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__["default"])("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:e}));r=a}this.sourceJSON=this._patchServiceJSON(r);const a=r.type;if(!q.has(a))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_9__["default"]("feature-layer-source:unsupported-type",`Source type "${a}" is not supported`)}_patchServiceJSON(e){var t;if("Table"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=Object(_support_clientSideDefaults_js__WEBPACK_IMPORTED_MODULE_21__["createDrawingInfo"])(e.geometryType).renderer;Object(_core_object_js__WEBPACK_IMPORTED_MODULE_3__["setDeepValue"])("drawingInfo.renderer",t,e)}return e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__["isNone"])(t)?{attributes:r}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:a,name:s,contentType:o,data:i,uploadId:u}=r,n={globalId:a,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(n.parentGlobalId="attributes"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),u)n.uploadId=u;else if(i){const e=await async function(e){if("string"==typeof e){return Object(_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_10__["dataComponents"])(e)||{data:e}}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_13__["create"])(((t,r)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(Object(_core_urlUtils_js__WEBPACK_IMPORTED_MODULE_10__["dataComponents"])(a.result)),a.onerror=e=>r(e)}))}(i);n.contentType=e.mediaType,n.data=e.data,i instanceof File&&(n.name=i.name)}return s&&(n.name=s),o&&(n.contentType=o),n}_getFeatureIds(e){const t=e[0];return t?"objectId"in t?this._getIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_getIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new _core_Error_js__WEBPACK_IMPORTED_MODULE_9__["default"]("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,a=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new _core_Error_js__WEBPACK_IMPORTED_MODULE_9__["default"]("feature-layer-source:attachment-failure",r,{code:a})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const a=t[e];null!=a&&(r.set?r.set(e,a):r.append(e,a))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:a,dynamicDataSource:s}=this.layer;return{...e,query:Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_2__["fixJson"])({gdbVersion:a,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:"json",...this.layer.customParameters,...null==e?void 0:e.query}),responseType:"json"}}};Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__["property"])()],I.prototype,"type",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__["property"])({constructOnly:!0})],I.prototype,"layer",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__["property"])({readOnly:!0,dependsOn:["layer.parsedUrl","layer.gdbVersion","layer.dynamicDataSource","layer.fieldsIndex"]})],I.prototype,"queryTask",null),I=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__["_"])([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__["subclass"])("esri.layers.graphics.sources.FeatureLayerSource")],I);var _=I;/* harmony default export */ __webpack_exports__["default"] = (_);


/***/ }),

/***/ "iNG6":
/*!*****************************************************************************************!*\
  !*** ./node_modules/@arcgis/core/layers/graphics/sources/support/clientSideDefaults.js ***!
  \*****************************************************************************************/
/*! exports provided: createDefaultAttributesFunction, createDefaultTemplate, createDrawingInfo */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createDefaultAttributesFunction", function() { return s; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createDefaultTemplate", function() { return u; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createDrawingInfo", function() { return i; });
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../core/has.js */ "wSAH");
/* harmony import */ var _core_lang_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../core/lang.js */ "f/qv");
/* harmony import */ var _symbols_support_defaultsJSON_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../symbols/support/defaultsJSON.js */ "gkbi");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function i(t){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?_symbols_support_defaultsJSON_js__WEBPACK_IMPORTED_MODULE_2__["defaultPointSymbolJSON"]:"esriGeometryPolyline"===t?_symbols_support_defaultsJSON_js__WEBPACK_IMPORTED_MODULE_2__["defaultPolylineSymbolJSON"]:_symbols_support_defaultsJSON_js__WEBPACK_IMPORTED_MODULE_2__["defaultPolygonSymbolJSON"]}}}function s(r,e){if(Object(_core_has_js__WEBPACK_IMPORTED_MODULE_0__["default"])("csp-restrictions"))return()=>({[e]:null,...r});try{let t=`this.${e} = null;`;for(const e in r){t+=`this${e.indexOf(".")?`["${e}"]`:`.${e}`} = ${JSON.stringify(r[e])};`}const n=new Function(t);return()=>new n}catch(t){return()=>({[e]:null,...r})}}function u(t={}){return[{name:"New Feature",description:"",prototype:{attributes:Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_1__["clone"])(t)}}]}


/***/ })

}]);
//# sourceMappingURL=graphics-sources-FeatureLayerSource-js-es2015.js.map