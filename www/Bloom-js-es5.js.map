{"version":3,"sources":["webpack:///node_modules/@arcgis/core/views/2d/engine/webgl/effects/post-processing/Bloom.js"],"names":["e","s","r","o","n","_intensityFBO","_compositeFBO","_mipsFBOs","Array","_nMips","_kernelSizeArray","_size","_programDesc","luminosityHighPass","vsPath","fsPath","attributes","a_position","gaussianBlur","composite","blit","_quad","dispose","t","horizontal","vertical","a","h","width","l","height","u","context","p","painter","m","materialManager","d","gl","c","_","strength","g","radius","f","threshold","_createOrResizeResources","setStencilTestEnabled","setBlendingEnabled","setBlendFunction","setStencilWriteMask","b","bind","bindFramebuffer","F","getProgram","bindProgram","bindTexture","colorTexture","setUniform1i","setUniform3fv","setUniform1f","B","Math","round","setViewport","setClearColor","clear","COLOR_BUFFER_BIT","draw","O","i","name","value","setUniform2fv","T","setUniform1fv","x","unbind","resize","colorTarget","depthStencilTarget","target","pixelFormat","internalFormat","dataType","wrapMode","samplingMode","flipped"],"mappings":"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","file":"Bloom-js-es5.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport\"../../../../../../core/has.js\";import\"../../../../../../core/mathUtils.js\";import\"../../../../../../chunks/builtins.js\";import t from\"../../../../../webgl/FramebufferObject.js\";import\"../../../../../webgl/RenderingContext.js\";import i from\"../../VertexStream.js\";const e=[1,0],s=[0,1],r=[1,.8,.6,.4,.2],o=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];class n{constructor(){this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/bloom/luminosityHighPass\",attributes:{a_position:0}},gaussianBlur:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/bloom/gaussianBlur\",attributes:{a_position:0}},composite:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/bloom/composite\",attributes:{a_position:0}},blit:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/blit\",attributes:{a_position:0}}}}dispose(){if(this._quad&&(this._quad.dispose(),this._quad=null),this._intensityFBO&&(this._intensityFBO.dispose(),this._intensityFBO=null),this._compositeFBO&&(this._compositeFBO.dispose(),this._compositeFBO=null),this._mipsFBOs){for(let t=0;t<this._nMips;t++)this._mipsFBOs[t]&&(this._mipsFBOs[t].horizontal.dispose(),this._mipsFBOs[t].vertical.dispose());this._mipsFBOs=null}}draw(t,n,a){const{width:h,height:l}=n,{context:u,painter:p}=t,{materialManager:m}=p,d=u.gl,c=this._programDesc,{strength:_,radius:g,threshold:f}=a;this._quad||(this._quad=new i(u,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(t,h,l),u.setStencilTestEnabled(!1),u.setBlendingEnabled(!0),u.setBlendFunction(1,771),u.setStencilWriteMask(0);const b=this._quad;b.bind(),u.bindFramebuffer(this._intensityFBO);const F=m.getProgram(t,c.luminosityHighPass);u.bindProgram(F),u.bindTexture(n.colorTexture,0),F.setUniform1i(\"u_texture\",0),F.setUniform3fv(\"u_defaultColor\",[0,0,0]),F.setUniform1f(\"u_defaultOpacity\",0),F.setUniform1f(\"u_luminosityThreshold\",f),F.setUniform1f(\"u_smoothWidth\",.01);const B=[Math.round(h/2),Math.round(l/2)];u.setViewport(0,0,B[0],B[1]),u.setClearColor(0,0,0,0),u.clear(d.COLOR_BUFFER_BIT),b.draw(),u.setBlendingEnabled(!1);let O=this._intensityFBO.colorTexture;for(let i=0;i<this._nMips;i++){const r=m.getProgram(t,c.gaussianBlur,[{name:\"radius\",value:this._kernelSizeArray[i]}]);u.bindProgram(r),u.bindTexture(O,i+1),r.setUniform1i(\"u_colorTexture\",i+1),r.setUniform2fv(\"u_texSize\",B),r.setUniform2fv(\"u_direction\",e),u.setViewport(0,0,B[0],B[1]);const o=this._mipsFBOs[i];u.bindFramebuffer(o.horizontal),b.draw(),O=o.horizontal.colorTexture,u.bindFramebuffer(o.vertical),u.bindTexture(O,i+1),r.setUniform2fv(\"u_direction\",s),b.draw(),O=o.vertical.colorTexture,B[0]=Math.round(B[0]/2),B[1]=Math.round(B[1]/2)}u.setViewport(0,0,h,l);const T=m.getProgram(t,c.composite,[{name:\"nummips\",value:5}]);u.bindFramebuffer(this._compositeFBO),u.bindProgram(T),T.setUniform1f(\"u_bloomStrength\",_),T.setUniform1f(\"u_bloomRadius\",g),T.setUniform1fv(\"u_bloomFactors\",r),T.setUniform3fv(\"u_bloomTintColors\",o),u.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),T.setUniform1i(\"u_blurTexture1\",1),u.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),T.setUniform1i(\"u_blurTexture2\",2),u.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),T.setUniform1i(\"u_blurTexture3\",3),u.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),T.setUniform1i(\"u_blurTexture4\",4),u.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),T.setUniform1i(\"u_blurTexture5\",5),b.draw(),u.bindFramebuffer(n),u.setBlendingEnabled(!0);const x=m.getProgram(t,c.blit);u.bindProgram(x),u.bindTexture(this._compositeFBO.colorTexture,6),x.setUniform1i(\"u_texture\",6),u.setBlendFunction(1,1),b.draw(),b.unbind(),u.setBlendFunction(1,771),u.setStencilTestEnabled(!0)}_createOrResizeResources(i,e,s){const{context:r}=i;if(this._compositeFBO&&this._size[0]===e&&this._size[1]===s)return;this._size[0]=e,this._size[1]=s;const o=[Math.round(e/2),Math.round(s/2)];this._compositeFBO?this._compositeFBO.resize(e,s):this._compositeFBO=new t(r,{colorTarget:0,depthStencilTarget:0,width:e,height:s}),this._intensityFBO?this._intensityFBO.resize(o[0],o[1]):this._intensityFBO=new t(r,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]});for(let i=0;i<this._nMips;i++)this._mipsFBOs[i]?(this._mipsFBOs[i].horizontal.resize(o[0],o[1]),this._mipsFBOs[i].vertical.resize(o[0],o[1])):this._mipsFBOs[i]={horizontal:new t(r,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]}),vertical:new t(r,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]})},o[0]=Math.round(o[0]/2),o[1]=Math.round(o[1]/2)}}export{n as Bloom};\n"]}