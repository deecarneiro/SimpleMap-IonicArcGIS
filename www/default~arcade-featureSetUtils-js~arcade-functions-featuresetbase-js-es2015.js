(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["default~arcade-featureSetUtils-js~arcade-functions-featuresetbase-js"],{

/***/ "/AM1":
/*!************************************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/sources/FeatureLayerRelated.js ***!
  \************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _Graphic_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../Graphic.js */ "jWBI");
/* harmony import */ var _support_shared_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../support/shared.js */ "hTzF");
/* harmony import */ var _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../support/IdSet.js */ "ZPxV");
/* harmony import */ var _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../support/FeatureSet.js */ "T3Nt");
/* harmony import */ var _tasks_support_RelationshipQuery_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../tasks/support/RelationshipQuery.js */ "n6Nx");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
/* harmony default export */ __webpack_exports__["default"] = (class extends _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_4__["default"]{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,this.relatedLayer=null,this.relationship=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return _support_shared_js__WEBPACK_IMPORTED_MODULE_2__["defaultMaxRecords"]}end(){return this._layer}optimisePagingFeatureQueries(){}load(){return null===this._loadPromise&&(this._loadPromise=Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["create"])(((e,i)=>{Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["all"])([this._layer.load(),this.relatedLayer.load()]).then((()=>{this._initialiseFeatureSet(),e(this)}),i)}))),this._loadPromise}nativeCapabilities(){return this.relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const i of this.fields)if("oid"===i.type)e.push(i),t.push(i.name);else for(const r of this._overrideFields)if(r.toLowerCase()===i.name.toLowerCase()){e.push(i),t.push(i.name);break}this.fields=e,this._overrideFields=t}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.globalIdField=this.relatedLayer.globalIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types}databaseType(){return this.relatedLayer.databaseType().then((()=>(this._databaseType=this.relatedLayer._databaseType,this._databaseType)))}isTable(){return this.relatedLayer.isTable()}_isInFeatureSet(){return _support_shared_js__WEBPACK_IMPORTED_MODULE_2__["IdState"].InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,null,e))).then((e=>(this._wset=e,e))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this._wset)}_changeFeature(e){const t={};for(const i of this.fields)t[i.name]=e.attributes[i.name];return new _Graphic_js__WEBPACK_IMPORTED_MODULE_1__["default"]({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,i,r,s){return this.databaseType().then((()=>{if(this.isTable()&&t&&null!==e&&""!==e){return new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__["default"]([],[],!0,null)}const a=this._layer.nativeCapabilities();if(!1===a.canQueryRelated){return new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__["default"]([],[],!0,null)}if(a.capabilities.queryRelated&&a.capabilities.queryRelated.supportsPagination)return this._getFilteredSetUsingPaging(e,t,i,r,s);let n="",d=!1;null!==r&&a.capabilities&&a.capabilities.queryRelated&&!0===a.capabilities.queryRelated.supportsOrderBy&&(n=r.constructClause(),d=!0);const u=new _tasks_support_RelationshipQuery_js__WEBPACK_IMPORTED_MODULE_5__["default"];u.objectIds=[this._findObjectId];const h=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((e=>e.name)):["*"]);u.outFields=h,u.relationshipId=this.relationship.id,u.where="1=1";let c=!0;return!0===this._removeGeometry&&(c=!1),u.returnGeometry=c,this._requestStandardised&&(u.sqlFormat="standard"),u.outSpatialReference=this.spatialReference,u.orderByFields=""!==n?n.split(","):null,a.source.queryRelatedFeatures(u).then((r=>{this._checkCancelled(s);const a=r[this._findObjectId]?r[this._findObjectId].features:[],n=[];for(let e=0;e<a.length;e++)this._featureCache[a[e].attributes[this._layer.objectIdField]]=a[e],n.push(a[e].attributes[this._layer.objectIdField]);const o=t&&null!==e&&""!==e,u=null!=i;return new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__["default"](o||u?n:[],o||u?[]:n,d,null)}))}))}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf("*")>-1)return t;let i=!1;for(const e of t)if(e.toUpperCase()===this.objectIdField.toUpperCase()){i=!0;break}return!1===i&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,i,s,a){try{let r="",n=!1;const d=this._layer.nativeCapabilities();return null!==s&&d&&d.capabilities.queryRelated&&!0===d.capabilities.queryRelated.supportsOrderBy&&(r=s.constructClause(),n=!0),this.databaseType().then((()=>{let s=this._maxQueryRate();const o=d.capabilities.query.maxRecordCount;void 0!==o&&o<s&&(s=o);const u=t&&null!==e&&""!==e,h=null!=i;let c=null,p=!0;!0===this._removeGeometry&&(p=!1);const y=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((e=>e.name)):["*"]);return c=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__["default"](u||h?["GETPAGES"]:[],u||h?[]:["GETPAGES"],n,{outFields:y.join(","),resultRecordCount:s,resultOffset:0,objectIds:[this._findObjectId],where:"1=1",orderByFields:r,returnGeometry:p,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),this._expandPagedSet(c,s,0,0,a).then((()=>c))}))}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}_expandPagedSet(e,t,i,r,s){return this._expandPagedSetFeatureSet(e,t,i,r,s)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,i){try{const t=e.pagesDefinition.internal.lastRetrieved,r=t,s=e.pagesDefinition.internal.lastPage,a=this._layer.nativeCapabilities(),n=new _tasks_support_RelationshipQuery_js__WEBPACK_IMPORTED_MODULE_5__["default"];return!0===this._requestStandardised&&(n.sqlFormat="standard"),n.relationshipId=this.relationship.id,n.objectIds=e.pagesDefinition.objectIds,n.resultOffset=e.pagesDefinition.internal.lastPage,n.resultRecordCount=e.pagesDefinition.resultRecordCount,n.outFields=e.pagesDefinition.outFields.split(","),n.where=e.pagesDefinition.where,n.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,n.returnGeometry=e.pagesDefinition.returnGeometry,n.outSpatialReference=this.spatialReference,a.source.queryRelatedFeatures(n).then((a=>{if(this._checkCancelled(i),e.pagesDefinition.internal.lastPage!==s)return 0;const n=a[this._findObjectId]?a[this._findObjectId].features:[];for(let t=0;t<n.length;t++)e.pagesDefinition.internal.set[r+t]=n[t].attributes[this._layer.objectIdField];for(let e=0;e<n.length;e++)this._featureCache[n[e].attributes[this._layer.objectIdField]]=n[e];const l=!a[this._findObjectId]||!1===a[this._findObjectId].exceededTransferLimit;return n.length!==e.pagesDefinition.resultRecordCount&&l&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+n.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,n.length}))}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}_getFeatures(e,t,s,a){const n=[];-1!==t&&void 0===this._featureCache[t]&&n.push(t);const l=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,l))return this._expandPagedSet(e,l,0,0,a).then((()=>this._getFeatures(e,t,s,a)));let d=0;for(let i=e._lastFetchedIndex;i<e._known.length&&(d++,d<=s&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[i]&&void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&n.push(e._known[i]),n.length>s)))&&!(d>=s&&0===n.length);i++);return 0===n.length?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("success"):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Unaccounted for Features. Not in Feature Collection"))}_refineSetBlock(e,t,r){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(e)}_stat(e,t,r,s,a,n,l){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])({calculated:!1})}get gdbVersion(){return this.relatedLayer.gdbVersion}_canDoAggregates(e,t,r,s,a){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1)}relationshipMetaData(){return this.relatedLayer.relationshipMetaData()}serviceUrl(){return this.relatedLayer.serviceUrl()}queryAttachments(e,t,i,r){return this.relatedLayer.queryAttachments(e,t,i,r)}getFeatureByObjectId(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this.relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this.relatedLayer.getIdentityUser()}});


/***/ }),

/***/ "4zW0":
/*!*************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureSetUtils.js ***!
  \*************************************************************/
/*! exports provided: constructAssociationMetaDataFeatureSetFromUrl, constructFeatureSet, constructFeatureSetFromPortalItem, constructFeatureSetFromRelationship, constructFeatureSetFromUrl, createFeatureSetCollectionFromMap, createFeatureSetCollectionFromService, getPortal, initialiseMetaDataCache, lookupUser */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "constructAssociationMetaDataFeatureSetFromUrl", function() { return F; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "constructFeatureSet", function() { return A; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "constructFeatureSetFromPortalItem", function() { return b; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "constructFeatureSetFromRelationship", function() { return g; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "constructFeatureSetFromUrl", function() { return T; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createFeatureSetCollectionFromMap", function() { return O; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createFeatureSetCollectionFromService", function() { return w; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getPortal", function() { return v; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "initialiseMetaDataCache", function() { return S; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "lookupUser", function() { return E; });
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _kernel_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../kernel.js */ "975N");
/* harmony import */ var _request_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../request.js */ "Lqtk");
/* harmony import */ var _portal_Portal_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../portal/Portal.js */ "AiS/");
/* harmony import */ var _portal_PortalItem_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../portal/PortalItem.js */ "p+Gi");
/* harmony import */ var _featureset_support_shared_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./featureset/support/shared.js */ "hTzF");
/* harmony import */ var _featureSetCollection_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./featureSetCollection.js */ "lNzE");
/* harmony import */ var _featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./featureset/support/cache.js */ "H72m");
/* harmony import */ var _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../core/sql/WhereClause.js */ "ZqIb");
/* harmony import */ var _featureset_actions_AttributeFilter_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./featureset/actions/AttributeFilter.js */ "nC36");
/* harmony import */ var _featureset_actions_OrderBy_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./featureset/actions/OrderBy.js */ "Xbkg");
/* harmony import */ var _featureset_actions_GroupBy_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./featureset/actions/GroupBy.js */ "uOiI");
/* harmony import */ var _featureset_actions_SpatialFilter_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./featureset/actions/SpatialFilter.js */ "gBat");
/* harmony import */ var _featureset_actions_Top_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./featureset/actions/Top.js */ "YP08");
/* harmony import */ var _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../layers/FeatureLayer.js */ "W9Wu");
/* harmony import */ var _featureset_sources_FeatureLayerDynamic_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./featureset/sources/FeatureLayerDynamic.js */ "oO7B");
/* harmony import */ var _featureset_sources_FeatureLayerMemory_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./featureset/sources/FeatureLayerMemory.js */ "OAJp");
/* harmony import */ var _featureset_sources_FeatureLayerRelated_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./featureset/sources/FeatureLayerRelated.js */ "/AM1");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function S(){null===_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache&&(_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache=new _featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"])}function N(t,a){if(_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache){const n=_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.getLayerInfo(t);if(n)return n.then((r=>Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(new _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"]({url:t,outFields:a,sourceJSON:r}))));const s=new _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"]({url:t,outFields:a});let i=Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["create"])(((e,t)=>{s.load().then((()=>{e(s.sourceJSON)}),(e=>{t(e)}))}));return _featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache&&(_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.setLayerInfo(t,i),i=i.catch((e=>{throw _featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.clearLayerInfo(t),e}))),i.then((()=>Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(s)))}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(new _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"]({url:t,outFields:a}))}function T(t,r,a,n,s){return N(t,["*"]).then((t=>Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(A(t,r,a,n,s))))}function A(e,t=null,r=null,a=!0,n=null){return!0===e._hasMemorySource()?new _featureset_sources_FeatureLayerMemory_js__WEBPACK_IMPORTED_MODULE_16__["default"]({layer:e,spatialReference:t,outFields:r,includeGeometry:a,lrucache:n}):new _featureset_sources_FeatureLayerDynamic_js__WEBPACK_IMPORTED_MODULE_15__["default"]({layer:e,spatialReference:t,outFields:r,includeGeometry:a,lrucache:n})}function C(t){if(null!==_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache){const e=_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.getLayerInfo(t);if(null!==e)return e}let r=Object(_request_js__WEBPACK_IMPORTED_MODULE_2__["default"])(t,{responseType:"json",query:{f:"json"}}).then((t=>{if(t.data){const r=t.data;return r.layers||(r.layers=[]),r.tables||(r.tables=[]),Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(r)}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])({layers:[],tables:[]})}));return null!==_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache&&(_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.setLayerInfo(t,r),r=r.catch((e=>{throw _featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.clearLayerInfo(t),e}))),r}function F(t,r){const a={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return C(t).then((s=>{if(a.metadata=s,s.controllerDatasetLayers&&void 0!==s.controllerDatasetLayers.utilityNetworkLayerId&&null!==s.controllerDatasetLayers.utilityNetworkLayerId){if(s.layers)for(const e of s.layers)a.layerNameLkp[e.id]=e.name;if(s.tables)for(const e of s.tables)a.layerNameLkp[e.id]=e.name;const i=s.controllerDatasetLayers.utilityNetworkLayerId;return a.networkId=i,function(e,t){const r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache){const e=_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.getLayerInfo(r);if(null!==e)return e}let a=Object(_request_js__WEBPACK_IMPORTED_MODULE_2__["default"])(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then((e=>{if(e.data){const t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")}));return null!==_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache&&(_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.setLayerInfo(r,a),a=a.catch((e=>{throw _featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.clearLayerInfo(r),e}))),a}(t,i).then((s=>{if(s){a.queryelem=s,a.queryelem&&a.queryelem.dataElement&&void 0!==a.queryelem.dataElement.schemaGeneration&&(a.unVersion=a.queryelem.dataElement.schemaGeneration),a.lkp={},a.queryelem.dataElement.domainNetworks||(a.queryelem.dataElement.domainNetworks=[]);for(const e of a.queryelem.dataElement.domainNetworks){for(const t of e.edgeSources?e.edgeSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:a.layerNameLkp[t.layerId]?a.layerNameLkp[t.layerId]:null};e.className&&(a.lkp[e.className]=e)}for(const t of e.junctionSources?e.junctionSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:a.layerNameLkp[t.layerId]?a.layerNameLkp[t.layerId]:null};e.className&&(a.lkp[e.className]=e)}}if(a.queryelem.dataElement.terminalConfigurations)for(const e of a.queryelem.dataElement.terminalConfigurations)for(const t of e.terminals)a.terminals.push({terminalId:t.terminalId,terminalName:t.terminalName});return function(t){if(null!==_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache){const e=_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.getLayerInfo(t);if(null!==e)return e}let r=Object(_request_js__WEBPACK_IMPORTED_MODULE_2__["default"])(t,{responseType:"json",query:{f:"json"}}).then((t=>{if(t.data){const r=t.data;return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(r)}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(null)}));return null!==_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache&&(_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.setLayerInfo(t,r),r=r.catch((e=>{throw _featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.clearLayerInfo(t),e}))),r}(t+"/"+i).then((e=>{if(e.systemLayers&&void 0!==e.systemLayers.associationsTableId&&null!==e.systemLayers.associationsTableId){const n=[];return a.unVersion>=4&&(n.push("STATUS"),n.push("PERCENTALONG")),T(t+"/"+e.systemLayers.associationsTableId.toString(),r,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...n],!1,null).then((e=>e.load())).then((e=>a.unVersion>=4?(e=e.filter(_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_8__["WhereClause"].create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",e.getFieldsIndex()))).load():e)).then((e=>({lkp:a.lkp,associations:e,unVersion:a.unVersion,terminals:a.terminals})))}return{associations:null,unVersion:a.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:a.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:a.unVersion,lkp:null,terminals:[]}}))}function g(e,t,r,a=null,n=null,s=!0,i=null){let l=e.serviceUrl();return l?(l="/"===l.charAt(l.length-1)?l+t.relatedTableId.toString():l+"/"+t.relatedTableId.toString(),T(l,a,n,s,i).then((l=>new _featureset_sources_FeatureLayerRelated_js__WEBPACK_IMPORTED_MODULE_17__["default"]({layer:e,relatedLayer:l,relationship:t,objectId:r,spatialReference:a,outFields:n,includeGeometry:s,lrucache:i})))):null}_featureset_actions_AttributeFilter_js__WEBPACK_IMPORTED_MODULE_9__["default"].registerAction(),_featureset_actions_GroupBy_js__WEBPACK_IMPORTED_MODULE_11__["default"].registerAction(),_featureset_actions_OrderBy_js__WEBPACK_IMPORTED_MODULE_10__["default"].registerAction(),_featureset_actions_SpatialFilter_js__WEBPACK_IMPORTED_MODULE_12__["default"].registerAction(),_featureset_actions_Top_js__WEBPACK_IMPORTED_MODULE_13__["default"].registerAction();class k extends _featureSetCollection_js__WEBPACK_IMPORTED_MODULE_6__["default"]{constructor(e,t=null,r=null){super(),this._map=e,this._overridespref=t,this.lrucache=r,this._instantLayers=[]}makeAndAddFeatureSet(e,t=!0,r=null){const a=A(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:a,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),a}featureSetByName(e,r=!0,a=null){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((()=>{try{return this.featureSetByName(e,r,a)}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}));null===a&&(a=["*"]),a=(a=a.slice(0)).sort();const n=JSON.stringify(a);for(let t=0;t<this._instantLayers.length;t++){const a=this._instantLayers[t];if(a.opitem.title===e&&a.includeGeometry===r&&a.outFields===n)return this.resolvePromise(this._instantLayers[t].featureset)}const s=this._map.layers.find((t=>t instanceof _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"]&&t.title===e));if(s)return this.resolvePromise(this.makeAndAddFeatureSet(s,r,a));if(this._map.tables){const t=this._map.tables.find((t=>!!(t.title&&t.title===e||t.title&&t.title===e)));if(t){if(t instanceof _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"])return this.resolvePromise(this.makeAndAddFeatureSet(t,r,a));if(t._materializedTable);else{const e=t.outFields?t:{...t,outFields:["*"]};t._materializedTable=new _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"](e)}return t._materializedTable.load().then((()=>this.resolvePromise(this.makeAndAddFeatureSet(t._materializedTable,r,a))))}}return this.resolvePromise(null)}featureSetById(e,r=!0,a=["*"]){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((()=>{try{return this.featureSetById(e,r,a)}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}));null===a&&(a=["*"]),a=(a=a.slice(0)).sort();const n=JSON.stringify(a);for(let t=0;t<this._instantLayers.length;t++){const a=this._instantLayers[t];if(a.opitem.id===e&&a.includeGeometry===r&&a.outFields===n)return this.resolvePromise(this._instantLayers[t].featureset)}const s=this._map.layers.find((t=>t instanceof _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"]&&t.id===e));if(s)return this.resolvePromise(this.makeAndAddFeatureSet(s,r,a));if(this._map.tables){const t=this._map.tables.find((t=>t.id===e));if(t){if(t instanceof _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"])return this.resolvePromise(this.makeAndAddFeatureSet(t,r,a));if(t._materializedTable);else{const e={...t,outFields:["*"]};t._materializedTable=new _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"](e)}return t._materializedTable.load().then((()=>this.resolvePromise(this.makeAndAddFeatureSet(t._materializedTable,r,a))))}}return this.resolvePromise(null)}}class j extends _featureSetCollection_js__WEBPACK_IMPORTED_MODULE_6__["default"]{constructor(e,t=null,r=null){super(),this._url=e,this._overridespref=t,this.lrucache=r,this.metadata=null,this._instantLayers=[]}get url(){return this._url}makeAndAddFeatureSet(e,t=!0,r=null){const a=A(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:a,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),a}_loadMetaData(){return C(this._url).then((e=>(this.metadata=e,e)))}load(){return this._loadMetaData()}clone(){return new j(this._url,this._overridespref,this.lrucache)}featureSetByName(e,t=!0,r=null){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const a=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const n=this._instantLayers[r];if(n.opitem.title===e&&n.includeGeometry===t&&n.outFields===a)return this.resolvePromise(this._instantLayers[r].featureset)}return this._loadMetaData().then((a=>{let n=null;for(const t of a.layers?a.layers:[])t.name===e&&(n=t);if(!n)for(const t of a.tables?a.tables:[])t.name===e&&(n=t);return n?N(this._url+"/"+n.id,["*"]).then((e=>this.makeAndAddFeatureSet(e,t,r))):this.resolvePromise(null)}))}featureSetById(e,t=!0,r=["*"]){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const a=JSON.stringify(r);e=null!=e?e.toString():"";for(let r=0;r<this._instantLayers.length;r++){const n=this._instantLayers[r];if(n.opitem.id===e&&n.includeGeometry===t&&n.outFields===a)return this.resolvePromise(this._instantLayers[r].featureset)}return this._loadMetaData().then((a=>{let n=null;for(const t of a.layers?a.layers:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(n=t);if(!n)for(const t of a.tables?a.tables:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(n=t);return n?N(this._url+"/"+n.id,["*"]).then((e=>this.makeAndAddFeatureSet(e,t,r))):this.resolvePromise(null)}))}}function O(e,t,r=null){return new k(e,t,r)}function w(e,t,r=null){return new j(e,t,r)}function v(e,t){if(null===e)return t;return new _portal_Portal_js__WEBPACK_IMPORTED_MODULE_3__["default"]({url:e.field("url")})}function E(t,r,s){return _kernel_js__WEBPACK_IMPORTED_MODULE_1__["id"].findCredential(t.restUrl)?"loaded"===t.loadStatus&&""===r&&t.user&&t.user.sourceJSON&&!1===s?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(t.user.sourceJSON):""===r?Object(_request_js__WEBPACK_IMPORTED_MODULE_2__["default"])(t.restUrl+"/community/self",{responseType:"json",query:{f:"json",...!1===s?{}:{returnUserLicenseTypeExtensions:!0}}}).then((t=>{if(t.data){const r=t.data;if(r&&r.username)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(r)}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(null)})):Object(_request_js__WEBPACK_IMPORTED_MODULE_2__["default"])(t.restUrl+"/community/users/"+r,{responseType:"json",query:{f:"json"}}).then((t=>{if(t.data){const r=t.data;return r.error?null:Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(r)}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(null)})):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(null)}function b(a,n,s,o,c,d,m){if(_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache){const r=_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.getLayerInfo(a+":"+d.url);if(r)return r.then((r=>{try{const t=new _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"]({url:Object(_featureset_support_shared_js__WEBPACK_IMPORTED_MODULE_5__["extractServiceUrl"])(r.url)+"/"+n,outFields:["*"]});return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(A(t,s,o,c,m))}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}),(e=>Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)))}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["create"])(((e,t)=>{const r=new _portal_PortalItem_js__WEBPACK_IMPORTED_MODULE_4__["default"]({id:a,portal:d}).load();_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache&&_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.setLayerInfo(a+":"+d.url,r),r.then((r=>{try{const t=new _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_14__["default"]({url:Object(_featureset_support_shared_js__WEBPACK_IMPORTED_MODULE_5__["extractServiceUrl"])(r.url)+"/"+n,outFields:["*"]});e(A(t,s,o,c,m))}catch(e){t(e)}}),(e=>{_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache&&_featureset_support_cache_js__WEBPACK_IMPORTED_MODULE_7__["default"].applicationCache.clearLayerInfo(a+":"+d.url),t(e)}))}))}


/***/ }),

/***/ "LK1Z":
/*!************************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/actions/Adapted.js ***!
  \************************************************************************/
/*! exports provided: AdaptedFeatureSet, AdaptedField, FieldRename, OriginalField, SqlExpressionAdapted, StringToCodeAdapted */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdaptedFeatureSet", function() { return E; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AdaptedField", function() { return m; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FieldRename", function() { return v; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "OriginalField", function() { return w; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SqlExpressionAdapted", function() { return T; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "StringToCodeAdapted", function() { return C; });
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../geometry/SpatialReference.js */ "WZb1");
/* harmony import */ var _Graphic_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../Graphic.js */ "jWBI");
/* harmony import */ var _support_shared_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../support/shared.js */ "hTzF");
/* harmony import */ var _kernel_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../kernel.js */ "hUmP");
/* harmony import */ var _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../support/IdSet.js */ "ZPxV");
/* harmony import */ var _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../core/sql/WhereClause.js */ "ZqIb");
/* harmony import */ var _support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../support/sqlUtils.js */ "B8fU");
/* harmony import */ var _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../support/FeatureSet.js */ "T3Nt");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class m{constructor(){this.sqlRewritable=!1}postInitialization(e,t){}}class w extends m{constructor(e){super(),this.field=e,this.sqlRewritable=!0}extractValue(e){return e.attributes[this.field.name]}rewriteSql(e){return{rewritten:this.sqlRewritable,where:e}}}class v extends m{constructor(e,t,r){super(),this.originalField=e,this.sqlRewritable=!0,this.field=Object(_support_shared_js__WEBPACK_IMPORTED_MODULE_3__["cloneField"])(e),this.field.name=t,this.field.alias=r}rewriteSql(e,t){return{rewritten:this.sqlRewritable,where:Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["reformulateWithoutField"])(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}extractValue(e){return e.attributes[this.originalField.name]}}class C extends m{constructor(e,t,r){super(),this.field=e,this.codefield=t,this.lkp=r,this.reverseLkp={};for(const e in r)this.reverseLkp[r[e]]=e;this.sqlRewritable=!0}rewriteSql(e,t){const r=this.evaluateNodeToWhereClause(e.parseTree,_support_shared_js__WEBPACK_IMPORTED_MODULE_3__["FeatureServiceDatabaseType"].Standardised,this.field.name,this.codefield instanceof _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_6__["WhereClause"]?Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["toWhereClause"])(this.codefield,_support_shared_js__WEBPACK_IMPORTED_MODULE_3__["FeatureServiceDatabaseType"].Standardised):this.codefield,e.parameters);return r.indexOf(C.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_6__["WhereClause"].create(r,t._parent.getFieldsIndex())}}evaluateNodeToWhereClause(e,t,r=null,s=null,i){let a,l,n,o;switch(e.type){case"interval":return Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["convertIntervalToSql"])(this.evaluateNodeToWhereClause(e.value,t,r,s,i),e.qualifier,e.op);case"case_expression":{let s=" CASE ";"simple"===e.format&&(s+=this.evaluateNodeToWhereClause(e.operand,t,r,C.BADNESS,i));for(let a=0;a<e.clauses.length;a++)s+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[a].operand,t,r,C.BADNESS,i)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[a].value,t,r,C.BADNESS,i);return null!==e.else&&(s+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,r,C.BADNESS,i)),s+=" END ",s}case"param":{const r=i[e.value.toLowerCase()];if("string"==typeof r){return"'"+i[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'"}if(r instanceof Date)return Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["makeDateString"])(r,t);if(r instanceof Array){const e=[];for(let s=0;s<r.length;s++)"string"==typeof r[s]?e.push("'"+r[s].toString().replace(/'/g,"''")+"'"):r[s]instanceof Date?e.push(Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["makeDateString"])(r[s],t)):e.push(r[s].toString());return e}return r.toString()}case"expr_list":l=[];for(const a of e.value)l.push(this.evaluateNodeToWhereClause(a,t,r,s,i));return l;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,r,C.BADNESS,i)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" AND "+this.evaluateNodeToWhereClause(e.right,t,r,s,i)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" OR "+this.evaluateNodeToWhereClause(e.right,t,r,s,i)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" IS NOT NULL )";case"IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const a=[];let l=!0;for(const t of e.right.value){if("string"!==t.type){l=!1;break}if(void 0===this.lkp[t.value]){l=!1;break}a.push(this.lkp[t.value].toString())}if(l)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" IN ("+a.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,r,s,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" IN ("+a.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,t,r,s,i),o instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" IN ("+o.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" IN ("+o+")) ";case"NOT IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const a=[];let l=!0;for(const t of e.right.value){if("string"!==t.type){l=!1;break}if(void 0===this.lkp[t.value]){l=!1;break}a.push(this.lkp[t.value].toString())}if(l)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" NOT IN ("+a.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,r,s,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" NOT IN ("+a.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,t,r,s,i),o instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" NOT IN ("+o.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,s,i)+" NOT IN ("+o+")) ";case"BETWEEN":return n=this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" BETWEEN "+n[0]+" AND "+n[1]+" ) ";case"NOTBETWEEN":return n=this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" NOT BETWEEN "+n[0]+" AND "+n[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+s+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+s+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,C.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,C.BADNESS,i)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["makeDateString"])(e.value,t);case"number":return e.value.toString();case"current_time":return Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["makeToday"])("date"===e.mode,t);case"column_ref":return r&&r.toLowerCase()===e.column.toLowerCase()?"("+s+")":e.column;case"function":{const s=this.evaluateNodeToWhereClause(e.args,t,r,C.BADNESS,i);return Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["translateFunctionToDatabaseSpecific"])(e.name,s,t)}}throw new Error("Unsupported sql syntax "+e.type)}extractValue(e){return this.codefield instanceof _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_6__["WhereClause"]?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]}}C.BADNESS="_!!!_BAD_LKP_!!!!";class T extends m{constructor(e,t){super(),this.field=e,this.sql=t}rewriteSql(e,t){return{rewritten:!0,where:Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["reformulateWithoutField"])(e,this.field.name,Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["toWhereClause"])(this.sql,_support_shared_js__WEBPACK_IMPORTED_MODULE_3__["FeatureServiceDatabaseType"].Standardised),t.getFieldsIndex())}}extractValue(e){return this.sql.calculateValueCompiled(e)}}class E extends _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_8__["default"]{constructor(e){super(e),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=null,this._extraFilter=null,this._extraFilter=e.extraFilter,this._parent=e.parentfeatureset,this._maxProcessing=30,this.adaptedFields=e.adaptedFields}static findField(e,t){for(const r of e)if(r.name.toLowerCase()===t.toString().toLowerCase())return r;return null}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_1__["default"]({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=_support_shared_js__WEBPACK_IMPORTED_MODULE_3__["layerGeometryEsriConstants"].point,this.typeIdField="",this.types=null),this.fields=[];for(const e of this.adaptedFields)e.postInitialization(this,this._parent),this.fields.push(e.field)}_getSet(t){return null===this._wset?this._ensureLoaded().then((()=>this._extraFilter?this._getFilteredSet("",null,null,null,t):this._parent._getSet(t))).then((e=>(this._checkCancelled(t),this._wset=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__["default"](e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),this._wset))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this._wset)}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(t,r,i,a){const l=[];-1!==r&&void 0===this._featureCache[r]&&l.push(r);const h=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(t,h))return this._expandPagedSet(t,h,0,0,a).then((()=>this._getFeatures(t,r,i,a)));let u=0;for(let e=t._lastFetchedIndex;e<t._known.length&&(u++,u<=i&&(t._lastFetchedIndex+=1),!(void 0===this._featureCache[t._known[e]]&&(t._known[e]!==r&&l.push(t._known[e]),l.length>=h-1)));e++);if(0===l.length)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("success");t=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__["default"]([],l,t._ordered,null);const d=Math.min(l.length,i);return this._parent._getFeatures(t,-1,d,a).then((()=>{this._checkCancelled(a);const e=[];for(let t=0;t<d;t++){const r=this._parent._featureFromCache(l[t]);void 0!==r&&e.push({geometry:r.geometry,attributes:r.attributes,id:l[t]})}for(const t of e){const e=[];for(const r of this.adaptedFields)e[r.field.name]=r.extractValue(t);this._featureCache[t.id]=new _Graphic_js__WEBPACK_IMPORTED_MODULE_2__["default"]({attributes:e,geometry:Object(_kernel_js__WEBPACK_IMPORTED_MODULE_4__["cloneGeometry"])(t.geometry)})}return"success"}))}_fetchAndRefineFeatures(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Fetch and Refine should not be called in this featureset"))}_getFilteredSet(e,t,r,s,i){let a=!1;const l=this.reformulateWithoutAdaptions(r);a=l.cannot,r=l.where;let n=!1;if(null!==s){n=!0;const e=[];for(const t of this.adaptedFields)if(!(t instanceof w)&&!0===s.scanForField(t.field.name)){if(!(t instanceof v)){s=null,n=!1;break}e.push({field:t.field.name,newfield:t.originalField.name})}s&&e.length>0&&(s=s.replaceFields(e))}return null!==r?null!==this._extraFilter&&(r=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["combine"])(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,r,s,i))).then((e=>{let t;return this._checkCancelled(i),t=!0===a?new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__["default"](e._candidates.slice(0).concat(e._known.slice(0)),[],!0===n&&e._ordered,this._clonePageDefinition(e.pagesDefinition)):new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__["default"](e._candidates.slice(0),e._known.slice(0),!0===n&&e._ordered,this._clonePageDefinition(e.pagesDefinition)),t}))}reformulateWithoutAdaptions(e){const t={cannot:!1,where:e};if(null!==e)for(const r of this.adaptedFields)if(!0===Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["scanForField"])(e,r.field.name)){const s=r.rewriteSql(e,this);if(!0!==s.rewritten){t.cannot=!0,t.where=null;break}t.where=s.where}return t}_stat(t,r,s,i,a,l,n){let o=!1,h=this.reformulateWithoutAdaptions(r);return o=h.cannot,r=h.where,h=this.reformulateWithoutAdaptions(a),o=o||h.cannot,null!==(a=h.where)?null!==this._extraFilter&&(a=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["combine"])(this._extraFilter,a)):a=this._extraFilter,!0===o?null===a&&""===s&&null===i?this._manualStat(t,r,l,n):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])({calculated:!1}):this._parent._stat(t,r,s,i,a,l,n).then((e=>!1===e.calculated?null===a&&""===s&&null===i?this._manualStat(t,r,l,n):{calculated:!1}:e))}_canDoAggregates(t,r,s,i,a){if(null===this._parent)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1);for(let r=0;r<t.length;r++)for(const s of this.adaptedFields)if(t[r].toLowerCase()===s.field.name.toLowerCase()&&!(s instanceof w))return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1);const l=[];for(let t=0;t<r.length;t++){const s=r[t];if(null!==s.workingexpr){const t=this.reformulateWithoutAdaptions(s.workingexpr);if(t.cannot)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1);const r=s.clone();r.workingexpr=t.where,l.push(r)}else l.push(s)}const n=this.reformulateWithoutAdaptions(a);return n.cannot?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1):(null!==(a=n.where)?null!==this._extraFilter&&(a=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["combine"])(this._extraFilter,a)):a=this._extraFilter,this._parent._canDoAggregates(t,l,s,i,a))}_getAggregatePagesDataSourceDefinition(e,r,s,i,a,l,n){if(null===this._parent)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Should never be called"));const o=[];for(let e=0;e<r.length;e++){const s=r[e];if(null!==s.workingexpr){const e=this.reformulateWithoutAdaptions(s.workingexpr);if(e.cannot)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Should never be called"));const r=s.clone();r.workingexpr=e.where,o.push(r)}else o.push(s)}const h=this.reformulateWithoutAdaptions(a);return h.cannot?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Should never be called")):(null!==(a=h.where)?null!==this._extraFilter&&(a=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_7__["combine"])(this._extraFilter,a)):a=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,o,s,i,a,l,n))}}


/***/ }),

/***/ "OAJp":
/*!***********************************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/sources/FeatureLayerMemory.js ***!
  \***********************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _geometry_Geometry_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../geometry/Geometry.js */ "N2DF");
/* harmony import */ var _Graphic_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../Graphic.js */ "jWBI");
/* harmony import */ var _layers_support_Field_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../layers/support/Field.js */ "ofM5");
/* harmony import */ var _support_shared_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../support/shared.js */ "hTzF");
/* harmony import */ var _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../support/IdSet.js */ "ZPxV");
/* harmony import */ var _support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../support/sqlUtils.js */ "B8fU");
/* harmony import */ var _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../support/FeatureSet.js */ "T3Nt");
/* harmony import */ var _layers_support_FeatureType_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../layers/support/FeatureType.js */ "orEy");
/* harmony import */ var _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../tasks/support/Query.js */ "xk++");
/* harmony import */ var _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../layers/FeatureLayer.js */ "W9Wu");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class y extends _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_7__["default"]{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,!0===e.isTable&&(this._forceIsTable=!0),void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return _support_shared_js__WEBPACK_IMPORTED_MODULE_4__["defaultMaxRecords"]}end(){return this._layer}optimisePagingFeatureQueries(){}load(){return null===this._loadPromise&&(this._loadPromise=Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["create"])(((e,t)=>{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}}),t),this._layer.load()}))),this._loadPromise}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if("oid"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}else;if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const s of this._overrideFields)if(s.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=_support_shared_js__WEBPACK_IMPORTED_MODULE_4__["FeatureServiceDatabaseType"].Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return _support_shared_js__WEBPACK_IMPORTED_MODULE_4__["IdState"].InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,null,e))).then((e=>(this._wset=e,e))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this._wset)}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new _Graphic_js__WEBPACK_IMPORTED_MODULE_2__["default"]({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,r,s,i,a){let l="",o=!1;if(null!==i&&(l=i.constructClause(),o=!0),this.isTable()&&r&&null!==e&&""!==e){const e=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__["default"]([],[],!0,null);return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(e)}const c=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_9__["default"];return c.where=null===s?null===r?"1=1":"":Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_6__["toWhereClause"])(s,_support_shared_js__WEBPACK_IMPORTED_MODULE_4__["FeatureServiceDatabaseType"].Standardised),c.spatialRelationship=this._makeRelationshipEnum(e),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==l?l.split(","):null,c.geometry=null===r?null:r,c.returnGeometry=!0,c.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(c).then((e=>{if(null===e)return new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__["default"]([],[],o,null);this._checkCancelled(a);const t=[];e.features.forEach((e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)}));return new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__["default"]([],t,o,null)}))}_makeRelationshipEnum(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}_queryAllFeatures(){if(this._wset)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this._wset);const e=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_9__["default"];return e.where="1=1",this._ensureLoaded().then((()=>{if(this._layer.source&&this._layer.source.items){const e=[];return this._layer.source.items.forEach((t=>{const r=t.attributes[this._layer.objectIdField];e.push(r),this._featureCache[r]=this._changeFeature(t)})),this._wset=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__["default"]([],e,!1,null),this._wset}return this._layer.queryFeatures(e).then((e=>{const t=[];return e.features.forEach((e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)})),this._wset=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_5__["default"]([],t,!1,null),this._wset}))}))}_getFeatures(e,s,i){const a=[];-1!==s&&void 0===this._featureCache[s]&&a.push(s);for(let t=e._lastFetchedIndex;t<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[t]]&&(e._known[t]!==s&&a.push(e._known[t]),a.length>i)));t++);return 0===a.length?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("success"):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Unaccounted for Features. Not in Feature Collection"))}_refineSetBlock(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(e)}_stat(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])({calculated:!1})}_canDoAggregates(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1)}relationshipMetaData(){return[]}static _cloneAttr(e){const t={};for(const r in e)t[r]=e[r];return t}nativeCapabilities(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(e,t){let r=e.layerDefinition.objectIdField;const i=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:"",l=[];if(e.layerDefinition.types)for(const t of e.layerDefinition.types)l.push(_layers_support_FeatureType_js__WEBPACK_IMPORTED_MODULE_8__["default"].fromJSON(t));let n=e.layerDefinition.geometryType;void 0===n&&(n=e.featureSet.geometryType||"");let o=e.featureSet.features;const u=t.toJSON();if(""===r||void 0===r){let t=!1;for(const s of e.layerDefinition.fields)if("oid"===s.type||"esriFieldTypeOID"===s.type){r=s.name,t=!0;break}if(!1===t){let t="FID",s=!0,i=0;for(;s;){let r=!0;for(const s of e.layerDefinition.fields)if(s.name===t){r=!1;break}!0===r?s=!1:(i++,t="FID"+i.toString())}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:t,alias:t});const a=[];for(let r=0;r<o.length;r++)a.push({geometry:e.featureSet.features[r].geometry,attributes:e.featureSet.features[r].attributes?this._cloneAttr(e.featureSet.features[r].attributes):{}}),a[r].attributes[t]=r;o=a,r=t}}const h=[];for(const t of e.layerDefinition.fields)t instanceof _layers_support_Field_js__WEBPACK_IMPORTED_MODULE_3__["default"]?h.push(t):h.push(_layers_support_Field_js__WEBPACK_IMPORTED_MODULE_3__["default"].fromJSON(t));let c=n;switch(c){case"esriGeometryPoint":c="point";break;case"esriGeometryPolyline":c="polyline";break;case"esriGeometryPolygon":c="polygon";break;case"esriGeometryExtent":c="extent";break;case"esriGeometryMultipoint":c="multipoint"}for(const e of o)e.geometry&&e.geometry instanceof _geometry_Geometry_js__WEBPACK_IMPORTED_MODULE_1__["default"]==!1&&(e.geometry.type=c,void 0===e.geometry.spatialReference&&(e.geometry.spatialReference=u));const f={outFields:["*"],source:o,fields:h,types:l,typeIdField:i,objectIdField:r,spatialReference:t};f.geometryType=c||"point";const _=new _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_10__["default"](f);return new y({layer:_,spatialReference:t,isTable:null===c||""===c})}queryAttachments(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])([])}getFeatureByObjectId(e){const t=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_9__["default"];return t.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(t).then((e=>1===e.features.length?e.features[0]:null))}getOwningSystemUrl(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("")}getIdentityUser(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("")}}/* harmony default export */ __webpack_exports__["default"] = (y);


/***/ }),

/***/ "Xbkg":
/*!************************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/actions/OrderBy.js ***!
  \************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _chunks_languageUtils_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../chunks/languageUtils.js */ "idrm");
/* harmony import */ var _support_IdSet_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../support/IdSet.js */ "ZPxV");
/* harmony import */ var _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../support/FeatureSet.js */ "T3Nt");
/* harmony import */ var _support_OrderbyClause_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../support/OrderbyClause.js */ "lq8Q");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class a extends _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_3__["default"]{constructor(e){super(e),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=e.orderbyclause,this._parent=e.parentfeatureset}_getSet(t){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,this._orderbyclause,t))).then((e=>(this._checkCancelled(t),this._wset=e,this._wset))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this._wset)}manualOrderSet(e,t){return this.getIdColumnDictionary(e,[],-1,t).then((e=>{this._orderbyclause.order(e);const t=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_2__["default"]([],[],!0,null);for(let r=0;r<e.length;r++)t._known.push(e[r].id);return t}))}getIdColumnDictionary(t,n,s,i){if(s<t._known.length-1){const e=this._maxQueryRate();if("GETPAGES"===t._known[s+1])return Object(_chunks_languageUtils_js__WEBPACK_IMPORTED_MODULE_1__["Q"])(this._parent._expandPagedSet(t,e,0,0,i)).then((()=>this.getIdColumnDictionary(t,n,s,i)));let a=s+1;const o=[];for(;a<t._known.length&&"GETPAGES"!==t._known[a];)o.push(t._known[a]),a++;return s+=o.length,Object(_chunks_languageUtils_js__WEBPACK_IMPORTED_MODULE_1__["Q"])(this._parent._getFeatureBatch(o,i)).then((e=>{this._checkCancelled(i);for(const t of e)n.push({id:t.attributes[this.objectIdField],feature:t});return this.getIdColumnDictionary(t,n,s,i)}))}return t._candidates.length>0?Object(_chunks_languageUtils_js__WEBPACK_IMPORTED_MODULE_1__["Q"])(this._refineSetBlock(t,this._maxProcessingRate(),i)).then((()=>(this._checkCancelled(i),this.getIdColumnDictionary(t,n,s,i)))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(n)}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){if(void 0===this._featureCache[e]){const t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}_fetchAndRefineFeatures(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Fetch and Refine should not be called in this featureset"))}_getFilteredSet(e,t,r,s,i){return this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,r,null===s?this._orderbyclause:s,i))).then((e=>{let s;this._checkCancelled(i),s=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_2__["default"](e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition));let a=!0;return e._candidates.length>0&&(a=!1),!1===s._ordered?this.manualOrderSet(s,i).then((e=>(!1===a&&(null===t&&null===r||(e=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_2__["default"](e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)))),e))):s}))}static registerAction(){_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_3__["default"]._featuresetFunctions.orderBy=function(e){return""===e?this:new a({parentfeatureset:this,orderbyclause:new _support_OrderbyClause_js__WEBPACK_IMPORTED_MODULE_4__["default"](e)})}}}/* harmony default export */ __webpack_exports__["default"] = (a);


/***/ }),

/***/ "YP08":
/*!********************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/actions/Top.js ***!
  \********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _support_shared_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../support/shared.js */ "hTzF");
/* harmony import */ var _support_IdSet_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../support/IdSet.js */ "ZPxV");
/* harmony import */ var _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../support/FeatureSet.js */ "T3Nt");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class a extends _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_3__["default"]{constructor(t){super(t),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=t.topnum,this._parent=t.parentfeatureset}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._parent._getSet(e))).then((t=>(this._wset=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_2__["default"](t._candidates.slice(0),t._known.slice(0),!1,this._clonePageDefinition(t.pagesDefinition)),this._setKnownLength(this._wset)>this._topnum&&(this._wset._known=this._wset._known.slice(0,this._topnum)),this._setKnownLength(this._wset)>=this._topnum&&(this._wset._candidates=[]),this._wset))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this._wset)}_setKnownLength(t){return t._known.length>0&&"GETPAGES"===t._known[t._known.length-1]?t._known.length-1:t._known.length}_isInFeatureSet(t){const e=this._parent._isInFeatureSet(t);if(e===_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].NotInFeatureSet)return e;const s=this._idstates[t];return s===_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].InFeatureSet||s===_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].NotInFeatureSet?s:e===_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].InFeatureSet&&void 0===s?this._countedin<this._topnum?(this._idstates[t]=_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].InFeatureSet,this._countedin++,_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].InFeatureSet):(this._idstates[t]=_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].NotInFeatureSet,_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].NotInFeatureSet):_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].Unknown}_expandPagedSet(n,s,i,a,r){if(null===this._parent)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Parent Paging not implemented"));if(s>this._topnum&&(s=this._topnum),this._countedin>=this._topnum&&n.pagesDefinition.internal.set.length<=n.pagesDefinition.resultOffset){let e=n._known.length;return e>0&&"GETPAGES"===n._known[e-1]&&(n._known.length=e-1),e=n._candidates.length,e>0&&"GETPAGES"===n._candidates[e-1]&&(n._candidates.length=e-1),Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("success")}return this._parent._expandPagedSet(n,s,i,a,r).then((t=>(this._setKnownLength(n)>this._topnum&&(n._known.length=this._topnum),this._setKnownLength(n)>=this._topnum&&(n._candidates.length=0),t)))}_getFeatures(e,n,i,a){const r=[],o=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,o))return this._expandPagedSet(e,o,0,0,a).then((()=>this._getFeatures(e,n,i,a)));-1!==n&&void 0===this._featureCache[n]&&r.push(n);let _=0;for(let t=e._lastFetchedIndex;t<e._known.length&&(_++,_<=i&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[t]]&&(e._known[t]!==n&&r.push(e._known[t]),r.length>o-1)));t++);if(0===r.length)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("success");const h=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_2__["default"]([],r,!1,null),u=Math.min(r.length,i);return this._parent._getFeatures(h,-1,u,a).then((()=>{for(let t=0;t<u;t++){const e=this._parent._featureFromCache(r[t]);void 0!==e&&(this._featureCache[r[t]]=e)}return"success"}))}_getFilteredSet(t,e,n,i,a){return this._ensureLoaded().then((()=>this._getSet(a))).then((t=>new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_2__["default"](t._candidates.slice(0).concat(t._known.slice(0)),[],!1,this._clonePageDefinition(t.pagesDefinition))))}_refineKnowns(t,e){let s=0,i=null;const a=[];for(let r=0;r<t._candidates.length;r++){const o=this._isInFeatureSet(t._candidates[r]);if(o===_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].InFeatureSet){if(t._known.push(t._candidates[r]),s+=1,null===i?i={start:r,end:r}:i.end===r-1?i.end=r:(a.push(i),i={start:r,end:r}),t._known.length>=this._topnum)break}else if(o===_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].NotInFeatureSet)null===i?i={start:r,end:r}:i.end===r-1?i.end=r:(a.push(i),i={start:r,end:r}),s+=1;else if(o===_support_shared_js__WEBPACK_IMPORTED_MODULE_1__["IdState"].Unknown)break;if(s>=e)break}null!==i&&a.push(i);for(let e=a.length-1;e>=0;e--)t._candidates.splice(a[e].start,a[e].end-a[e].start+1);this._setKnownLength(t)>this._topnum&&(t._known=t._known.slice(0,this._topnum)),this._setKnownLength(t)>=this._topnum&&(t._candidates=[])}_stat(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])({calculated:!1})}_canDoAggregates(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1)}static registerAction(){_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_3__["default"]._featuresetFunctions.top=function(t){return new a({parentfeatureset:this,topnum:t})}}}/* harmony default export */ __webpack_exports__["default"] = (a);


/***/ }),

/***/ "jLsz":
/*!***************************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/support/StatsField.js ***!
  \***************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _shared_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./shared.js */ "hTzF");
/* harmony import */ var _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../core/sql/WhereClause.js */ "ZqIb");
/* harmony import */ var _sqlUtils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./sqlUtils.js */ "B8fU");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class n{clone(){const e=new n;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(a,i,s){const o=new n;o.field=a;const l=_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_1__["WhereClause"].create(i,s),p=function(n){if("function"===n.parseTree.type){if(0===n.parseTree.args.value.length)return{name:n.parseTree.name,expr:null};if(n.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");const a=_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_1__["WhereClause"].create(Object(_sqlUtils_js__WEBPACK_IMPORTED_MODULE_2__["toWhereClauseFromTree"])(n.parseTree.args.value[0],_shared_js__WEBPACK_IMPORTED_MODULE_0__["FeatureServiceDatabaseType"].Standardised,n.parameters),n.fieldsIndex);return{name:n.parseTree.name,expr:a}}return null}(l);if(null===p)throw new Error("Invalid Statistic Function");const c=p.name.toUpperCase().trim();if("MIN"===c){if(o.typeofstat="MIN",o.workingexpr=p.expr,null===l)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===c){if(o.typeofstat="MAX",o.workingexpr=p.expr,null===l)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===c)o.typeofstat="COUNT",o.workingexpr=p.expr;else if("STDEV"===c){if(o.typeofstat="STDDEV",o.workingexpr=p.expr,null===l)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===c){if(o.typeofstat="SUM",o.workingexpr=p.expr,null===l)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===c){if(o.typeofstat="AVG",o.workingexpr=p.expr,null===l)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===c){if(o.typeofstat="AVG",o.workingexpr=p.expr,null===l)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==c)throw new Error("Invalid Statistic Function");if(o.typeofstat="VAR",o.workingexpr=p.expr,null===l)throw new Error("Invalid Statistic Function Parameters")}return o}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg";default:return"count"}}}/* harmony default export */ __webpack_exports__["default"] = (n);


/***/ }),

/***/ "lNzE":
/*!******************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureSetCollection.js ***!
  \******************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../core/promiseUtils.js */ "9MzC");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
/* harmony default export */ __webpack_exports__["default"] = (class{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(e,r,t){this._layerById[r]=t,this._layerByName[e]=t}featureSetByName(e,r=!0,t=["*"]){return void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])}featureSetById(e,r=!0,t=["*"]){return void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])}castToText(){return"object, FeatureSetCollection"}resolvePromise(r){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(r)}});


/***/ }),

/***/ "lq8Q":
/*!******************************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/support/OrderbyClause.js ***!
  \******************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function t(t,e){return t===e?0:null===t?-1:null===e?1:t<e?-1:1}class e{constructor(t){const e=t.split(",");this._fields=[],this._directions=[];for(let t=0;t<e.length;t++){const s=e[t].match(/\S+/g);this._fields.push(s[0]),2===s.length?"asc"===s[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let t="";for(let e=0;e<this._fields.length;e++)0!==e&&(t+=","),t+=this._fields[e],1===this._directions[e]?t+=" ASC":t+=" DESC";return t}order(e){e.sort(((e,s)=>{for(let i=0;i<this._fields.length;i++){const r=this.featureValue(e.feature,this._fields[i],i),l=this.featureValue(s.feature,this._fields[i],i);let o=0;if(o=1===this._directions[i]?t(r,l):-1*t(r,l),0!==o)return o}return 0}))}scanForField(t){for(let e=0;e<this._fields.length;e++)if(this._fields[e].toLowerCase().trim()===t.toLowerCase().trim())return!0;return!1}replaceFields(t){let s="";for(let e=0;e<this._fields.length;e++){0!==e&&(s+=",");let i=this._fields[e];for(const e of t)if(i.toLowerCase()===e.field.toLowerCase()){i=e.newfield;break}s+=i,1===this._directions[e]?s+=" ASC":s+=" DESC"}return new e(s)}featureValue(t,e,s){const i=t.attributes[e];if(void 0!==i)return i;for(const i in t.attributes)if(e.toLowerCase()===i.toLowerCase())return this._fields[s]=i,t.attributes[i];return null}}/* harmony default export */ __webpack_exports__["default"] = (e);


/***/ }),

/***/ "nC36":
/*!********************************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/actions/AttributeFilter.js ***!
  \********************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../geometry/SpatialReference.js */ "WZb1");
/* harmony import */ var _support_shared_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../support/shared.js */ "hTzF");
/* harmony import */ var _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../support/IdSet.js */ "ZPxV");
/* harmony import */ var _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../core/sql/WhereClause.js */ "ZqIb");
/* harmony import */ var _support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../support/sqlUtils.js */ "B8fU");
/* harmony import */ var _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../support/FeatureSet.js */ "T3Nt");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class _ extends _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_6__["default"]{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=e.parentfeatureset,e.whereclause instanceof _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_4__["WhereClause"]?(this._whereclause=e.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=e.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_1__["default"]({wkid:4326}),this.geometryType=_support_shared_js__WEBPACK_IMPORTED_MODULE_2__["layerGeometryEsriConstants"].point)}_getSet(t){return null===this._wset?this._ensureLoaded().then((()=>this._parent._getFilteredSet("",null,this._whereclause,null,t))).then((e=>(this._checkCancelled(t),null!==this._whereClauseFunction?this._wset=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__["default"](e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)):this._wset=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__["default"](e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),this._wset))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this._wset)}_isInFeatureSet(e){let t=this._parent._isInFeatureSet(e);return t===_support_shared_js__WEBPACK_IMPORTED_MODULE_2__["IdState"].NotInFeatureSet?t:(t=this._idstates[e],void 0===t?_support_shared_js__WEBPACK_IMPORTED_MODULE_2__["IdState"].Unknown:t)}_getFeature(e,t,s){return this._parent._getFeature(e,t,s)}_getFeatures(e,t,s,i){return this._parent._getFeatures(e,t,s,i)}_featureFromCache(e){return this._parent._featureFromCache(e)}executeWhereClause(e){return this._whereclause.testFeature(e)}executeWhereClauseDeferred(i){if(null!==this._whereClauseFunction)try{const s=this._whereClauseFunction(i);return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["isPromiseLike"])(s)?s:Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(s)}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this.executeWhereClause(i))}_fetchAndRefineFeatures(e,t,s){const r=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__["default"]([],e,!1,null),n=Math.min(t,e.length);return this._parent._getFeatures(r,-1,n,s).then((()=>{if(this._checkCancelled(s),null==this._whereClauseFunction){for(let t=0;t<n;t++){const s=this._parent._featureFromCache(e[t]);!0===this.executeWhereClause(s)?this._idstates[e[t]]=_support_shared_js__WEBPACK_IMPORTED_MODULE_2__["IdState"].InFeatureSet:this._idstates[e[t]]=_support_shared_js__WEBPACK_IMPORTED_MODULE_2__["IdState"].NotInFeatureSet}return"success"}const r=[];for(let t=0;t<n;t++){const s=this._parent._featureFromCache(e[t]);r.push(this.executeWhereClauseDeferred(s))}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["all"])(r).then((s=>{for(let i=0;i<t;i++)!0===s[i]?this._idstates[e[i]]=_support_shared_js__WEBPACK_IMPORTED_MODULE_2__["IdState"].InFeatureSet:this._idstates[e[i]]=_support_shared_js__WEBPACK_IMPORTED_MODULE_2__["IdState"].NotInFeatureSet;return"success"}))}))}_getFilteredSet(e,t,s,i,r){return null!==this._whereClauseFunction||(null!==s?null!==this._whereclause&&(s=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_5__["combine"])(this._whereclause,s)):s=this._whereclause),this._ensureLoaded().then((()=>this._parent._getFilteredSet(e,t,s,i,r))).then((e=>{let t;return this._checkCancelled(r),t=null!==this._whereClauseFunction?new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__["default"](e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)):new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_3__["default"](e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),t}))}_stat(t,s,i,r,n,a,l){if(null!==this._whereClauseFunction)return null===n&&""===i&&null===r?this._manualStat(t,s,a,l):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])({calculated:!1});let h=this._whereclause;return null!==n&&null!==this._whereclause&&(h=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_5__["combine"])(this._whereclause,n)),this._parent._stat(t,s,i,r,h,a,l).then((e=>!1===e.calculated?null===n&&""===i&&null===r?this._manualStat(t,s,a,l):{calculated:!1}:e))}_canDoAggregates(t,s,i,r,n){return null!==this._whereClauseFunction?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1):(null!==n?null!==this._whereclause&&(n=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_5__["combine"])(this._whereclause,n)):n=this._whereclause,null===this._parent?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1):this._parent._canDoAggregates(t,s,i,r,n))}_getAggregatePagesDataSourceDefinition(e,t,i,r,n,a,l){return null===this._parent?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Should never be called")):(null!==n?null!==this._whereclause&&(n=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_5__["combine"])(this._whereclause,n)):n=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,i,r,n,a,l))}static registerAction(){_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_6__["default"]._featuresetFunctions.filter=function(e){if("function"==typeof e)return new _({parentfeatureset:this,whereclause:e});let t=null;return e instanceof _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_4__["WhereClause"]&&(t=e),new _({parentfeatureset:this,whereclause:t})}}}/* harmony default export */ __webpack_exports__["default"] = (_);


/***/ }),

/***/ "oO7B":
/*!************************************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/sources/FeatureLayerDynamic.js ***!
  \************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../geometry/support/jsonUtils.js */ "qatw");
/* harmony import */ var _kernel_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../kernel.js */ "975N");
/* harmony import */ var _request_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../request.js */ "Lqtk");
/* harmony import */ var _Graphic_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../Graphic.js */ "jWBI");
/* harmony import */ var _Attachment_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../Attachment.js */ "db86");
/* harmony import */ var _support_shared_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../support/shared.js */ "hTzF");
/* harmony import */ var _layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../layers/graphics/featureConversionUtils.js */ "ZlUD");
/* harmony import */ var _support_IdSet_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../support/IdSet.js */ "ZPxV");
/* harmony import */ var _support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../support/sqlUtils.js */ "B8fU");
/* harmony import */ var _support_stats_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../support/stats.js */ "sdy9");
/* harmony import */ var _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../support/FeatureSet.js */ "T3Nt");
/* harmony import */ var _core_MD5_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../core/MD5.js */ "fvq6");
/* harmony import */ var _tasks_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../tasks/support/FeatureSet.js */ "8prj");
/* harmony import */ var _tasks_support_StatisticDefinition_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../tasks/support/StatisticDefinition.js */ "875+");
/* harmony import */ var _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../tasks/support/Query.js */ "xk++");
/* harmony import */ var _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../layers/FeatureLayer.js */ "W9Wu");
/* harmony import */ var _tasks_operations_pbfOptimizedFeatureSet_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../tasks/operations/pbfOptimizedFeatureSet.js */ "3Vw2");
/* harmony import */ var _tasks_operations_query_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../tasks/operations/query.js */ "M0H4");
/* harmony import */ var _tasks_QueryTask_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../tasks/QueryTask.js */ "/uz8");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
class q extends _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_11__["default"]{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return _support_shared_js__WEBPACK_IMPORTED_MODULE_6__["defaultMaxRecords"]}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}convertQueryToLruCacheKey(e){const t=Object(_support_shared_js__WEBPACK_IMPORTED_MODULE_6__["stableStringify"])(e.toJSON());return Object(_core_MD5_js__WEBPACK_IMPORTED_MODULE_12__["createMD5Hash"])(t,_core_MD5_js__WEBPACK_IMPORTED_MODULE_12__["outputTypes"].String)}load(){return null===this._loadPromise&&(this._loadPromise=Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["create"])(((e,t)=>{try{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}}),t),this._layer.load()}catch(e){t(e)}}))),this._loadPromise}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if("oid"===t.type)e.push(t);else for(const i of this._layer.outFields)if(i.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}else;if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const i of this.fields)if("oid"===i.type)e.push(i),t.push(i.name);else for(const r of this._overrideFields)if(r.toLowerCase()===i.name.toLowerCase()){e.push(i),t.push(i.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=_support_shared_js__WEBPACK_IMPORTED_MODULE_6__["FeatureServiceDatabaseType"].StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=_support_shared_js__WEBPACK_IMPORTED_MODULE_6__["FeatureServiceDatabaseType"].Standardised)):null!=e&&(e>=10.5&&(this._databaseType=_support_shared_js__WEBPACK_IMPORTED_MODULE_6__["FeatureServiceDatabaseType"].StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=_support_shared_js__WEBPACK_IMPORTED_MODULE_6__["FeatureServiceDatabaseType"].Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}_isInFeatureSet(){return _support_shared_js__WEBPACK_IMPORTED_MODULE_6__["IdState"].InFeatureSet}_refineSetBlock(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(e)}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet("",null,null,null,e))).then((e=>(this._wset=e,e))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this._wset)}_runDatabaseProbe(t){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["create"])(((e,i)=>{try{this._ensureLoaded().then((()=>{try{const r=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__["default"];r.where=t.replace("OBJECTID",this._layer.objectIdField),this._layer.queryObjectIds(r).then((()=>{e(!0)}),(()=>{try{e(!1)}catch(e){i(e)}}))}catch(e){i(e)}}))}catch(e){i(e)}}))}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}queryPBF(e){return e.quantizationParameters={mode:"edit"},Object(_tasks_operations_query_js__WEBPACK_IMPORTED_MODULE_18__["executeQueryPBF"])(this._layer.parsedUrl,e,new _tasks_operations_pbfOptimizedFeatureSet_js__WEBPACK_IMPORTED_MODULE_17__["OptimizedFeatureSetParserContext"]({})).then((e=>_tasks_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_13__["default"].fromJSON(Object(_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_7__["convertToFeatureSet"])(e.data)).unquantize()))}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){const i=new _tasks_QueryTask_js__WEBPACK_IMPORTED_MODULE_19__["default"]({url:this._layer.parsedUrl.path}),r="execute"===t&&this.pbfSupportedForQuery(e);let s=null;if(this.recentlyUsedQueries){const a=this.convertQueryToLruCacheKey(e);s=this.recentlyUsedQueries.getFromCache(a),null===s&&(s=!0!==r?i[t](e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(a,s),s=s.catch((e=>{throw this.recentlyUsedQueries.removeFromCache(a),e})))}return null===s&&(s=!0!==r?i[t](e):this.queryPBF(e)),s}_getFilteredSet(e,t,i,r,s){return this.databaseType().then((a=>{if(this.isTable()&&t&&null!==e&&""!==e){return new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_8__["default"]([],[],!0,null)}if(this._canUsePagination())return this._getFilteredSetUsingPaging(e,t,i,r,s);let n="",l=!1;null!==r&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(n=r.constructClause(),l=!0);const o=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__["default"];return o.where=null===i?null===t?"1=1":"":Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["toWhereClause"])(i,a),this._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=this._makeRelationshipEnum(e),o.outSpatialReference=this.spatialReference,o.orderByFields=""!==n?n.split(","):null,o.geometry=null===t?null:t,o.relationParameter=this._makeRelationshipParam(e),this.executeQuery(o,"executeForIds").then((e=>{null===e&&(e=[]),this._checkCancelled(s);return new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_8__["default"]([],e,l,null)}))}))}_expandPagedSet(e,t,i,r,s){return this._expandPagedSetFeatureSet(e,t,i,r,s)}_getFilteredSetUsingPaging(e,t,r,s,a){try{let i="",n=!1;return null!==s&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(i=s.constructClause(),n=!0),this.databaseType().then((s=>{let l=null===r?null===t?"1=1":"":Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["toWhereClause"])(r,s);this._layer.definitionExpression&&(l=""!==l?"(("+this._layer.definitionExpression+") AND ("+l+"))":this._layer.definitionExpression);let o=this._maxQueryRate();const u=this._layer.capabilities.query.maxRecordCount;void 0!==u&&u<o&&(o=u);let d=null;if(!0===this._pageJustIds)d=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_8__["default"]([],["GETPAGES"],n,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:this._layer.objectIdField,resultRecordCount:o,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:i,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let r=!0;!0===this._removeGeometry&&(r=!1);const s=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]);d=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_8__["default"]([],["GETPAGES"],n,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:s.join(","),resultRecordCount:o,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:i,returnGeometry:r,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return this._expandPagedSet(d,o,0,1,a).then((()=>d))}))}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){try{const t=e.pagesDefinition.internal.lastRetrieved,i=t,s=e.pagesDefinition.internal.lastPage,a=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__["default"];return this._requestStandardised&&(a.sqlFormat="standard"),a.spatialRelationship=e.pagesDefinition.spatialRel,a.relationParameter=e.pagesDefinition.relationParam,a.outFields=e.pagesDefinition.outFields.split(","),a.num=e.pagesDefinition.resultRecordCount,a.start=e.pagesDefinition.internal.lastPage,a.geometry=e.pagesDefinition.geometry,a.where=e.pagesDefinition.where,a.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,a.returnGeometry=e.pagesDefinition.returnGeometry,a.outSpatialReference=this.spatialReference,this.executeQuery(a,"execute").then((a=>{if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return"done";for(let t=0;t<a.features.length;t++)e.pagesDefinition.internal.set[i+t]=a.features[t].attributes[this._layer.objectIdField];if(!1===this._pageJustIds)for(let e=0;e<a.features.length;e++)this._featureCache[a.features[e].attributes[this._layer.objectIdField]]=a.features[e];return(void 0===a.exceededTransferLimit&&a.features.length!==e.pagesDefinition.resultRecordCount||!1===a.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+a.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"}))}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf("*")>-1)return t;let i=!1;for(const e of t)if(e.toUpperCase()===this.objectIdField.toUpperCase()){i=!0;break}return!1===i&&t.push(this.objectIdField),t}_getFeatures(e,r,s,a){const n=[];try{if(-1!==r&&void 0===this._featureCache[r]&&n.push(r),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,a).then((()=>this._getFeatures(e,r,s,a)));let l=0;for(let t=e._lastFetchedIndex;t<e._known.length;t++){if(e._lastFetchedIndex+=1,l++,void 0===this._featureCache[e._known[t]]){let i=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){const r=this._layer._mode;if(void 0!==r._featureMap[e._known[t]]){const s=r._featureMap[e._known[t]];null!==s&&(i=!0,this._featureCache[e._known[t]]=s)}}if(!1===i&&(e._known[t]!==r&&n.push(e._known[t]),n.length>=this._maxProcessingRate()-1))break}if(l>=s&&0===n.length)break}if(0===n.length)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("success");try{const e=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__["default"];return this._requestStandardised&&(e.sqlFormat="standard"),e.objectIds=n,e.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),e.returnGeometry=!0,!0===this._removeGeometry&&(e.returnGeometry=!1),e.outSpatialReference=this.spatialReference,this.executeQuery(e,"execute").then((e=>{if(this._checkCancelled(a),void 0!==e.error)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error(e.error));for(let t=0;t<e.features.length;t++)this._featureCache[e.features[t].attributes[this._layer.objectIdField]]=e.features[t];return"success"}))}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}_getDistinctPages(e,t,r,s,a,n,l,o,u){return this._ensureLoaded().then((()=>this.databaseType())).then((d=>{let h=r.parseTree.column;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name.toLowerCase()===h.toLowerCase()){h=this._layer.fields[e].name;break}const c=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__["default"];this._requestStandardised&&(c.sqlFormat="standard");let p=null===n?null===a?"1=1":"":Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["toWhereClause"])(n,d);return this._layer.definitionExpression&&(p=""!==p?"(("+this._layer.definitionExpression+") AND ("+p+"))":this._layer.definitionExpression),c.where=p,c.spatialRelationship=this._makeRelationshipEnum(s),c.relationParameter=this._makeRelationshipParam(s),c.geometry=null===a?null:a,c.returnDistinctValues=!0,c.returnGeometry=!1,c.outFields=[h],this.executeQuery(c,"execute").then((d=>{if(this._checkCancelled(u),!d.hasOwnProperty("features"))return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Unnexected Result querying statistics from layer"));let c=!1;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name===h){"date"===this._layer.fields[e].type&&(c=!0);break}for(let e=0;e<d.features.length;e++){if(c){const t=d.features[e].attributes[h];null!==t?o.push(new Date(t)):o.push(t)}else o.push(d.features[e].attributes[h]);if(o.length>=l)break}return 0===d.features.length?o:d.features.length===this._layer.capabilities.query.maxRecordCount&&o.length<l?this._getDistinctPages(e+d.features.length,t,r,s,a,n,l,o,u).then((e=>({calculated:!0,result:e}))):o}))}))}_distinctStat(e,t,i,r,s,a,n){return this._getDistinctPages(0,e,t,i,r,s,a,[],n).then((e=>({calculated:!0,result:e})))}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType}_countstat(e,t,i,r){return this.databaseType().then((e=>{const s=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__["default"];if(this._requestStandardised&&(s.sqlFormat="standard"),this.isTable()&&i&&null!==t&&""!==t)return{calculated:!0,result:0};let a=null===r?null===i?"1=1":"":Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["toWhereClause"])(r,e);return this._layer.definitionExpression&&(a=""!==a?"(("+this._layer.definitionExpression+") AND ("+a+"))":this._layer.definitionExpression),s.where=a,s.where=a,s.spatialRelationship=this._makeRelationshipEnum(t),s.relationParameter=this._makeRelationshipParam(t),s.geometry=null===i?null:i,s.returnGeometry=!1,this.executeQuery(s,"executeForCount").then((e=>({calculated:!0,result:e})))}))}_stats(e,t,r,s,a,n,l){return this._ensureLoaded().then((()=>{const o=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,u=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,d=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct;return"count"===e?d?this._countstat(e,r,s,a):{calculated:!1}:!1===u||!1===Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["isSingleField"])(t)&&!1===o||!1===t.isStandardized?""!==r||null!==a?{calculated:!1}:this._manualStat(e,t,n,l):"distinct"===e?!1===d?""!==r||null!==a?{calculated:!1}:this._manualStat(e,t,n,l):this._distinctStat(e,t,r,s,a,n,l):this.databaseType().then((n=>{if(this.isTable()&&s&&null!==r&&""!==r)return{calculated:!0,result:null};const l=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__["default"];this._requestStandardised&&(l.sqlFormat="standard");let o=null===a?null===s?"1=1":"":Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["toWhereClause"])(a,n);this._layer.definitionExpression&&(o=""!==o?"(("+this._layer.definitionExpression+") AND ("+o+"))":this._layer.definitionExpression),l.where=o,l.spatialRelationship=this._makeRelationshipEnum(r),l.relationParameter=this._makeRelationshipParam(r),l.geometry=null===s?null:s;const u=new _tasks_support_StatisticDefinition_js__WEBPACK_IMPORTED_MODULE_14__["default"];u.statisticType=Object(_support_stats_js__WEBPACK_IMPORTED_MODULE_10__["decodeStatType"])(e),u.onStatisticField=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["toWhereClause"])(t,n),u.outStatisticFieldName="ARCADE_STAT_RESULT",l.returnGeometry=!1;let d="ARCADE_STAT_RESULT";return l.outStatistics=[u],this.executeQuery(l,"execute").then((e=>{if(!e.hasOwnProperty("features")||0===e.features.length)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Unnexected Result querying statistics from layer"));let t=!1;for(let i=0;i<e.fields.length;i++)if("ARCADE_STAT_RESULT"===e.fields[i].name.toUpperCase()){d=e.fields[i].name,"date"===e.fields[i].type&&(t=!0);break}if(t){let t=e.features[0].attributes[d];return null!==t&&(t=new Date(e.features[0].attributes[d])),{calculated:!0,result:t}}return{calculated:!0,result:e.features[0].attributes[d]}}))}))}))}_stat(e,t,i,r,s,a,n){return this._stats(e,t,i,r,s,a,n)}_canDoAggregates(e,t){return this._ensureLoaded().then((()=>{let e=!1;const i=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression;if(void 0!==this._layer.capabilities&&null!==this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics&&!0===this._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(let r=0;r<t.length-1;r++)null!==t[r].workingexpr&&(!1===t[r].workingexpr.isStandardized||!1===Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["isSingleField"])(t[r].workingexpr)&&!1===i)&&(e=!1);return!1!==e}))}_makeRelationshipEnum(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,i,r,s,a,n){return this._ensureLoaded().then((()=>this.databaseType())).then((l=>{let o="",u=!1,d=!1;null!==a&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(o=a.constructClause(),d=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(d=!1,u=!0,o=this._layer.objectIdField);const h=[];for(let e=0;e<t.length;e++){const i=new _tasks_support_StatisticDefinition_js__WEBPACK_IMPORTED_MODULE_14__["default"];i.onStatisticField=null!==t[e].workingexpr?Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["toWhereClause"])(t[e].workingexpr,l):"",i.outStatisticFieldName=t[e].field,i.statisticType=t[e].toStatisticsName(),h.push(i)}""===o&&(o=e.join(","));let c=this._maxQueryRate();const p=this._layer.capabilities.query.maxRecordCount;void 0!==p&&p<c&&(c=p);let _=null===s?null===r?"1=1":"":Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_9__["toWhereClause"])(s,l);this._layer.definitionExpression&&(_=""!==_?"(("+this._layer.definitionExpression+") AND ("+_+"))":this._layer.definitionExpression);return new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_8__["default"]([],["GETPAGES"],d,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(i),relationParam:this._makeRelationshipParam(i),outFields:["*"],useOIDpagination:u,generatedOid:n,resultRecordCount:c,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:h,geometry:null===r?null:r,where:_,orderByFields:o,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}))}_getAgregagtePhysicalPage(e,r,s){try{let r=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(r=""!==r?"("+r+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const a=e.pagesDefinition.internal.lastRetrieved,l=a,o=e.pagesDefinition.internal.lastPage,u=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__["default"];return this._requestStandardised&&(u.sqlFormat="standard"),u.where=r,u.spatialRelationship=e.pagesDefinition.spatialRel,u.relationParameter=e.pagesDefinition.relationParam,u.outFields=e.pagesDefinition.outFields,u.outStatistics=e.pagesDefinition.outStatistics,u.geometry=e.pagesDefinition.geometry,u.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,u.num=e.pagesDefinition.resultRecordCount,u.start=e.pagesDefinition.internal.lastPage,u.returnGeometry=e.pagesDefinition.returnGeometry,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&u.geometry&&u.spatialRelationship?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])([]):this.executeQuery(u,"execute").then((t=>{if(this._checkCancelled(s),!t.hasOwnProperty("features"))return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(new Error("Unnexected Result querying aggregates from layer"));const r=[];if(e.pagesDefinition.internal.lastPage!==o)return[];for(let i=0;i<t.features.length;i++)e.pagesDefinition.internal.set[l+i]=t.features[i].attributes[e.pagesDefinition.generatedOid];for(let e=0;e<t.features.length;e++)r.push(new _Graphic_js__WEBPACK_IMPORTED_MODULE_4__["default"]({attributes:t.features[e].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===t.exceededTransferLimit&&t.features.length!==e.pagesDefinition.resultRecordCount||!1===t.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+t.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,r}))}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}static create(e,t,i,r){const s=new _layers_FeatureLayer_js__WEBPACK_IMPORTED_MODULE_16__["default"]({url:e,outFields:null===t?["*"]:t});return new q({layer:s,spatialReference:i,lrucache:r})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return Object(_support_shared_js__WEBPACK_IMPORTED_MODULE_6__["extractServiceUrl"])(this._layer.parsedUrl.path)}queryAttachments(e,i,r,s){if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){const t={objectIds:[e]};return(i&&i>0||r&&r>0)&&(t.size=[i&&i>0?i:0,r&&r>0?r:i+1]),s&&s.length>0&&(t.attachmentTypes=s),this._layer.queryAttachments(t).then((t=>{const i=[];return t&&t[e]&&t[e].forEach((t=>{const r=this._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();i.push(new _Attachment_js__WEBPACK_IMPORTED_MODULE_5__["default"](t.id,t.name,t.contentType,t.size,r))})),i}))}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])([])}queryRelatedFeatures(e){const t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=JSON.stringify(e.outSpatialReference.toJSON())),Object(_request_js__WEBPACK_IMPORTED_MODULE_3__["default"])(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t}).then((e=>{if(e.data){const t={},i=e.data;if(i&&i.relatedRecordGroups){const e=i.spatialReference;for(const s of i.relatedRecordGroups){const a=s.objectId,l=[];for(const t of s.relatedRecords){t.geometry&&(t.geometry.spatialReference=e);const i=new _Graphic_js__WEBPACK_IMPORTED_MODULE_4__["default"]({geometry:t.geometry?Object(_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_1__["fromJSON"])(t.geometry):null,attributes:t.attributes});l.push(i)}t[a]={features:l,exceededTransferLimit:!0===i.exceededTransferLimit}}}return t}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])("Invalid Request")}))}getFeatureByObjectId(e,t){const i=new _tasks_QueryTask_js__WEBPACK_IMPORTED_MODULE_19__["default"]({url:this._layer.parsedUrl.path}),r=new _tasks_support_Query_js__WEBPACK_IMPORTED_MODULE_15__["default"];return r.outFields=t,r.returnGeometry=!1,r.outSpatialReference=this.spatialReference,r.where=this.objectIdField+"="+e.toString(),i.execute(r).then((e=>1===e.features.length?e.features[0]:null))}getIdentityUser(){return this.load().then((()=>{var e;const t=null==(e=_kernel_js__WEBPACK_IMPORTED_MODULE_2__["id"])?void 0:e.findCredential(this._layer.url);return t?t.userId:null}))}getOwningSystemUrl(){return this.load().then((()=>{var i;const r=null==(i=_kernel_js__WEBPACK_IMPORTED_MODULE_2__["id"])?void 0:i.findServerInfo(this._layer.url);if(r)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(r.owningSystemUrl);let n=this._layer.url;const l=n.toLowerCase().indexOf("/rest/services");return n=l>-1?n.substring(0,l):n,n?(n+="/rest/info",Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["create"])(((e,t)=>{Object(_request_js__WEBPACK_IMPORTED_MODULE_3__["default"])(n,{query:{f:"json"}}).then((t=>{let i="";t.data&&t.data.owningSystemUrl&&(i=t.data.owningSystemUrl),e(i)}),(t=>{e("")}))}))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("")}))}}/* harmony default export */ __webpack_exports__["default"] = (q);


/***/ }),

/***/ "uOiI":
/*!************************************************************************!*\
  !*** ./node_modules/@arcgis/core/arcade/featureset/actions/GroupBy.js ***!
  \************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/promiseUtils.js */ "9MzC");
/* harmony import */ var _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../geometry/SpatialReference.js */ "WZb1");
/* harmony import */ var _Graphic_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../Graphic.js */ "jWBI");
/* harmony import */ var _chunks_languageUtils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../chunks/languageUtils.js */ "idrm");
/* harmony import */ var _layers_support_Field_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../layers/support/Field.js */ "ofM5");
/* harmony import */ var _support_shared_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../support/shared.js */ "hTzF");
/* harmony import */ var _support_IdSet_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../support/IdSet.js */ "ZPxV");
/* harmony import */ var _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../core/sql/WhereClause.js */ "ZqIb");
/* harmony import */ var _support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../support/sqlUtils.js */ "B8fU");
/* harmony import */ var _support_stats_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../support/stats.js */ "sdy9");
/* harmony import */ var _layers_support_FieldsIndex_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../layers/support/FieldsIndex.js */ "gLc9");
/* harmony import */ var _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../support/FeatureSet.js */ "T3Nt");
/* harmony import */ var _AttributeFilter_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./AttributeFilter.js */ "nC36");
/* harmony import */ var _Adapted_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./Adapted.js */ "LK1Z");
/* harmony import */ var _support_OrderbyClause_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../support/OrderbyClause.js */ "lq8Q");
/* harmony import */ var _OrderBy_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./OrderBy.js */ "Xbkg");
/* harmony import */ var _support_StatsField_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../support/StatsField.js */ "jLsz");
/* harmony import */ var _core_MD5_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../core/MD5.js */ "fvq6");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
function C(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class G extends _support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_11__["default"]{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(t){return null===this._wset?this._getFilteredSet("",null,null,null,t).then((e=>(this._wset=e,this._wset))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(this._wset)}_isInFeatureSet(){return _support_shared_js__WEBPACK_IMPORTED_MODULE_5__["IdState"].InFeatureSet}nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,i=1;const n=this._parent?this._parent.getFieldsIndex():new _layers_support_FieldsIndex_js__WEBPACK_IMPORTED_MODULE_10__["default"]([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let e=!1;for(let t=0;t<this._config.groupbyfields.length;t++)if(this._config.groupbyfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}if(!1===e)for(let t=0;t<this._config.statsfields.length;t++)if(this._config.statsfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}!1===e?t=!0:(this.objectIdField="ROW__ID"+i.toString(),i++)}for(const e of this._config.statsfields){const t=new _support_StatsField_js__WEBPACK_IMPORTED_MODULE_16__["default"];t.field=e.name,t.tofieldname=e.name,t.workingexpr=e.expression instanceof _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_7__["WhereClause"]?e.expression:_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_7__["WhereClause"].create(e.expression,n),t.typeofstat=C(e.statistic),this._decodedStatsfield.push(t)}this._decodedGroupbyfield=[];for(const e of this._config.groupbyfields){const t={name:e.name,singlefield:null,tofieldname:e.name,expression:e.expression instanceof _core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_7__["WhereClause"]?e.expression:_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_7__["WhereClause"].create(e.expression,n)};this._decodedGroupbyfield.push(t)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const t of this._parent.fields)e[t.name.toUpperCase()]=1;this.types=null}else this.geometryType=_support_shared_js__WEBPACK_IMPORTED_MODULE_5__["layerGeometryEsriConstants"].point,this.typeIdField="",this.types=null,this.spatialReference=new _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_1__["default"]({wkid:4326});this.fields=[];const r=new _support_StatsField_js__WEBPACK_IMPORTED_MODULE_16__["default"];r.field=this.nextUniqueName(e),r.tofieldname=this.objectIdField,r.workingexpr=_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_7__["WhereClause"].create(this._parent.objectIdField,this._parent.getFieldsIndex()),r.typeofstat="MIN",this._decodedStatsfield.push(r);for(const t of this._decodedGroupbyfield){const i=new _layers_support_Field_js__WEBPACK_IMPORTED_MODULE_4__["default"];if(t.name=this.nextUniqueName(e),i.name=t.tofieldname,i.alias=i.name,Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["isSingleField"])(t.expression)){const e=this._parent.getField(Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["toWhereClause"])(t.expression,_support_shared_js__WEBPACK_IMPORTED_MODULE_5__["FeatureServiceDatabaseType"].Standardised));if(!e)throw new Error("Field is not present for Aggregation");t.name=e.name,t.singlefield=e.name,this.phsyicalgroupbyfields.push(e.name),i.type=e.type}else{i.type=this.convertToEsriFieldType(Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["predictType"])(t.expression,this._parent.fields));const e=new _layers_support_Field_js__WEBPACK_IMPORTED_MODULE_4__["default"];e.name=t.name,e.alias=e.name,this.phsyicalgroupbyfields.push(t.name),this._adaptedFields.push(new _Adapted_js__WEBPACK_IMPORTED_MODULE_13__["SqlExpressionAdapted"](e,t.expression)),this._candosimplegroupby=!1}this.fields.push(i)}if(this._adaptedFields.length>0)for(const e of this._parent.fields)this._adaptedFields.push(new _Adapted_js__WEBPACK_IMPORTED_MODULE_13__["OriginalField"](e));for(let t=0;t<this._decodedStatsfield.length;t++){const i=new _layers_support_Field_js__WEBPACK_IMPORTED_MODULE_4__["default"];let s=null;const n=this._decodedStatsfield[t];n.field=this.nextUniqueName(e),n.tofieldname===this.objectIdField&&(this._internalObjectIdField=n.field),i.name=n.tofieldname,i.alias=i.name;const r=null!==n.workingexpr&&Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["isSingleField"])(n.workingexpr)?Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["toWhereClause"])(n.workingexpr,_support_shared_js__WEBPACK_IMPORTED_MODULE_5__["FeatureServiceDatabaseType"].Standardised):"";switch(this._decodedStatsfield[t].typeofstat){case"SUM":if(""!==r){if(s=this._parent.getField(r),!s)throw new Error("Field is not present for Aggregation");i.type=s.type}else i.type="double";break;case"MIN":case"MAX":if(""!==r){if(s=this._parent.getField(r),!s)throw new Error("Field is not present for Aggregation");i.type=s.type}else i.type="double";break;case"COUNT":i.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==r&&(s=this._parent.getField(r),!s))throw new Error("Field is not present for Aggregation");i.type="double"}this.fields.push(i)}}_canDoAggregates(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1)}_getFeatures(t,i,s,n){-1!==i&&this._featureCache[i];const r=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(t,r)?this._expandPagedSet(t,r,0,0,n).then((()=>this._getFeatures(t,i,s,n))):Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])("success")}_getFilteredSet(t,i,s,n,r){if(""!==t)return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_6__["default"]([],[],!0,null));let a=null;const l={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then((()=>{if(null!==s)for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["scanForField"])(s,this._decodedStatsfield[e].tofieldname)){l.nowhereclause=!0,s=null;break}if(null!==n){l.ordered=!0;for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===n.scanForField(this._decodedStatsfield[e].tofieldname)){n=null,l.ordered=!1;break}if(null!==n)for(const e of this._decodedGroupbyfield)if(null===e.singlefield&&!0===n.scanForField(e.tofieldname)){n=null,l.ordered=!1;break}}return!1===this._candosimplegroupby?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(!1):this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,null)})).then((e=>{if(e){let e=null;s&&(e=this._reformulateWhereClauseWithoutGroupByFields(s));let t=null;return n&&(t=this._reformulateOrderClauseWithoutGroupByFields(n)),this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,e,t,this._internalObjectIdField).then((e=>(this._checkCancelled(r),a=!0===l.nowhereclause?new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_6__["default"](e._candidates.slice(0).concat(e._known.slice(0)),[],!0===l.ordered&&e._ordered,this._clonePageDefinition(e.pagesDefinition)):new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_6__["default"](e._candidates.slice(0),e._known.slice(0),!0===l.ordered&&e._ordered,this._clonePageDefinition(e.pagesDefinition)),a)))}let t=this._parent;if(this._adaptedFields.length>0&&(t=new _Adapted_js__WEBPACK_IMPORTED_MODULE_13__["AdaptedFeatureSet"]({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===l.nowhereclause)a=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_6__["default"](["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new _OrderBy_js__WEBPACK_IMPORTED_MODULE_15__["default"]({parentfeatureset:t,orderbyclause:new _support_OrderbyClause_js__WEBPACK_IMPORTED_MODULE_14__["default"](this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}});else{let e=t;if(null!==s){let t=null;s&&(t=this._reformulateWhereClauseWithoutGroupByFields(s)),e=new _AttributeFilter_js__WEBPACK_IMPORTED_MODULE_12__["default"]({parentfeatureset:e,whereclause:t})}a=new _support_IdSet_js__WEBPACK_IMPORTED_MODULE_6__["default"](["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new _OrderBy_js__WEBPACK_IMPORTED_MODULE_15__["default"]({parentfeatureset:e,orderbyclause:new _support_OrderbyClause_js__WEBPACK_IMPORTED_MODULE_14__["default"](this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}})}return a}))}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["reformulateWithoutField"])(e,t.tofieldname,Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["toWhereClause"])(t.workingexpr,_support_shared_js__WEBPACK_IMPORTED_MODULE_5__["FeatureServiceDatabaseType"].Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["reformulateWithoutField"])(e,t.tofieldname,Object(_support_sqlUtils_js__WEBPACK_IMPORTED_MODULE_8__["toWhereClause"])(t.expression,_support_shared_js__WEBPACK_IMPORTED_MODULE_5__["FeatureServiceDatabaseType"].Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const e of this._decodedGroupbyfield)e.tofieldname!==e.name&&t.push({field:e.tofieldname,newfield:e.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(i,s,n){try{if(!0===this._checkIfNeedToExpandCandidatePage(i,this._maxQuery))return this._expandPagedSet(i,this._maxQuery,0,0,n).then((()=>this._refineSetBlock(i,s,n)));this._checkCancelled(n);const t=i._candidates.length;this._refineKnowns(i,s);i._candidates.length;return i._candidates.length,Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(i)}catch(e){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["reject"])(e)}}_expandPagedSet(e,t,i,s,n){return this._expandPagedSetFeatureSet(e,t,i,s,n)}_getPhysicalPage(e,t,s){return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["create"])(((t,i)=>{this._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,s,[]).then((e=>{t(e)}),i)})):this._getAgregagtePhysicalPage(e,t,s).then((e=>{for(const t of e){const e={geometry:t.geometry,attributes:{}};for(const i of this._decodedGroupbyfield)e.attributes[i.tofieldname]=t.attributes[i.name];for(const i of this._decodedStatsfield)e.attributes[i.tofieldname]=t.attributes[i.field];this._featureCache[e.attributes[this.objectIdField]]=new _Graphic_js__WEBPACK_IMPORTED_MODULE_2__["default"](e)}return e.length}))}_sequentialGetPhysicalItem(e,t,s,n){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["create"])(((i,r)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(s)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(n.length):this._nextAggregateItem(e,t,s,n,(r=>{null===r?i(n.length):(t-=1,i(this._sequentialGetPhysicalItem(e,t,s,n)))}),r)}))}_nextAggregateItem(e,t,i,s,n,a){try{Object(_chunks_languageUtils_js__WEBPACK_IMPORTED_MODULE_3__["Q"])(e.pagesDefinition.internal.iterator.next()).then((r=>{if(null===r)if(null!==e.pagesDefinition.internal.workingItem){const t=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);s.push(t),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(t.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,n(null)}else e.pagesDefinition.internal.fullyResolved=!0,n(null);else{const l=this._generateAggregateHash(r);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[r],id:l};else{if(l!==e.pagesDefinition.internal.workingItem.id){const i=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return s.push(i),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(i.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[r],id:l},void n(i)}e.pagesDefinition.internal.workingItem.features.push(r)}this._nextAggregateItem(e,t,i,s,n,a)}}),a)}catch(e){a(e)}}_calculateFieldStat(e,t,i){const s=[];for(let i=0;i<e.features.length;i++)if(null!==t.workingexpr){const n=t.workingexpr.calculateValue(e.features[i]);null!==n&&s.push(n)}else s.push(null);switch(t.typeofstat){case"MIN":i.attributes[t.tofieldname]=Object(_support_stats_js__WEBPACK_IMPORTED_MODULE_9__["calculateStat"])("min",s,-1);break;case"MAX":i.attributes[t.tofieldname]=Object(_support_stats_js__WEBPACK_IMPORTED_MODULE_9__["calculateStat"])("max",s,-1);break;case"SUM":i.attributes[t.tofieldname]=Object(_support_stats_js__WEBPACK_IMPORTED_MODULE_9__["calculateStat"])("sum",s,-1);break;case"COUNT":i.attributes[t.tofieldname]=s.length;break;case"VAR":i.attributes[t.tofieldname]=Object(_support_stats_js__WEBPACK_IMPORTED_MODULE_9__["calculateStat"])("var",s,-1);break;case"STDDEV":i.attributes[t.tofieldname]=Object(_support_stats_js__WEBPACK_IMPORTED_MODULE_9__["calculateStat"])("stddev",s,-1);break;case"AVG":i.attributes[t.tofieldname]=Object(_support_stats_js__WEBPACK_IMPORTED_MODULE_9__["calculateStat"])("avg",s,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const i of this._decodedGroupbyfield){const s=i.singlefield?e.features[0].attributes[i.singlefield]:i.expression.calculateValue(e.features[0]);t.attributes[i.tofieldname]=s}for(const i of this._decodedStatsfield)this._calculateFieldStat(e,i,t);const i=[];for(let s=0;s<this._decodedStatsfield.length;s++)i.push(this._calculateFieldStat(e,this._decodedStatsfield[s],t));return this._featureCache[t.attributes[this.objectIdField]]=new _Graphic_js__WEBPACK_IMPORTED_MODULE_2__["default"]({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const i of this._decodedGroupbyfield){const s=i.singlefield?e.attributes[i.singlefield]:i.expression.calculateValue(e);t+=null==s?":":":"+s.toString()}return Object(_core_MD5_js__WEBPACK_IMPORTED_MODULE_17__["createMD5Hash"])(t,_core_MD5_js__WEBPACK_IMPORTED_MODULE_17__["outputTypes"].String)}_stat(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])({calculated:!1})}getFeatureByObjectId(){return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_0__["resolve"])(null)}static registerAction(){_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_11__["default"]._featuresetFunctions.groupby=function(e,t){return new G({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}/* harmony default export */ __webpack_exports__["default"] = (G);


/***/ })

}]);
//# sourceMappingURL=default~arcade-featureSetUtils-js~arcade-functions-featuresetbase-js-es2015.js.map