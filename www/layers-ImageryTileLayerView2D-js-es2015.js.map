{"version":3,"sources":["./node_modules/@arcgis/core/views/2d/engine/webgl/TiledDisplayObject.js","./node_modules/@arcgis/core/views/support/drapedUtils.js","./node_modules/@arcgis/core/views/2d/engine/RasterTile.js","./node_modules/@arcgis/core/views/2d/engine/RasterBitmap.js","./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","./node_modules/@arcgis/core/views/2d/engine/RasterTileContainer.js","./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js","./node_modules/@arcgis/core/views/layers/ImageryTileLayerView.js","./node_modules/@arcgis/core/views/layers/support/popupUtils.js","./node_modules/@arcgis/core/views/2d/layers/ImageryTileLayerView2D.js"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAC8N,gBAAgB,+DAAC,CAAC,uBAAuB,6DAA6D,IAAI,4DAAC,YAAY,4DAAC,GAAG,mCAAmC,0DAAC,gDAAgD,UAAU,yDAAyD,aAAa,oBAAoB,aAAa,oBAAoB,cAAc,wCAAwC,kBAAkB,uLAAuL,yDAAC,sBAAsB,yDAAC,2CAA2E;;;;;;;;;;;;;ACJp5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAC+Q,uBAAuB,2DAAC,EAAE,MAAM,kCAAkC,uBAAuB,oEAAoE,EAAE,6DAAC,mCAAmC,gFAAC,IAAI,gFAAC,yBAAyB,uCAAuC,mBAAmB,GAAG,kHAAkH,kBAAkB,mBAAmB,GAAG,6DAAC,aAAa,WAAW,oGAAC,sBAAsB,YAAY,2DAAC,CAAgE;;;;;;;;;;;;;ACJr0B;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACoH,gBAAgB,+EAAC,CAAC,0BAA0B,6BAA6B,6DAAC,sFAAsF,kBAAkB,yBAAyB,iBAAiB,8BAA8B,iBAAiB,oCAAoC,kBAAkB,uEAAuE,UAAU,0DAA0D,WAAW,6BAA6B,WAAW,wBAAgD;;;;;;;;;;;;;ACJnqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACid,SAAS,uMAAuM,gBAAgB,+DAAC,CAAC,kCAAkC,gbAAgb,IAAI,4DAAC,GAAG,yDAAyD,2BAA2B,qCAAqC,4BAA4B,6BAA6B,aAAa,oBAAoB,cAAc,mJAAmJ,gBAAgB,uBAAuB,iBAAiB,uFAAuF,cAAc,qBAAqB,eAAe,yCAAyC,oBAAoB,2BAA2B,qBAAqB,+IAA+I,oBAAoB,2BAA2B,qBAAqB,+IAA+I,oBAAoB,6EAA6E,gBAAgB,QAAQ,yDAAC,gLAAgL,yDAAC,KAAK,4DAAC,OAAO,yDAAC,KAAK,4DAAC,WAAW,yDAAC,SAAS,yDAAC,KAAK,4DAAC,aAAa,yDAAC,KAAK,4DAAC,OAAO,yDAAC,0CAA0C,cAAc,oCAAoC,gBAAgB,oPAAoP,oBAAoB,iBAAiB,GAAG,6DAAC,oBAAoB,2BAA2B,oBAAoB,oGAAoG,wBAAwB,WAAW,yBAAyB,WAAW,yBAAyB,eAAe,UAAU,EAAE,UAAU,0RAA0R,oCAAoC,4BAA4B,qDAAqD,2KAA2K,oFAAC,gHAAgH,iCAAiC,QAAQ,oBAAoB,kGAAC,gCAAgC,gKAAgK,oKAAoK,wBAAwB,YAAY,uFAAuF,0HAA0H,oBAAoB,iFAAC,2IAA2I,0BAA0B,4DAA4D,qKAAqK,mFAAC,4DAA4D,mFAAC,+IAAyK;;;;;;;;;;;;;ACJjoK;AAAA;AAAA;AACA;AACA;AACA;AACA,gBAAgB,kIAAkI,gBAAgB,kEAAkE,YAAY,YAAY,WAAW,KAAK,kBAAkB,+BAA+B,WAAW,YAAY,cAAc,wEAAwE,eAAe,4CAA4C,eAAe,gDAAgD,MAAM,oBAAoB,GAAG,wBAAwB,GAAG,QAAQ,iBAAiB,kBAAkB,YAAY,IAAI,YAAY,wBAAwB,qBAAqB,wBAAwB,0CAA0C,4BAA4B,QAAQ,uCAAuC,gBAAgB,KAAK,4BAA4B,QAAQ,sCAAsC,gBAAgB,KAAK,gBAAgD;;;;;;;;;;;;;ACJjgC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACiP,gBAAgB,+DAAC,CAAC,cAAc,yCAAyC,kFAAC,MAAM,WAAW,yDAAC,uCAAuC,eAAe,uBAAuB,8BAA8B,8BAA8B,mDAAC,+DAA+D,4DAAC,KAAK,EAAE,0CAA0C,YAAY,4BAA4B,4DAAC,yBAA0D;;;;;;;;;;;;;ACJ3qB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACgK,iIAAgJ,6EAAc,wDAAC,CAAC,eAAe,6BAA6B,kBAAkB,wEAAwE,sBAAsB,MAAM,QAAQ,GAAG,OAAO,qKAAqK,uBAAuB,8BAA8B,wBAAwB,mEAAC,YAAY,sDAAC,OAAO,sDAAC,KAAK,sDAAC,8CAA8C,0BAA0B,yBAAyB,gEAAC,YAAY,sDAAC,uDAAuD,EAAE,4CAA4C,mBAAmB,qBAAqB,oBAAoB,8BAA8B,oDAAoD,qBAAqB,sBAAsB,QAAQ,+CAA+C,EAAyB;;;;;;;;;;;;;ACJ/tC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAC4uB,YAAY,sBAAsB,cAAc,2JAA2J,uBAAuB,uHAAuH,8BAA8B,MAAM,QAAQ,MAAM,aAAa,qEAAC,KAAK,sDAAC,4EAA4E,QAAQ,GAAG,MAAM,eAAe,KAAK,qFAAC,MAAM,QAAQ,6DAAC,cAAc,sDAAC,6FAA6F,+BAA+B,EAAE,YAAY,QAAQ,qBAAqB,MAAM,QAAQ,wBAAwB,WAAW,8BAA8B,qCAAqC,6EAA6E,kBAAkB,sBAAsB,mEAAmE,qBAAqB,GAAG,eAAe,aAAa,oEAAoE,kCAAkC,qDAAqD,YAAY,oDAAC,iCAAiC,0CAA0C,SAAS,mBAAmB,4BAA4B,MAAM,8BAA8B,sDAAC,wFAAwF,iBAAiB,GAAG,QAAQ,gHAAC,4EAA4E,uBAAuB,sDAAC,8GAA8G,iBAAiB,+BAA+B,qEAAC,IAAI,sEAAC,GAAG,2BAA2B,uBAAuB,8GAA8G,MAAM,QAAQ,gMAAgM,SAAS,mBAAmB,4BAA4B,wBAAwB,MAAM,gIAAgI,gCAAgC,0FAA0F,6BAA6B,mBAAmB,kBAAkB,gCAAgC,OAAO,8DAAC,EAAE,6FAAC,gCAAgC,8DAAC,EAAE,6FAAC,+BAA+B,8DAAC,EAAE,6FAAC,qCAAqC,8DAAC,EAAE,6FAAC,mCAAmC,8DAAC,EAAE,6FAAC,EAAE,yCAAyC,0CAA0C,8DAAC,EAAE,6FAAC,kDAAoF;;;;;;;;;;;;;ACJjmH;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAC0J,sCAAsC,IAAI,6DAAC,aAAa,6CAA6C,sBAAsB,IAAI,8DAA8D,GAAG,+BAA+B,gBAAgB,0FAAC,SAAS,+EAAC,uBAAuB,0BAA0B,8EAAC,iDAAiD,8EAAC,6DAA6D,MAAM,WAAW,GAAG,MAAM,8EAAC,2CAA2C,KAAK,gBAAgB,uCAAuC,6DAAC,oCAAoC,6DAAC,qDAA+G;;;;;;;;;;;;;ACJ50B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACi1D,QAAQ,uDAAC,kEAAkE,oBAAoB,6FAAC,CAAC,6FAAC,CAAC,yEAAC,CAAC,6DAAC,KAAK,cAAc,yeAAye,uEAAC,gCAAgC,aAAa,gCAAgC,4BAA4B,2BAA2B,kFAAkF,4BAA4B,6IAA6I,gEAAC,EAAE,kKAAkK,4DAA4D,aAAa,yBAAyB,sEAAC,OAAO,wBAAwB,+EAAC,OAAO,OAAO,sEAAC,KAAK,oDAAC,EAAE,aAAa,YAAY,GAAG,UAAU,+GAA+G,MAAM,8BAA8B,wDAAwD,sBAAsB,MAAM,2DAA2D,mDAAmD,4DAAC,aAAa,+FAAC,mGAAmG,yKAAyK,8BAA8B,SAAS,2CAA2C,uEAAC,+KAA+K,gEAAC,qDAAqD,6DAAC,EAAE,kFAAkF,yBAAyB,gEAAC,EAAE,kNAAkN,uBAAuB,mFAAC,iFAAiF,kEAAC,iFAAiF,2EAAC,gBAAgB,KAAK,kEAAC,uCAAuC,oHAAoH,2EAAC,gBAAgB,2BAA2B,GAAG,kEAAC,8GAA8G,SAAS,8NAA8N,mGAAC,yDAAyD,YAAY,qBAAqB,aAAa,qBAAqB,UAAU,+HAA+H,oFAAC,2FAA2F,oDAAoD,yBAAyB,2CAA2C,OAAO,oFAAC,gBAAgB,kBAAkB,gOAAgO,aAAa,8DAA8D,eAAe,kDAAkD,oUAAoU,eAAe,uFAAuF,iCAAiC,wBAAwB,eAAe,SAAS,6DAAC,oDAAoD,8BAA8B,6DAAC,wMAAwM,mDAAmD,4BAA4B,qKAAqK,sBAAsB,yCAAyC,2DAAC,EAAE,iEAAiE,GAAG,0BAA0B,CAAC,yHAAC,4BAA4B,oEAAC,SAAS,qCAAqC,EAAE,yGAAyG,6BAA6B,oCAAoC,IAAI,4CAA4C,UAAU,YAAY,uFAAuF,2EAA2E,KAAK,IAAI,6EAA6E,SAAS,2EAAC,gBAAgB,+BAA+B,yCAAyC,4GAA4G,iEAAiE,KAAK,SAAS,wCAAwC,0KAA0K,yEAAyE,wLAAwL,KAAK,0CAA0C,0GAA0G,0SAA0S,SAAS,2EAAC,gBAAgB,sBAAsB,sBAAsB,iKAAiK,MAAM,UAAU,uDAAuD,yCAAyC,qcAAqc,GAAG,MAAM,yEAAC,mCAAmC,6BAA6B,+BAA+B,kFAAkF,8BAA8B,sEAAC,EAAE,sFAAsF,EAAE,iCAAiC,uCAAuC,SAAS,2GAA2G,qFAAqF,4BAA4B,uDAAuD,WAAW,mGAAC,4FAA4F,8DAA8D,4BAA4B,EAAE,mQAAmQ,0BAA0B,sEAAsE,0EAA0E,8DAA8D,4BAA4B,EAAE,4BAA4B,MAAM,yDAAyD,wEAAwE,oGAAC,MAAM,qEAAqE,mGAAC,oFAAoF,iGAAC,gEAAgE,2CAA2C,MAAM,oDAAoD,uBAAuB,qDAAqD,yBAAyB,iCAAiC,yGAAyG,8DAAC,EAAE,6FAAC,+CAA+C,8DAAC,EAAE,6FAAC,oDAAoD,QAAuB,gEAAC,EAAC","file":"layers-ImageryTileLayerView2D-js-es2015.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{s,m as t}from\"../../../../chunks/mat3.js\";import o from\"../../tiling/TileKey.js\";import{c as i}from\"../../../../chunks/mat3f32.js\";import{DisplayObject as e}from\"../DisplayObject.js\";class r extends e{constructor(s,t,e,r=e){super(),this.triangleCountReportedInDebug=0,this.transforms={dvs:i(),tileMat3:i()},this.triangleCount=0,this.key=new o(s),this.bounds=t,this.size=e,this.coordRange=r}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}get coords(){return this._coords}get bounds(){return this._bounds}set bounds(s){this._coords=[s[0],s[3]],this._bounds=s}setTransform(o,i){const e=i/(o.resolution*o.pixelRatio),r=this.transforms.tileMat3,[n,h]=o.toScreenNoRotation([0,0],this.coords),a=this.size[0]/this.coordRange[0]*e,d=this.size[1]/this.coordRange[1]*e;s(r,a,0,0,0,d,0,n,h,1),t(this.transforms.dvs,o.displayViewMat3,r)}}export{r as TiledDisplayObject};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../core/maybe.js\";import r from\"../../geometry/Extent.js\";import\"../../geometry.js\";import{getMetersPerUnitForSR as n}from\"../../core/unitUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";function a(t,i,a,o=new r){let s;if(\"2d\"===a.type)s=i*a.resolution;else if(\"3d\"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?n(o)/n(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,n){const o=n.toMap(e);if(t(o))return!1;return a(o,i(),n,s).intersects(r)}const s=new r;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{TiledDisplayObject as t}from\"./webgl/TiledDisplayObject.js\";import{RasterBitmap as s}from\"./RasterBitmap.js\";class e extends t{constructor(t,e,i,a=null){super(t,e,i),this.bitmap=new s(a,null,null),this.bitmap.coordScale=i,this.bitmap.once(\"isReady\",(()=>this.ready()))}set stencilRef(t){this.bitmap.stencilRef=t}get stencilRef(){return this.bitmap.stencilRef}getMemoryUsage(){return this.bitmap.getMemoryUsage()}setTransform(t,s){super.setTransform(t,s),this.bitmap.transforms.dvs=this.transforms.dvs}release(){return this.destroy(),this.bitmap=null,this.stage=null,!0}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}export{e as RasterTile};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isNone as t}from\"../../../core/maybe.js\";import{i as e,a as s,r,j as i,m as a}from\"../../../chunks/mat3.js\";import{extractBands as o}from\"../../../layers/support/rasterFunctions/pixelUtils.js\";import{c as u}from\"../../../chunks/mat3f32.js\";import{f as n}from\"../../../chunks/vec2f32.js\";import{DisplayObject as h}from\"./DisplayObject.js\";import{createTransformTexture as l,createRasterTexture as d,createColormapTexture as m}from\"../../webgl/rasterUtils.js\";const _={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:\"stretch\"};class p extends h{constructor(t=null,e=null,s=null){super(),this._textureInvalidated=!0,this._memoryUsed=null,this._supportsBilinear=!0,this.stencilRef=0,this.coordScale=[1,1],this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.transforms={dvs:u()},this.source=t,this.transformGrid=e,this.interpolation=s}get symbolizerParameters(){return this._symbolizerParameters||_}set symbolizerParameters(t){this._symbolizerParameters=t}get source(){return this._source}set source(t){this._source=t,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._memoryUsed=null)}get suspended(){return this._suspended}set suspended(t){this._suspended&&!t&&this.stage&&(this.ready(),this.requestRender()),this._suspended=t}get bandIds(){return this._bandIds}set bandIds(t){this._bandIds=t,this.invalidateTexture()}get interpolation(){return this._interpolation}set interpolation(t){this._interpolation=t,this._rasterTexture&&this._rasterTexture.setSamplingMode(!this._supportsBilinear||\"bilinear\"!==t&&\"cubic\"!==t?9728:9729)}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}setTransform(t){const o=e(this.transforms.dvs),[u,h]=t.toScreenNoRotation([0,0],this.x,this.y),l=this.resolution/this.pixelRatio/t.resolution,d=l*this.width,m=l*this.height,_=Math.PI*this.rotation/180;s(o,o,n(u,h)),s(o,o,n(d/2,m/2)),r(o,o,-_),s(o,o,n(-d/2,-m/2)),i(o,o,n(d,m)),a(this.transforms.dvs,t.displayViewMat3,o)}getTextures(){if(!this._rasterTexture)return null;const t=[],e=[];return this._transformGridTexture&&(e.push(this._transformGridTexture),t.push(\"u_transformGrid\")),this._rasterTexture&&(e.push(this._rasterTexture),t.push(\"u_image\")),this._colormapTexture&&(e.push(this._colormapTexture),t.push(\"u_colormap\")),{names:t,textures:e}}getMemoryUsage(){if(t(this._memoryUsed)){const t=this.getTextures();if(null==t)return 0;this._memoryUsed=t.textures.map((t=>t.descriptor.width*t.descriptor.height*4)).reduce(((t,e)=>t+e))}return this._memoryUsed}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:t}){var e,s,r;if(!this.stage)return null==(e=this._rasterTexture)||e.dispose(),null==(s=this._transformGridTexture)||s.dispose(),null==(r=this._colormapTexture)||r.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,void(this._colormapTexture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1;const i=this.source,a=i&&i.pixels&&i.pixels.length>0;this._createOrDestroyRasterTexture(t),this._rasterTexture&&(a?(this._updateColormapTexture(t),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=l(t,this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender())}_createOrDestroyRasterTexture(t){var e,s;const r=this.source?o(this.source,this.bandIds):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null));const i=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&this.bandIds&&this._rasterTextureBandIds.join(\"\")===this.bandIds.join(\"\");if(this._rasterTexture){if(i)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}const a=this.interpolation||\"nearest\",u=this.isRendereredSource||!(null!=(e=t.capabilities.textureFloat)&&e.textureFloat);this._rasterTexture=d(t,r,a,u),this._supportsBilinear=null==(s=t.capabilities.textureFloat)?void 0:s.textureFloatLinear,this._rasterTextureBandIds=this.bandIds}_updateColormapTexture(t){const e=this._colormap,s=this.symbolizerParameters.colormap;return s?e?s.length!==e.length||s.some(((t,s)=>t!==e[s]))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=m(t,s),void(this._colormap=s)):void 0:(this._colormapTexture=m(t,s),void(this._colormap=s)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}export{p as RasterBitmap};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t,e){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?function(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}(t.stops):e}function n(n){const r=n&&n.renderer,s=\"touch\"===(n&&n.event&&n.event.pointerType)?9:6;if(!r)return s;const o=\"visualVariables\"in r?function(t,n){if(!n)return t;const r=n.filter((t=>\"size\"===t.type)).map((n=>{const{maxSize:r,minSize:s}=n;return(e(r,t)+e(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let t=0;t<o;t++)s+=r[t];const f=Math.floor(s/o);return Math.max(f,t)}(s,r.visualVariables):s;if(\"simple\"===r.type)return t(o,r.symbol);if(\"unique-value\"===r.type){let e=o;return r.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===r.type){let e=o;return r.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return r.type,o}export{n as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{create as e}from\"../../../geometry/support/aaBoundingRect.js\";import{WGLDrawPhase as r}from\"./webgl/enums.js\";import{brushes as s}from\"./brushes.js\";import t from\"./webgl/TileContainer.js\";import{RasterTile as i}from\"./RasterTile.js\";class o extends t{createTile(r){const s=this._tileInfoView.getTileBounds(e(),r);return new i(r,s,this._tileInfoView.tileInfo.size)}destroyTile(){}prepareRenderPasses(e){const t=e.registerRenderPass({name:\"bitmap (tile)\",brushes:[s.raster],target:()=>this.children.map((e=>e.bitmap)),drawPhase:r.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===r.MAP&&super.doRender(e)}}export{o as RasterTileContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{WGLDrawPhase as e}from\"./enums.js\";import r from\"./brushes/WGLBrushInfo.js\";import s from\"./brushes/WGLBrushStencil.js\";import t from\"./WGLContainer.js\";const n=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;export default class extends t{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(n),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:r}=e;return{...super.createRenderParams(e),requiredLevel:this._tileInfoView.getClosestInfoForScale(r.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(r.scale)}}prepareRenderPasses(t){const n=t.registerRenderPass({name:\"stencil\",brushes:[s],drawPhase:e.DEBUG|e.MAP|e.HIGHLIGHT,target:()=>this.getStencilTarget()}),i=t.registerRenderPass({name:\"tileInfo\",brushes:[r],drawPhase:e.DEBUG,target:()=>this.children,has:\"esri-tiles-debug\"});return[...super.prepareRenderPasses(t),n,i]}getStencilTarget(){return this.children}updateTransforms(e){for(const r of this.children){const s=this._tileInfoView.getTileResolution(r.key);r.setTransform(e,s)}}setStencilReference(){let e=1;for(const r of this.children)r.stencilRef=e++}}export{n as sortByLevel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as t}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import o from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{reject as s,resolve as n}from\"../../core/promiseUtils.js\";import a from\"../../Graphic.js\";import{projectExtent as l}from\"../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import{getFetchPopupTemplate as p}from\"./support/popupUtils.js\";const u=u=>{let m=class extends u{constructor(){super(...arguments),this._rasterFieldPrefix=\"Raster.\",this.layer=null,this.view=null,this.fullExtent=null,this.tileInfo=null,this.datumTransformation=null}get hasTilingEffects(){return this.layer.renderer&&\"dynamicRangeAdjustment\"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}async fetchPopupFeatures(e,r){const{layer:i}=this;if(!e)return s(new o(\"imageryTileLayerView:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:i}));const{popupEnabled:n}=i,l=p(i,r);if(!n||!t(l))throw new o(\"imageryTileLayerView:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:n,popupTemplate:l});const u=[],{value:m}=await i.identify(e);if(m){var f,c;const e=m.join(\", \"),t={ObjectId:0},r=\"Raster.ServicePixelValue\";t[r]=this._formatAttributeValue(e,r);const o=null==(f=i.rasterInfo)||null==(c=f.attributeTable)?void 0:c.features;if(o&&o.length>0){const r=o.filter((t=>{const r=t.attributes.value||t.attributes.Value||t.attributes.VALUE;return String(r)===e}));if(r.length>0){const e=r[0];if(e)for(const r in e.attributes)if(e.attributes.hasOwnProperty(r)){const i=this._rasterFieldPrefix+r;t[i]=this._formatAttributeValue(e.attributes[r],i)}}}const s=new a(this.fullExtent.clone(),null,t);s.layer=i,s.sourceLayer=s.layer,u.push(s)}return u}updateFullExtent(){const e=this.layer.tileInfo;let t;e&&e.spatialReference||(t=new o(\"layerview:tiling-information-missing\",\"The layer doesn't provide tiling information\",{layer:this.layer}));const r=l(this.layer.fullExtent,this.view.spatialReference,this.datumTransformation);return null==r&&(t=new o(\"layerview:projection-not-supported\",\"The layer extent cannot be projected to the view's spatial reference\",{layer:this.layer})),this._set(\"fullExtent\",r),t?s(t):n()}_formatAttributeValue(e,t){if(\"string\"==typeof e){const r=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,i=this._getFieldInfo(r,t),o=i&&i.format;if(o){let t,r;return e.trim().indexOf(\",\")>-1?(t=\",\",r=t+\" \",this._formatDelimitedString(e,t,r,o)):e.trim().indexOf(\" \")>-1?(t=r=\" \",this._formatDelimitedString(e,t,r,o)):this._formatNumberFromString(e,o)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let i;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==r&&e.fieldName.toLowerCase()!==r.replace(/ /g,\"_\"))&&(i=e,!0))),i}_formatDelimitedString(e,t,r,i){return e&&t&&r&&i?e.trim().split(t).map((e=>this._formatNumberFromString(e,i))).join(r):e}_formatNumberFromString(e,t){if(!e||!t)return e;const r=Number(e);return isNaN(r)?e:t.format(r)}};return e([r()],m.prototype,\"layer\",void 0),e([r()],m.prototype,\"view\",void 0),e([r()],m.prototype,\"fullExtent\",void 0),e([r()],m.prototype,\"tileInfo\",void 0),e([r({readOnly:!0,dependsOn:[\"layer.renderer\"]})],m.prototype,\"hasTilingEffects\",null),m=e([i(\"esri.views.layers.ImageryTileLayerView\")],m),m};export{u as ImageryTileLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l,hasField as t}from\"../../../layers/support/fieldUtils.js\";async function i(i,d=i.popupTemplate){if(!e(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes(\"*\"))return[\"*\"];const r=s?await p(i):[],m=l(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&t(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&t(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&t(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,i as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import{isNone as t,unwrap as i}from\"../../../core/maybe.js\";import s from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{debounce as l,resolve as o,isAbortError as n,createAbortController as h,eachAlways as c}from\"../../../core/promiseUtils.js\";import u from\"../../../geometry/Point.js\";import p from\"../../../geometry/Extent.js\";import\"../../../geometry.js\";import{createScreenPoint as m}from\"../../../core/screenUtils.js\";import d from\"../../../Graphic.js\";import{watch as y}from\"../../../core/watchUtils.js\";import _ from\"../../../layers/support/PixelBlock.js\";import b from\"../../../layers/support/TileInfo.js\";import{extractBands as g}from\"../../../layers/support/rasterFunctions/pixelUtils.js\";import{computeProjectedScales as f}from\"../../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import{update as w,unregister as I,register as P,getRasterId as U}from\"../../../layers/support/rasterDatasets/RawBlockCache.js\";import{RefreshableLayerView as R}from\"../../layers/RefreshableLayerView.js\";import T from\"../../webgl/capabilities.js\";import v from\"../tiling/TileInfoView.js\";import x from\"../tiling/TileQueue.js\";import S from\"../tiling/TileStrategy.js\";import k from\"../../layers/LayerView.js\";import{createQueryGeometry as C}from\"../../support/drapedUtils.js\";import{ImageryTileLayerView as z}from\"../../layers/ImageryTileLayerView.js\";import{RasterTileContainer as j}from\"../engine/RasterTileContainer.js\";import{LayerView2DMixin as V}from\"./LayerView2D.js\";const L=s.getLogger(\"esri.views.2d.layers.ImageryTileLayerView2D\"),q=[0,0];let D=class extends(z(R(V(k)))){constructor(){super(...arguments),this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._bitmapView=null,this._emptyTilePixelBlock=null,this._srcResolutions=null,this._previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._globalUpdateRequested=!1,this.useWebGLForProcessing=!0,this.datumTransformation=null,this._redrawDebounced=l((e=>this._redrawImage(e)),2e3)}initialize(){const e=this.updateFullExtent();this.addResolvingPromise(e)}get useProgressiveUpdate(){return null==this._get(\"useProgressiveUpdate\")||this._get(\"useProgressiveUpdate\")}set useProgressiveUpdate(e){this._tileStrategy&&this.useProgressiveUpdate!==e&&(this._tileStrategy.destroy(),this._bitmapView.removeAllChildren(),this._tileStrategy=new S({cachePolicy:e?\"keep\":\"purge\",resampling:!1,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:e?40:0,tileInfoView:this._tileInfoView}),this._set(\"useProgressiveUpdate\",e),this.requestUpdate())}hitTest(e,t){if(this.suspended)return o(null);const i=this.view.toMap(m(e,t));return o(new d({attributes:{},geometry:i}))}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:i,scale:s}=e.state,r=this._tileInfoView.getClosestInfoForScale(s);if(this.layer.raster){var a;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[r.level],s=t.toJSON?t:p.fromJSON(t);w(this._blockCacheRegistryUrl,this._blockCacheRegistryId,s,i,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(a=this._previousLOD)?void 0:a.level)!==r.level&&(this._previousLOD=r,null!=this._symbolizerParams&&this._updateSymbolizerParams())}this.notifyChange(\"updating\")}attach(){this.layer.increaseRasterJobHandlerUsage(),T().supportsTextureFloat||(this.useWebGLForProcessing=!1),this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0),this._initializeTileInfo(),this._tileInfoView=new v(this.tileInfo,this.fullExtent),this._fetchQueue=new x({tileInfoView:this._tileInfoView,concurrency:10,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new S({cachePolicy:this.useProgressiveUpdate?\"keep\":\"purge\",resampling:!1,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:this.useProgressiveUpdate?40:0,tileInfoView:this._tileInfoView}),this._bitmapView=new j(this._tileInfoView),this.container.addChild(this._bitmapView),this.handles.add([y(this,[\"layer.bandIds\",\"layer.renderer\"],(()=>this._redrawDebounced().catch((e=>{n(e)||L.error(e)})))),y(this,[\"layer.interpolation\"],((e,t)=>{\"majority\"!==e&&\"majority\"!==t||!this._canUseMajorityInterpolationOnDataSource()?this._redrawDebounced().catch((e=>{n(e)||L.error(e)})):this.refreshDebounced()})),y(this,[\"layer.multidimensionalDefinition\"],this.refreshDebounced)],\"attach\"),this._updateBlockCacheRegistry()}detach(){this.handles.remove(\"attach\"),this.layer.decreaseRasterJobHandlerUsage(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,I(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){!this.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=h(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.requestUpdate()}))),this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return C(e,t,this.view)}async doRefresh(){this.updateRequested||this.suspended||(this._updateSymbolizerParams(),this._updateBlockCacheRegistry(),this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>this._enqueueTileFetch(e))),this.notifyChange(\"updating\"))}isUpdating(){return this._fetchQueue.length>0||this._globalUpdateRequested}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(q,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>{e.destroy(),this.requestUpdate()})),this.requestUpdate()}fetchTile(e,s){const r=!t(s)&&s.signal,a=this._canUseWebGLForProcessing(),l={tileInfo:this.tileInfo,signal:i(r),registryId:this._blockCacheRegistryId,requestRawData:a,srcResolution:this._srcResolutions[e.level],datumTransformation:this.datumTransformation,interpolation:a?\"nearest\":this.layer.interpolation};return this.layer.fetchTile(e.level,e.row,e.col,l)}_canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!(\"majority\"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())}_initializeTileInfo(){const e=this.view.spatialReference,t=new u({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:e}),{scales:i,srcResolutions:s}=f(this.layer.rasterInfo,e),r=b.create({spatialReference:e,size:512,scales:i});(0===r.origin.x||r.origin.x>t.x)&&(r.origin=t),this._set(\"tileInfo\",r),this._srcResolutions=null!=s?s:[]}async _enqueueTileFetch(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key),{bandIds:i}=this.layer;let s=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.moving&&0===this._fetchQueue.length){s=!1;try{await this._redrawImage(this._abortController&&this._abortController.signal)}catch(e){n(e)&&L.error(e)}this._globalUpdateRequested=!1}const r=this._canUseWebGLForProcessing();if(r&&!this.hasTilingEffects&&null==this._symbolizerParams&&this._updateSymbolizerParams(),t&&t.pixelBlock){if(r)e.bitmap.source=t.pixelBlock,e.bitmap.isRendereredSource=!1;else{const i={extent:t.extent,pixelBlock:t.pixelBlock},s=await this.layer.applyRenderer(i,this.hasTilingEffects&&this._globalSymbolizerParams&&\"stretch\"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null);e.bitmap.rawPixelData=i,e.bitmap.source=s,e.bitmap.isRendereredSource=!0}e.bitmap.symbolizerParameters=r?this._globalSymbolizerParams||this._symbolizerParams:null,!e.bitmap.transformGrid&&r?e.bitmap.transformGrid=t.transformGrid:e.bitmap.transformGrid=null}else{const t=this._createEmptyTilePixelBlock();e.bitmap.source=t,e.bitmap.symbolizerParameters=r?this._symbolizerParams:null,e.bitmap.transformGrid=null}e.bitmap.bandIds=i,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.bitmap.interpolation=this._getLayerInterpolation(),e.bitmap.suspended=s,e.bitmap.invalidateTexture(),e.once(\"attach\",(()=>this.requestUpdate())),this._bitmapView.addChild(e)}catch(e){n(e)||L.error(e)}this.requestUpdate()}}async _redrawImage(e){this.layer.updateRenderer(),this.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const{bandIds:t}=this.layer,i=this._bitmapView.children.map((async e=>{const i=this._canUseWebGLForProcessing();i?e.bitmap.isRendereredSource=!1:(e.bitmap.source=await this.layer.applyRenderer(e.bitmap.rawPixelData,this.hasTilingEffects&&this._globalSymbolizerParams&&\"stretch\"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null),e.bitmap.isRendereredSource=!0),e.bitmap.symbolizerParameters=i?this._globalSymbolizerParams||this._symbolizerParams:null,e.bitmap.bandIds=t,e.bitmap.interpolation=this._getLayerInterpolation(),e.bitmap.suspended=!1}));await c(i),this.container.requestRender()}_createEmptyTilePixelBlock(){if(!this._emptyTilePixelBlock){const e=this._tileInfoView.tileInfo.size[0],t=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new _({width:e,height:t,pixels:[new Uint8Array(e*t)],mask:new Uint8Array(e*t),pixelType:\"u8\"})}return this._emptyTilePixelBlock}async _updateGlobalSymbolizerParams(e){const t={srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:e},i=await this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,t);if(!i||!i.pixelBlock)return;const s=this.layer.symbolizer.generateWebGLParameters({pixelBlock:g(i.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds});!this._canUseWebGLForProcessing()&&s&&\"stretch\"===s.type&&this.layer.renderer&&\"raster-stretch\"===this.layer.renderer.type&&(s.factor=s.factor.map((e=>255*e)),s.outMin=Math.round(255*s.outMin),s.outMax=Math.round(255*s.outMax)),this._globalSymbolizerParams=s}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(){const{url:e,rasterInfo:t,multidimensionalDefinition:i,raster:s}=this.layer,r=null!=t&&t.multidimensionalInfo?s.getSliceIndex(i):null,a=U(e,r);a!==this._blockCacheRegistryUrl&&(null==this._blockCacheRegistryUrl&&I(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=P(a,this.layer.raster.rasterInfo),this._blockCacheRegistryUrl=a)}_canUseMajorityInterpolationOnDataSource(){const{bandCount:e,attributeTable:t,colormap:i,pixelType:s}=this.layer.rasterInfo;return 1===e&&(null!=t||null!=i||\"u8\"===s||\"s8\"===s)}_getLayerInterpolation(){const e=this.layer.renderer.type;return\"raster-colormap\"===e||\"unique-value\"===e||\"class-breaks\"===e?\"nearest\":this.layer.interpolation}};e([r()],D.prototype,\"useProgressiveUpdate\",null),D=e([a(\"esri.views.2d.layers.ImageryTileLayerView2D\")],D);var G=D;export default G;\n"],"sourceRoot":"webpack:///"}