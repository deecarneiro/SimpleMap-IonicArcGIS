{"version":3,"sources":["webpack:///node_modules/@arcgis/core/layers/graphics/data/FeatureFilter.js","webpack:///node_modules/@arcgis/core/views/2d/layers/features/support/whereUtils.js"],"names":["_","getLogger","t","_geometryBounds","_idToVisibility","Map","_serviceInfo","_hash","_applyFilter","_resetAllHiddenIds","update","show","hide","forEach","e","set","i","s","Set","r","o","get","h","has","push","geometry","spatialRel","where","timeExtent","objectIds","fromJSON","JSON","stringify","_setGeometryFilter","_setIdFilter","_setAttributeFilter","_setTimeFilter","_clause","fieldsIndex","_idsToShow","_idsToHide","hiddenIds","_spatialQueryOperator","geometryType","hasZ","hasM","_timeOperator","timeInfo","error","_filterByGeometry","_filterById","_filterByTime","_filterByExpression","size","getObjectId","readHydratedGeometry","a","getAttribute","field","n","WhereClause","create","isStandardized","readArcadeFeature","testFeature","warn"],"mappings":"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","file":"layers-graphics-data-FeatureFilter-js-es5.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import e from\"../../../core/Logger.js\";import i from\"../../../core/Error.js\";import{all as s}from\"../../../core/promiseUtils.js\";import{getBoundsXY as r}from\"../../../geometry/support/boundsUtils.js\";import{create as o}from\"../../../geometry/support/aaBoundingRect.js\";import h from\"../../../tasks/support/Query.js\";import{n as a,g as l}from\"../../../chunks/spatialQuerySupport.js\";import{getTimeOperator as n}from\"./timeSupport.js\";import{featureAdapter as d}from\"../../../views/2d/layers/features/FeatureStore2D.js\";import{createWhereClause as m}from\"../../../views/2d/layers/features/support/whereUtils.js\";const _=e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\");export default class{constructor(t){this._geometryBounds=o(),this._idToVisibility=new Map,this._serviceInfo=t}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,1)}setTrue(t){const e=[],i=[],s=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const o=!!(1&this._idToVisibility.get(r)),h=s.has(r);!o&&h?e.push(r):o&&!h&&i.push(r),this._idToVisibility.set(r,h?3:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r}=this;return h.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await a(t,null,e);await s([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t||!t.where)return this._clause=null,void(this.where=null);this._clause=await m(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t&&t.objectIds&&new Set(t.objectIds),this._idsToHide=t&&t.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t&&t.objectIds}async _setGeometryFilter(t){if(!t||!t.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||\"esriSpatialRelIntersects\",s=await l(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);r(this._geometryBounds,e),this._spatialQueryOperator=s,this.geometry=e,this.spatialRel=i}_setTimeFilter(t){if(this.timeExtent=this._timeOperator=null,t&&t.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=t.timeExtent,this._timeOperator=n(this._serviceInfo.timeInfo,t.timeExtent,d);else{const e=new i(\"feature-layer-view:time-filter-not-available\",\"Unable to apply time filter, as layer doesn't have time metadata.\",t.timeExtent);_.error(e)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readHydratedGeometry();return!!e&&this._spatialQueryOperator(e)}_filterByTime(e){return!t(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{1&e||(this._idToVisibility.set(i,1),t.push(i))})),t}}\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Logger.js\";import r from\"../../../../../core/Error.js\";const t=e.getLogger(\"esri.views.2d.layers.features.support.whereUtils\"),a={getAttribute:(e,r)=>e.field(r)};async function s(e,s){const n=await import(\"../../../../../core/sql/WhereClause.js\");try{const o=n.WhereClause.create(e,s);if(!o.isStandardized){const e=new r(\"mapview - bad input\",\"Unable to apply filter's definition expression, as expression is not standardized.\",o);t.error(e)}return e=>{const r=e.readArcadeFeature();return o.testFeature(r,a)}}catch(r){return t.warn(\"mapview-bad-where-clause\",\"Encountered an error when evaluating where clause\",e),e=>!0}}export{s as createWhereClause};\n"]}