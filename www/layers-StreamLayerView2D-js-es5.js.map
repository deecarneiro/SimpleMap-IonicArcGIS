{"version":3,"sources":["webpack:///node_modules/@arcgis/core/views/2d/layers/StreamLayerView2D.js"],"names":["p","e","o","i","geometry","toJSON","where","l","arguments","_enabledDataReceived","errorString","connectionStatus","handles","add","layer","watch","_update","t","_proxy","enableEvent","r","remove","closed","hasEventListener","timeInfo","endField","startField","queryLatestObservations","_cleanUpQuery","then","fromJSON","features","forEach","sourceLayer","setProperty","set","propertyName","value","JSON","stringify","purgeOptions","definitionExpression","geometryDefinition","objectIdField","fields","map","geometryType","s","spatialReference","type","source","parsedUrl","serviceFilter","enableDataReceived","maxReconnectionAttempts","maxReconnectionInterval","updateInterval","prototype","dependsOn","readOnly","d"],"mappings":"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","file":"layers-StreamLayerView2D-js-es5.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import{isNone as t,isSome as r}from\"../../../core/maybe.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../core/Error.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import n from\"../../../tasks/support/FeatureSet.js\";import{toJSONGeometryType as a}from\"./support/util.js\";import c from\"./FeatureLayerView2D.js\";function p(e,o){if(t(e)&&t(o))return null;const i={};return r(o)&&(i.geometry=o.toJSON()),r(e)&&(i.where=e),i}let l=class extends c{constructor(){super(...arguments),this._enabledDataReceived=!1,this.errorString=null,this.connectionStatus=\"disconnected\"}initialize(){this.handles.add([this.layer.watch(\"purgeOptions\",(()=>this._update()))])}destroy(){this.connectionStatus=\"disconnected\"}get connectionError(){if(this.errorString)return new s(\"stream-controller\",this.errorString)}on(e,t){\"data-received\"===e&&(this._enabledDataReceived=!0,this._proxy.enableEvent(\"data-received\",!0));const r=super.on(e,t),o=this;return{remove(){r.remove(),\"data-received\"===e&&(o._proxy.closed||o.hasEventListener(\"data-received\")||o._proxy.enableEvent(\"data-received\",!1))}}}queryLatestObservations(e,t){if(!(this.layer.timeInfo.endField||this.layer.timeInfo.startField))throw new s(\"streamlayer-no-timeField\",\"queryLatestObservation can only be used with services that define a TrackIdField\");return this._proxy.queryLatestObservations(this._cleanUpQuery(e),t).then((e=>{const t=n.fromJSON(e);return t.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),t}))}_createClientOptions(){return{...super._createClientOptions(),setProperty:e=>{this.set(e.propertyName,e.value)}}}_createTileRendererHash(e){const t=`${JSON.stringify(this.layer.purgeOptions)}.${JSON.stringify(p(this.layer.definitionExpression,this.layer.geometryDefinition))})`;return super._createTileRendererHash(e)+t}async _createServiceOptions(){const e=this.layer,{objectIdField:t}=e,r=e.fields.map((e=>e.toJSON())),o=a(e.geometryType),i=e.timeInfo&&e.timeInfo.toJSON()||null,s=e.spatialReference?e.spatialReference.toJSON():null;return{type:\"stream\",fields:r,geometryType:o,objectIdField:t,timeInfo:i,source:this.layer.parsedUrl,serviceFilter:p(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),enableDataReceived:this._enabledDataReceived,spatialReference:s,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,updateInterval:this.layer.updateInterval}}};e([o()],l.prototype,\"errorString\",void 0),e([o({dependsOn:[\"errorString\"],readOnly:!0})],l.prototype,\"connectionError\",null),e([o()],l.prototype,\"connectionStatus\",void 0),l=e([i(\"esri.views.2d.layers.StreamLayerView2D\")],l);var d=l;export default d;\n"]}