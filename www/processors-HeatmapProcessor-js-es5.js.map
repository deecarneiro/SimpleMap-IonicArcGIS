{"version":3,"sources":["webpack:///node_modules/@arcgis/core/views/2d/layers/features/processors/HeatmapProcessor.js"],"names":["a","arguments","type","_tileKeyToFeatureSets","Map","handles","add","tileStore","on","onTileUpdate","bind","e","t","r","schema","processors","_schema","mesh","removed","key","id","s","has","set","i","get","addOrUpdate","instance","end","forEach","p","push","c","n","tileKey","intensityInfo","d","matrix","remoteClient","invoke","transferList","error"],"mappings":"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","file":"processors-HeatmapProcessor-js-es5.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import\"../../../../../core/has.js\";import{isSome as t}from\"../../../../../core/maybe.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../../core/urlUtils.js\";import\"../../../../../core/uuid.js\";import\"../../../../../portal/support/resourceExtension.js\";import{diff as s}from\"../../../../../core/accessorSupport/diffUtils.js\";import{calculateHeatmapIntensityInfoReaders as o}from\"../../../../../renderers/support/heatmapUtils.js\";import i from\"./BaseProcessor.js\";let a=class extends i{constructor(){super(...arguments),this.type=\"heatmap\",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on(\"update\",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];if(\"heatmap\"!==r.type)return;s(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}async onTileData(e,r,s){this._tileKeyToFeatureSets.has(e.key.id)&&\"replace\"!==r.type||this._tileKeyToFeatureSets.set(e.key.id,new Map);const i=this._tileKeyToFeatureSets.get(e.key.id);t(r.addOrUpdate)&&i.set(r.addOrUpdate.instance,r);let a=r.end;if(i.forEach((e=>a=a||e.end)),!a)return;const p=[];i.forEach((e=>{t(e.addOrUpdate)&&p.push(e.addOrUpdate)}));const c=o(p,this._schema.mesh,512,512),n={tileKey:e.key.id,intensityInfo:c},d=[c.matrix];return this.remoteClient.invoke(\"tileRenderer.onTileData\",n,{...s,transferList:d})}onTileError(e,t,r){return this.remoteClient.invoke(\"tileRenderer.onTileError\",{tileKey:e.id,error:t},r)}};a=e([r(\"esri.views.2d.layers.features.processors.HeatmapProcessor\")],a);var p=a;export default p;\n"]}