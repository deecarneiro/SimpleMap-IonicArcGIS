{"version":3,"sources":["webpack:///node_modules/@arcgis/core/views/2d/engine/webgl/effects/post-processing/DropShadow.js"],"names":["s","o","a","_horizontalBlurFBO","_verticalBlurFBO","_size","_programDesc","blur","vsPath","fsPath","attributes","a_position","composite","blit","_layerFBOTexture","dispose","e","r","l","context","n","state","u","painter","h","pixelRatio","p","materialManager","d","c","width","_","height","m","Math","round","f","blurRadius","B","offsetX","g","offsetY","b","color","F","_createOrResizeResources","x","T","setStencilWriteMask","setStencilTestEnabled","setDepthWriteEnabled","setDepthTestEnabled","O","copyToTexture","_quad","setViewport","w","bind","setBlendingEnabled","v","getProgram","name","value","ceil","bindProgram","bindFramebuffer","bindTexture","colorTexture","setUniformMatrix3fv","displayMat3","setUniform2fv","setUniform1i","setUniform1f","draw","z","setUniform4fv","setBlendFunction","unbind","t","i","resize","colorTarget","depthStencilTarget","target","pixelFormat","internalFormat","dataType","wrapMode","samplingMode","flipped"],"mappings":"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","file":"DropShadow-js-es5.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport\"../../../../../../core/has.js\";import{pt2px as t}from\"../../../../../../core/screenUtils.js\";import\"../../../../../../chunks/builtins.js\";import e from\"../../../../../webgl/Texture.js\";import r from\"../../../../../webgl/FramebufferObject.js\";import\"../../../../../webgl/RenderingContext.js\";import i from\"../../VertexStream.js\";const s=[1,0],o=[0,1];class a{constructor(){this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._programDesc={blur:{vsPath:\"post-processing/drop-shadow\",fsPath:\"post-processing/blur/gaussianBlur\",attributes:{a_position:0}},composite:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/drop-shadow/composite\",attributes:{a_position:0}},blit:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/blit\",attributes:{a_position:0}}}}dispose(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null),this._horizontalBlurFBO&&(this._horizontalBlurFBO.dispose(),this._horizontalBlurFBO=null),this._verticalBlurFBO&&(this._verticalBlurFBO.dispose(),this._verticalBlurFBO=null)}draw(e,r,a){const{context:l,state:n,painter:u,pixelRatio:h}=e,{materialManager:p}=u,d=this._programDesc,c=r.width,_=r.height,m=[Math.round(c/2),Math.round(_/2)],{blurRadius:f,offsetX:B,offsetY:g,color:b}=a,F=[h*t(B/2),h*t(g/2)];this._createOrResizeResources(e,c,_,m);const x=this._horizontalBlurFBO,T=this._verticalBlurFBO;l.setStencilWriteMask(0),l.setStencilTestEnabled(!1),l.setDepthWriteEnabled(!1),l.setDepthTestEnabled(!1);const O=this._layerFBOTexture;r.copyToTexture(0,0,c,_,0,0,O),this._quad||(this._quad=new i(l,[-1,-1,1,-1,-1,1,1,1])),l.setViewport(0,0,m[0],m[1]);const w=this._quad;w.bind(),l.setBlendingEnabled(!1);const v=p.getProgram(e,d.blur,[{name:\"radius\",value:Math.ceil(f)}]);l.bindProgram(v),l.bindFramebuffer(x),l.bindTexture(r.colorTexture,4),v.setUniformMatrix3fv(\"u_displayViewMat3\",n.displayMat3),v.setUniform2fv(\"u_offset\",F),v.setUniform1i(\"u_colorTexture\",4),v.setUniform2fv(\"u_texSize\",m),v.setUniform2fv(\"u_direction\",s),v.setUniform1f(\"u_sigma\",f),w.draw(),l.bindFramebuffer(T),l.bindTexture(x.colorTexture,5),v.setUniformMatrix3fv(\"u_displayViewMat3\",n.displayMat3),v.setUniform2fv(\"u_offset\",[0,0]),v.setUniform1i(\"u_colorTexture\",5),v.setUniform2fv(\"u_direction\",o),w.draw(),l.bindFramebuffer(r),l.setViewport(0,0,c,_);const z=p.getProgram(e,d.composite);l.bindProgram(z),l.bindTexture(T.colorTexture,2),z.setUniform1i(\"u_blurTexture\",2),l.bindTexture(O,3),z.setUniform1i(\"u_layerFBOTexture\",3),z.setUniform4fv(\"u_shadowColor\",[b[3]*(b[0]/255),b[3]*(b[1]/255),b[3]*(b[2]/255),b[3]]),w.draw(),l.setBlendingEnabled(!0),l.setStencilTestEnabled(!0),l.setBlendFunction(1,771),w.unbind()}_createOrResizeResources(t,i,s,o){const{context:a}=t;this._horizontalBlurFBO&&this._size[0]===i&&this._size[1]===s||(this._size[0]=i,this._size[1]=s,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(o[0],o[1]):this._horizontalBlurFBO=new r(a,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(o[0],o[1]):this._verticalBlurFBO=new r(a,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(i,s):this._layerFBOTexture=new e(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:i,height:s}))}}export{a as DropShadow};\n"]}