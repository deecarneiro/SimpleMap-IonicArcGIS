{"version":3,"sources":["./node_modules/@arcgis/core/views/2d/engine/webgl/TiledDisplayObject.js","./node_modules/@arcgis/core/views/2d/layers/WMTSLayerView2D.js","./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAC8N,gBAAgB,+DAAC,CAAC,uBAAuB,6DAA6D,IAAI,4DAAC,YAAY,4DAAC,GAAG,mCAAmC,0DAAC,gDAAgD,UAAU,yDAAyD,aAAa,oBAAoB,aAAa,oBAAoB,cAAc,wCAAwC,kBAAkB,uLAAuL,yDAAC,sBAAsB,yDAAC,2CAA2E;;;;;;;;;;;;;ACJp5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACw9B,yCAAyC,oBAAoB,6FAAC,CAAC,wFAAC,CAAC,yEAAC,CAAC,6DAAC,KAAK,cAAc,sCAAsC,yDAAC,0FAA0F,oBAAoB,sFAAsF,yEAAyE,8DAA8D,UAAU,YAAY,UAAU,6IAA6I,SAAS,oDAAoD,aAAa,oCAAoC,yCAAyC,kBAAkB,sGAAC,uDAAuD,gEAAC,oCAAoC,6DAAC,EAAE,6DAA6D,yBAAyB,gEAAC,EAAE,yHAAyH,oHAAoH,SAAS,2JAA2J,YAAY,qBAAqB,aAAa,qBAAqB,UAAU,qBAAqB,kBAAkB,sDAAsD,aAAa,iCAAiC,eAAe,kDAAkD,+MAA+M,SAAS,oEAAoE,2FAA2F,cAAc,0EAAC,qGAAqG,IAAI,kGAAkG,eAAe,kCAAkC,+JAA+J,mBAAmB,iDAAiD,YAAY,0BAA0B,qCAAqC,WAAW,+DAA+D,2BAA2B,qBAAqB,SAAS,wEAAwE,kEAAkE,IAAI,sFAAsF,iCAAiC,uCAAuC,mCAAmC,iCAAiC,4EAA4E,8GAA8G,8DAAC,EAAE,6FAAC,EAAE,4BAA4B,mCAAmC,8DAAC,EAAE,6FAAC,EAAE,oEAAoE,uCAAuC,8DAAC,EAAE,6FAAC,6CAA6C,QAAuB,gEAAC,EAAC;;;;;;;;;;;;;ACJv7I;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACgK,iIAAgJ,6EAAc,wDAAC,CAAC,eAAe,6BAA6B,kBAAkB,wEAAwE,sBAAsB,MAAM,QAAQ,GAAG,OAAO,qKAAqK,uBAAuB,8BAA8B,wBAAwB,mEAAC,YAAY,sDAAC,OAAO,sDAAC,KAAK,sDAAC,8CAA8C,0BAA0B,yBAAyB,gEAAC,YAAY,sDAAC,uDAAuD,EAAE,4CAA4C,mBAAmB,qBAAqB,oBAAoB,8BAA8B,oDAAoD,qBAAqB,sBAAsB,QAAQ,+CAA+C,EAAyB","file":"layers-WMTSLayerView2D-js-es2015.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{s,m as t}from\"../../../../chunks/mat3.js\";import o from\"../../tiling/TileKey.js\";import{c as i}from\"../../../../chunks/mat3f32.js\";import{DisplayObject as e}from\"../DisplayObject.js\";class r extends e{constructor(s,t,e,r=e){super(),this.triangleCountReportedInDebug=0,this.transforms={dvs:i(),tileMat3:i()},this.triangleCount=0,this.key=new o(s),this.bounds=t,this.size=e,this.coordRange=r}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}get coords(){return this._coords}get bounds(){return this._bounds}set bounds(s){this._coords=[s[0],s[3]],this._bounds=s}setTransform(o,i){const e=i/(o.resolution*o.pixelRatio),r=this.transforms.tileMat3,[n,h]=o.toScreenNoRotation([0,0],this.coords),a=this.size[0]/this.coordRange[0]*e,d=this.size[1]/this.coordRange[1]*e;s(r,a,0,0,0,d,0,n,h,1),t(this.transforms.dvs,o.displayViewMat3,r)}}export{r as TiledDisplayObject};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as s}from\"../../../core/promiseUtils.js\";import{geographicToWebMercator as r}from\"../../../geometry/support/webMercatorUtils.js\";import l from\"../../../core/Handles.js\";import{RefreshableLayerView as a}from\"../../layers/RefreshableLayerView.js\";import o from\"../tiling/TileInfoView.js\";import h from\"../tiling/TileQueue.js\";import n from\"../tiling/TileStrategy.js\";import u from\"../../layers/LayerView.js\";import{LayerView2DMixin as c}from\"./LayerView2D.js\";import{BitmapTileLayerView2D as p}from\"./BitmapTileLayerView2D.js\";const f=[102113,102100,3857,3785,900913];let d=class extends(a(p(c(u)))){constructor(){super(...arguments),this._handles=new l,this._tileStrategy=null,this._fetchQueue=null,this._tileRequests=new Map,this.layer=null}get tileMatrixSet(){if(this.layer.activeLayer.tileMatrixSetId)return this.layer.activeLayer.tileMatrixSet;const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(this.layer.activeLayer.tileMatrixSetId=e.id,e):null}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){const e=this.layer.activeLayer,t=this.tileMatrixSet;if(!t)return;const i=t.tileInfo.spatialReference;let s=e.fullExtent&&e.fullExtent.clone();i.isWebMercator?s=r(s):i.isWGS84||(s=t.fullExtent),this._tileInfoView=new o(t.tileInfo,s),this._fetchQueue=new h({tileInfoView:this._tileInfoView,process:e=>this.fetchTile(e)}),this._tileStrategy=new n({cachePolicy:\"keep\",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this._handles.add(this.watch([\"layer.activeLayer.styleId\",\"tileMatrixSet\"],(()=>this._refresh()))),super.attach()}detach(){super.detach(),this._handles.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}async doRefresh(){this.updateRequested||this.suspended||this._refresh()}isUpdating(){return this._fetchQueue.length>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;[i.x,i.y]=this._tileInfoView.getTileCoords([0,0],t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._tileInfoView.getTileCoords(i,t.key);const r={id:e.id,fulfilled:!1,promise:this._fetchQueue.push(t.key).then((e=>{t.bitmap.source=e,t.once(\"attach\",(()=>this.requestUpdate())),this._bitmapView.addChild(t)})).catch((e=>{s(e)||(t.bitmap.source=null,t.once(\"attach\",(()=>this.requestUpdate())),this._bitmapView.addChild(t))}))};return r.promise.finally((()=>r.fulfilled=!0)),this._tileRequests.set(t,r),this.requestUpdate(),t}releaseTile(e){const t=this._tileRequests.get(e);t.fulfilled||this._fetchQueue.abort(t.id),this._tileRequests.delete(e),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e){return this.layer.fetchTile(e.level,e.row,e.col)}canResume(){const e=super.canResume();return e?null!==this.tileMatrixSet:e}_refresh(){this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>{if(!e.bitmap.source)return;e.bitmap.source=null;const t={id:e.key.id,fulfilled:!1,promise:this._fetchQueue.push(e.key).then((t=>{e.bitmap.source=t,e.requestRender(),this.notifyChange(\"updating\")}))};t.promise.then((()=>t.fulfilled=!0),(()=>t.fulfilled=!0)),this._tileRequests.set(e,t)})),this.notifyChange(\"updating\")}_getTileMatrixSetBySpatialReference(e){const t=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find((e=>e.tileInfo.spatialReference.wkid===t.wkid));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((e=>f.indexOf(e.tileInfo.spatialReference.wkid)>-1))),i}};e([t({dependsOn:[\"tileMatrixSet\"]})],d.prototype,\"suspended\",void 0),e([t({readOnly:!0,dependsOn:[\"view.spatialReference\",\"layer.activeLayer\"]})],d.prototype,\"tileMatrixSet\",null),d=e([i(\"esri.views.2d.layers.WMTSLayerView2D\")],d);var m=d;export default m;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{WGLDrawPhase as e}from\"./enums.js\";import r from\"./brushes/WGLBrushInfo.js\";import s from\"./brushes/WGLBrushStencil.js\";import t from\"./WGLContainer.js\";const n=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;export default class extends t{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(n),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:r}=e;return{...super.createRenderParams(e),requiredLevel:this._tileInfoView.getClosestInfoForScale(r.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(r.scale)}}prepareRenderPasses(t){const n=t.registerRenderPass({name:\"stencil\",brushes:[s],drawPhase:e.DEBUG|e.MAP|e.HIGHLIGHT,target:()=>this.getStencilTarget()}),i=t.registerRenderPass({name:\"tileInfo\",brushes:[r],drawPhase:e.DEBUG,target:()=>this.children,has:\"esri-tiles-debug\"});return[...super.prepareRenderPasses(t),n,i]}getStencilTarget(){return this.children}updateTransforms(e){for(const r of this.children){const s=this._tileInfoView.getTileResolution(r.key);r.setTransform(e,s)}}setStencilReference(){let e=1;for(const r of this.children)r.stencilRef=e++}}export{n as sortByLevel};\n"],"sourceRoot":"webpack:///"}